!function(){function e(e){var t,n,i,o,a,r,s,l=new Array,c=0,u=e.rows.length;for(i=0;u>i;){for(var t=e.rows[i],o=0,a=0;o<t.cells.length||a<l.length;)if(l[a])l[a++]--;else if(o>=t.cells.length)a++;else for(n=t.cells[o++],s=Math.max(1,parseInt(n.rowSpan)),r=Math.max(1,parseInt(n.colSpan));r>0&&!l[a];r--)l[a++]=s-1;c=Math.max(a,c),i++}return c}function t(t,i,o,a,r,s){var l,c,u,d,h,p,f,g,m=[],v=[],y=t.rows.length,b=e(t),w=[];if(i>0)for(u=o;o+i>u;u++)t.insertRow(u);for(u=0;y>u;){for(var l=t.rows[u],d=0,h=0;b>h;){if(a>0&&h===r)for(p=0;a>p;p++)w.push(n(l,d++,s.placeHolder));if(m[h])if(0>i&&u===o-i&&v[h]&&1==v[h].rowSpan)for(c=v[h],d>=l.cells.length?l.appendChild(c):l.insertBefore(c,l.cells[d]),d++,g=c.rowSpan=m[h],f=Math.max(1,parseInt(c.colSpan));f>0;--f)m[h++]=g-1;else for(0===--m[h++]&&(v[h]=null);m[h]&&!v[h];)--m[h++];else{d>=l.cells.length&&w.push(n(l,d,s.placeHolder)),c=l.cells[d++],g=Math.max(1,parseInt(c.rowSpan)),g>1&&(v[h]=c,0>i&&u>=o&&o-i>u&&(c.rowSpan=1));var C=h;for(f=Math.max(1,parseInt(c.colSpan));f>0;--f){if(m[h]){c.colSpan-=f;break}m[h++]=g-1}if(0>i&&u>=o&&o-i>u);else if(a>0&&h>r&&r>C)c.colSpan+=a;else if(0>a&&r-a>C&&h>r){var T=Math.max(0,r-C)+Math.max(0,h-(r-a));T?c.colSpan=T:l.deleteCell(--d)}}}if(a>0&&h===r)for(p=0;a>p;p++)w.push(n(l,d++,s.placeHolder));if(u++,i>0&&u===o)for(p=0;b>p;p++)m[p]&&(m[p]+=i),v[p]&&(v[p].rowSpan+=i);else if(0>i&&u===o)for(p=0;p<v.length;p++)v[p]&&(v[p].rowSpan-=Math.min(-i,m[p]))}if(0>i)for(u=o;o-i>u;u++)t.deleteRow(u);return w}function n(e,t,n){var i,o;if(t>0?i=e.cells[t-1]:t<e.cells.length&&(i=e.cells[t+1]),o=e.insertCell(t),i&&"TH"===i.tagName){var a=document.createElement("th");n&&(a.innerHTML=n),No(o).replaceWith(a)}else n&&(o.innerHTML=n);return o}function o(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}function a(e,t,n){bo[e]=n,wo[e]=t}function r(e,t,n){if("undefined"==typeof bo[e])a(e,t,n);else{n=n||t;for(var i in n)bo[e][i]=n[i]}}function s(e){vo!==e&&(vo=e,Mo.eachInstance(function(){this.localeChange()}))}function l(e,t){if("undefined"!=typeof bo[vo]&&"undefined"!=typeof bo[vo][e])return bo[vo][e];if("undefined"!=typeof bo[yo]&&"undefined"!=typeof bo[yo][e])return bo[yo][e];for(var n in wo)if("undefined"!=typeof bo[n][e])return bo[n][e];return t?!1:e}function c(e,t){if(!vo){var n=Mo.persist("locale");n&&(vo=n)}if(vo||(vo="en"),e=l(e,t===!1),e===!1)return!1;if(t){for(var i in t)e=e.replace("{{"+i+"}}",t[i]);return e}return e}function u(e){if(!e||!e.id){var t;do t="ruid-"+Math.random().toString().replace(".","");while(document.getElementById(t));if(!e)return t;e.id=t}return e.id}function d(e){for(var t in e)this[t]=e[t]}function h(e){var t=!1;for(var n in Co)"function"==typeof Co[n]?Co[n]()&&(t=!0):Co[n]&&(t=!0);if(t){var i="There are unsaved changes on this page. Are you sure you wish to navigate away?";return(e||window.event).returnValue=i,i}}function p(e,t){return e.replace(/([A-Z])/g,function(e){return(t||"-")+e.toLowerCase()})}function f(e){return To[e]}function g(e,t){return e=e.replace(/tr\(['"]{1}(.*?)['"]{1}\)/g,function(e,t){return t=t.replace(/\\(.?)/g,function(e,t){switch(t){case"\\":return"\\";case"0":return"\0";case"":return"";default:return t}}),c(t)}),t=No.extend({},this.options,t||{}),t=m(t),e=e.replace(/\{\{(.*?)\}\}/g,function(e,n){return t[n]})}function m(e,t,n){t=t?t+".":"";var i=5;n||(n=1);var o={};for(var a in e)if("object"==typeof e[a]&&i>n){var r=m(e[a],t+a,++n);for(var s in r)o[s]=r[s]}else o[t+a]=e[a];return o}function v(e){return!isNaN(e-0)&&null!==e}function y(e){return"string"==typeof e}function b(e){return e instanceof Array}function w(e){return e instanceof Node}function C(e){return w(e)?e.nodeType===Node.TEXT_NODE:T(e)?w(e[0]):!1}function T(e){return e instanceof jQuery}function E(e,t,n){return S(e,t),e=Hn(t),n(),rangy.getSelection().removeAllRanges(),e}function S(e,t){if(e){var n=Un(t,e);return n.ranges&&rangy.getSelection().setRanges(n.ranges),n.element}return t}function x(e){e()}function _(){}function R(){}function k(e,t){for(var n in t){var i=t[n],o=!1;do if(o=No(e).find(n),o.length){o=No(o.get(0));var a=No(i).clone();a.html(o.html()),a.attr(Q(o)),o.replaceWith(a)}while(o.length)}}function N(e){No(e).unwrap()}function D(e,t){for(i=0;i<t.length;i++)No.trim(e.attr(t[i]))||e.removeAttr(t[i]),e.find("["+t[i]+"]").filter(function(){return""===No.trim(No(this).attr(t[i]))}).removeAttr(t[i])}function A(e){return e.contents().each(function(){this.nodeType==Node.COMMENT_NODE&&No(this).remove()}),e.children().each(function(){A(No(this))}),e}function O(e,t){var n;do n=!1,e.find(t.join(",")).each(function(){""===No.trim(No(this).html())&&(No(this).remove(),n=!0)});while(n);return e}function I(e,t){for(var n=Nt(e),i=0,o=n.length;o>i;i++){var a=n[i].cloneNode(),r=document.createElement(t);r.appendChild(a),e.insertBefore(r,n[i]),e.removeChild(n[i])}}function P(e,t){var n;do n=!1,No(e).find(t).each(function(){No(this).parent().is(t)&&(No(this).unwrap(),n=!0)});while(n)}function M(e){No(e).find(".rangySelectionBoundary").remove()}function B(e,t){var n,i=No("<div>").addClass("spacer");"top"===t.position?(n={position:"fixed",top:t.under?No(t.under).outerHeight():0,left:0,right:0},t.spacer&&(t.under?i.insertAfter(t.under):i.prependTo("body"))):"topLeft"===t.position?(n={position:"fixed",top:t.under?No(t.under).outerHeight():0,left:0},t.spacer&&(t.under?i.insertAfter(t.under):i.prependTo("body"))):"topRight"===t.position?(n={position:"fixed",top:t.under?No(t.under).outerHeight():0,right:0},t.spacer&&(t.under?i.insertAfter(t.under):i.prependTo("body"))):"bottom"===t.position?(n={position:"fixed",bottom:0,left:0,right:0},t.spacer&&i.appendTo("body")):"bottomLeft"===t.position?(n={position:"fixed",bottom:0,left:0},t.spacer&&i.appendTo("body")):"bottomRight"===t.position&&(n={position:"fixed",bottom:0,right:0},t.spacer&&i.appendTo("body"));var o=qn(e,n);return i.css("height",e.outerHeight()),setTimeout(function(){i.css("height",e.outerHeight())},300),{dockedElement:e,spacer:i,styleState:o}}function L(e){return Kn(e.dockedElement,e.styleState),e.spacer.remove(),e.dockedElement.detach()}function z(e,t,n){var i=t.wrap("<div>").parent(),o=Vn(i,t,{"float":"none",display:"block",clear:"none",position:"static",margin:0,marginLeft:0,marginRight:0,marginTop:0,marginBottom:0,padding:0,paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:0,outline:0,width:"auto",border:"none"}),a=qn(e,{position:"static"});return i.prepend(e).addClass(n.wrapperClass?n.wrapperClass:""),{dockedElement:e,dockedTo:t,innerStyleState:o,dockedElementStyleState:a}}function F(e){Kn(e.dockedTo,e.innerStyleState),Kn(e.dockedElement,e.dockedElementStyleState);var t=e.dockedElement.detach();return e.dockedTo.unwrap(),t}function H(e,t){return e.children().each(function(){var e=No.map(this.attributes,function(e){return-1===No.inArray(e.name,t)?e.name:void 0}),n=No(this);No.each(e,function(e,t){n.removeAttr(t)}),element.removeAttributes(No(this),t)}),e}function U(e){var t=1;e.siblings().each(function(){var e=No(this).css("z-index");!isNaN(e)&&e>t&&(t=e+1)}),e.css("z-index",t)}function W(e){return e.clone().wrap("<div/>").parent().html()}function G(e){return e.clone().wrap("<div/>").parent().text()}function q(e){return"block"===K(e.tagName)}function V(e){var t=!1;return e.contents().each(function(){return!C(this)&&q(this)?(t=!0,void 0):void 0}),t}function K(e){var t,n=document.createElement(e),i="getComputedStyle"in window;return document.body.appendChild(n),t=(i?window.getComputedStyle(n,""):n.currentStyle).display,document.body.removeChild(n),t}function $(e,t){return-1!==No.inArray(No(e)[0].tagName.toLowerCase(),t)}function X(e,t,n){var i=e.parentNode;return i[0]===n[0]?e:$(i,t)?e:X(i,t,n)}function Z(e){e=No(e);var t={top:Math.round(e.offset().top),left:Math.round(e.offset().left),width:Math.round(e.outerWidth()),height:Math.round(e.outerHeight())},n=No(window).scrollTop(),i=No(window).height(),o=n+i,a=Math.round(t.height+t.top);return n<t.top&&o>a?t:(n>t.top&&(t.top=n),t.height=a>o?o-t.top:i-(o-a),t)}function Q(e){for(var t=No(e).get(0).attributes,n={},i=0,o=t.length;o>i;i++)n[t[i].name]=t[i].value;return n}function Y(e){for(var t={},n=window.getComputedStyle(e[0],null),i=0;i<n.length;i++)t[n.item(i)]=n.getPropertyValue(n.item(i));return t}function J(e,t){var n=new jQuery;Jt();for(var i=0,o=e.length;o>i;i++){var a=No("<"+t+"/>").html(No(e[i]).html());e.html(a),n.push(a[0])}return en(),n}function et(e,t){No.each(t,function(t,n){No(e).css(t)===n?No(e).css(t,""):No(e).css(t,n)})}function tt(e,t,n){for(var i in n)e.css(i,t.css(i)),t.css(i,n[i])}function nt(e){return e.is("img")||e.find("img").length?!1:/&nbsp;/.test(e.html())?!1:""===e.text()}function it(e,t){var n=No(t).offset(),i=No(t).outerHeight();No(e).css({top:n.top+i-No(window).scrollTop()+"px",left:n.left+"px"})}function ot(e,t){var n=No(e).parent();No(e).detach(),t(e),n.append(e)}function at(e,t){for(;e.length>0&&e[0]!==t[0]&&(e[0].nodeType===Node.TEXT_NODE||"inline"===e.css("display"));)e=e.parent();return e[0]===t[0]?null:e}function rt(){for(var e="ruid-"+(new Date).getTime()+"-"+Math.floor(1e5*Math.random());No("#"+e).length;)e="ruid-"+(new Date).getTime()+"-"+Math.floor(1e5*Math.random());return e}function st(e,t){for(var n=[],i=e.length-1;i>=0;i--){var o=document.createElement(t);o.innerHTML=e[i].innerHTML,No.each(e[i].attributes,function(){No(o).attr(this.name,this.value)}),No(e[i]).after(o).remove(),n[i]=o}return No(n)}function lt(e,t){if(e.outerHeight()>t.outerHeight()-20){var n=Z(t),i=t.offset();e.css({position:"absolute",top:i.top-e.outerHeight(),left:n.left+(n.width/2-e.outerWidth()/2)})}else{var n=Z(t);e.css({position:"absolute",top:n.top+(n.height/2-e.outerHeight()/2),left:n.left+(n.width/2-e.outerWidth()/2)})}}function ct(e,t){for(var n="",i=0,o=e.childNodes.length;o>i;i++){var a=e.childNodes.item(i),r=a.nodeType===Node.TEXT_NODE?a.nodeValue:W(No(a));r&&(n+=r)}return t&&(n=No("<"+t+">"+n+"</"+t+">"),n.find("p").wrapInner("<"+t+"/>"),n.find("p > *").unwrap(),n=No("<div/>").html(n).html()),n}function ut(e,t,n){for(var i=0,o=e.childNodes.length;o>i;i++){var a=e.childNodes.item(i),r=a.nodeType===Node.TEXT_NODE?a.nodeValue:No(a).html();r&&No("<"+n+"/>").html(No.trim(r)).insertBefore(t)}}function dt(e,t,n){return""!==n.html().trim()&&En()?pt(e,t,n)?xt(e,t,n):ht(e,t)?St(e,t,n):ft(e,t,n)?mt(e,t,n):void 0:void 0}function ht(e,t){var n=No(gn());return n.is(e)?!0:"blockquote"!==e||n.parent().is(e)?n.is(t)&&n.parent().is(e)?!0:n.parentsUntil(e,t).length?!0:!1:!1}function pt(e,t,n){var i=Sn(),o=No(Ut(i));if(jt(i)){var a=o.closest(t,n);a.length?Bt(i,[a]):It(i)}return o=No(Ut(i)),"blockquote"!==e||Gt(i,o.get(0))?No(o).is(t)&&!No(o).parent().is(e)?!0:!1:!1}function ft(e,t,n){return"blockquote"===e?$(n,xo):$(n,So)}function gt(e,t,n,i){i="undefined"==typeof i?!0:i;var o=function(e){return No(e).is("img")||No(e).find("img").length?void 0:No(e).text().trim()?void 0:(No(e).remove(),!0)};e.find("> "+t).each(function(){return i&&o(this)?!0:(No(this).contents().each(function(){if(i&&o(this))return!0;if("p"===t){if(!C(this)&&!$(this,n))return No(this).contents().unwrap(),!0}else{if(C(this))return!0;if(!$(this,n))return No(this).contents().unwrap(),o(this),!0}}),void 0)})}function mt(e,t,n){var i=Sn(),o=Ut(i);if(!jt(i)||o!==n.get(0)){No(o).is("td,th")||o===n.get(0)?Mt(i,o):qt(i,o)&&Pt(i,No(o)),jt(i)&&i.selectNode(at(No(o),n).get(0));var a=vt(ct(i.extractContents()),t),r="blockquote"===e?xo:So,s=rt(),l="<"+e+' id="'+s+'">'+No("<div/>").html(a).html()+"</"+e+">";Zt(i,l,n,r);var c=No("#"+s).removeAttr("id"),u="blockquote"===e?_o:Eo;if(gt(c,t,u),c.is(e)){var d=c.find(" > "+t);0===d.length&&(c=No(document.createElement("li")).appendTo(c))}sn(c.get(0))}}function vt(e,t){return e=No("<div/>").html(e),V(e)?(e.contents().each(function(){return No(this).is("img")?!0:nt(No(this))?No(this).remove():(No(this).wrap("<"+t+"/>"),q(this)||No(this).wrap("<p>"),void 0)}),e.html()):"p"===t?"<"+t+">"+e.html()+"</"+t+">":"<"+t+"><p>"+e.html()+"</p></"+t+">"}function yt(e,t,n){var i=e.contents();return i.length?(i.each(function(){return""===No(this).text().trim()?No(this).remove():C(this)||!q(this)?No(this).wrap("<"+n+">"):void 0}),e.contents().unwrap()):st(e,n)}function bt(e,t,n){return e.find(t).each(function(){yt(No(this),n,"p")}),e.contents().unwrap()}function wt(e,t,n){Ct(e,t,n),Tt(e,t,n)}function Ct(e,t,n){e.is(t)&&e.find(n).each(function(){""===No(this).text().trim()&&No(this).remove()})}function Tt(e,t){e.is(t)&&""===e.text().trim()&&e.remove()}function Et(e,t,n,i){var o=Ft(e),a=Ht(e),r=rt();It(e);var s="blockquote"===t?xo:Ro;s=No.grep(s,function(e){return"li"!==e}),Zt(e,No("<p/>").attr("id",r),i,s);var l=No("#"+r);wt(l.prev(),t,n),wt(l.next(),t,n);var c=[o];return o!==a&&(No(o).nextUntil(a).each(function(){this!==a&&c.push(this)}),c.push(a)),c.reverse(),No(c).each(function(){l.after(this),yt(No(this),t,"p")}),l.remove(),gt(No(Ut(e)),n,Eo)}function St(e,t,n){var i=Sn();jt(i)&&Bt(i,[t]);var o=No(Ut(i));if(o.is(e)){var a=Ft(i),r=Ht(i);return No(r).is(e)&&No(a).is(e)?bt(o,t,e):Et(i,e,t,n)}return o.is(t)||(o=o.closest(t)),o.prev().length||o.next().length?o.next().length&&o.prev().length?Et(i,e,t,n):o.next().length&&!o.prev().length?(o.parent().before(yt(o,e,"p")),o.remove(),void 0):!o.next().length&&o.prev().length?(o.parent().after(yt(o,"p",e)),o.remove(),void 0):void 0:bt(o.closest(e),t,e)}function xt(e,t,n){var i=Sn();jt(i)&&Bt(i,[t]);var o=Ft(i),a=Ht(i),r=rt();It(i);var s=No.grep(Ro,function(e){return e!==t});Zt(i,No("<p/>").attr("id",r),n,s);var l=No("#"+r);wt(l.prev(),e,t),wt(l.next(),e,t);var c=[o];o!==a&&(No(o).nextUntil(a).each(function(){this!==a&&c.push(this)}),c.push(a)),c.reverse(),No(c).each(function(){l.after(this)}),l.remove();var u=No(c).wrap("<"+e+">").parent();return gt(u,t,Eo)}function _t(e,t,n,i){var o=fn();if(!o.closest(t).length)return!1;var a=o.closest(e);if(!a.length||n.get(0)===a.get(0))return!1;hn(o),Fn();var r=No("<"+e+"/>"),s=No("<"+e+"/>"),l=!1;return a.children().each(function(){return o.closest(t).get(0)===this?(l=!0,r.append(this),void 0):(l?s.append(this):r.append(this),void 0)}),a.replaceWith(r),i=No(i).appendTo(No("body")),r.after(i,s),i}function Rt(e,t){var n=fn();if(!n.closest(t).length)return!1;Fn(),hn(n);var i=pn();""===i.trim()&&(i="&nbsp;"),Fn(),""===n.text().trim()&&n.html("&nbsp;");var o=No("<"+t+">").html(i);return n.closest(t).after(o),gt(n.closest(e),t,Eo,!1),o}function kt(e){for(;e.nodeType===Node.TEXT_NODE;)e=e.parentNode;return e}function Nt(e){for(var t=[],n=/^\s*$/,i=0,o=e.childNodes.length;o>i;i++)e.childNodes[i].nodeType==Node.TEXT_NODE&&(n.test(e.childNodes[i].nodeValue)||t.push(e.childNodes[i]));return t}function Dt(e,t){for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1}function At(e,t){if(localStorage){var n;n=localStorage.raptor?JSON.parse(localStorage.raptor):{},n[e]=t,localStorage.raptor=JSON.stringify(n)}}function Ot(e){if(localStorage){var t;return t=localStorage.raptor?JSON.parse(localStorage.raptor):{},t[e]}}function It(e){e.setStartBefore(e.startContainer),e.setEndAfter(e.endContainer)}function Pt(e,t){e.selectNode(No(t)[0])}function Mt(e,t){e.selectNodeContents(No(t).get(0))}function Bt(e,t){do{It(e);for(var n=0,i=t.length;i>n;n++)if(No(e.commonAncestorContainer).is(t[n]))return}while(e.commonAncestorContainer)}function Lt(e,t){var n=[],i=No("<div/>").append(t)[0].childNodes;return e.deleteContents(),void 0===i.length||1===i.length?e.insertNode(i[0].cloneNode(!0)):No.each(i,function(t,i){n.unshift(i.cloneNode(!0)),e.insertNodeAtEnd(n[0])}),n}function zt(e){var t=Qt(e);return"string"==typeof t&&(t=t.replace(/([ #;&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")),Gn(t)}function Ft(e){return kt(e.startContainer)}function Ht(e){return kt(e.endContainer)}function Ut(e){return kt(e.commonAncestorContainer)}function jt(e){return e.startOffset===e.endOffset&&e.startContainer===e.endContainer}function Wt(e,t){var n=e.cloneRange();return n.selectNodeContents(t),n.containsRange(e)}function Gt(e,t){return e.containsNode(t)}function qt(e,t){return e.containsNodeText(t)}function Vt(e){if(e.startContainer.data)for(;/\s/.test(e.startContainer.data.substr(e.startOffset,1));)e.setStart(e.startContainer,e.startOffset+1);if(e.endContainer.data)for(;e.endOffset>0&&/\s/.test(e.endContainer.data.substr(e.endOffset-1,1));)e.setEnd(e.endContainer,e.endOffset-1)}function Kt(e,t){return rangy.serializeRange(e,!0,t)}function $t(e,t){for(var n=e.split("|"),i=[],o=0,a=n.length;a>o;o++)i[o]=rangy.deserializeRange(n[o],t);return i}function Xt(e,t,n,i){var o=Ut(e);$(o,i)||(o=X(o,i,n));var a=rangy.createRange();a.setStartBefore(o),a.setEnd(e.startContainer,e.startOffset);var r=a.cloneContents(),s=rangy.createRange();s.setStart(e.endContainer,e.endOffset),s.setEndAfter(o);var l=s.cloneContents(),c=W(No(ct(r)));return c+=W(No(t).attr("data-replacement",!0)),c+=W(No(ct(l))),c=No(c),No(o).replaceWith(c),c=c.parent().find("[data-replacement]").removeAttr("data-replacement"),c.prev().is(o.tagName.toLowerCase())&&!c.prev().html().trim()&&c.prev().remove(),c.next().is(o.tagName.toLowerCase())&&!c.next().html().trim()&&c.next().remove(),c}function Zt(e,t,n,i){var o=kt(e.startContainer),a=kt(e.endContainer),r=Ut(e),s=$(r,i),l=$(o,i),c=$(a,i);return s&&l&&c?Lt(e,t):Xt(e,t,n,i)}function Qt(e){return ct(e.cloneContents())}function Yt(){var e=rangy.getSelection();return e.rangeCount>0?e.getRangeAt(0):null}function Jt(e){(!ko||e)&&(ko=rangy.saveSelection())}function en(){ko&&(rangy.restoreSelection(ko),ko=!1)}function tn(){ko&&rangy.removeMarkers(ko),ko=!1}function nn(){return ko!==!1}function on(e,t,n){t=t||rangy.getSelection();for(var i,o=0;i=t.getAllRanges()[o++];)e.call(n,i)}function an(e){rangy.getSelection().setSingleRange(e)}function rn(e,t){var n=[];return on(function(t){n=n.concat(Lt(t,e))},t,this),n}function sn(e,t){t=t||rangy.getSelection();var n=rangy.createRange();n.selectNodeContents(e),t.setSingleRange(n)}function ln(e){var t=rangy.createRange();t.selectNode(e),rangy.getSelection().setSingleRange(t)}function cn(e,t,n){t=t||rangy.getSelection(),t.removeAllRanges(),No(e).each(function(){var e=rangy.createRange();e.selectNodeContents(this),e.collapse(n),t.addRange(e)})}function un(e,t){cn(e,t,!1)}function dn(e,t){cn(e,t,!0)}function hn(e,t){t=t||rangy.getSelection();var n=Sn();t.removeAllRanges(),n.setEndAfter(e.get(0)),t.addRange(n)}function pn(e){return e=e||rangy.getSelection(),e.toHtml()}function fn(e,t){if(t=t||rangy.getSelection(),!En())return new jQuery;var n,e=Sn();return n=e.commonAncestorContainer.nodeType===Node.TEXT_NODE?e.commonAncestorContainer.parentNode:e.commonAncestorContainer,No(n)}function gn(e){var t=new jQuery;return on(function(e){t.push(fn(e)[0])},e,this),t}function mn(){var e=rangy.getSelection();return null===e.anchorNode?null:e.isBackwards()?e.focusNode.nodeType===Node.TEXT_NODE?No(e.focusNode.parentElement):No(e.focusNode):(e.anchorNode||console.trace(),e.anchorNode.nodeType===Node.TEXT_NODE?No(e.anchorNode.parentElement):No(e.anchorNode))}function vn(){var e=rangy.getSelection();return null===e.anchorNode?null:e.isBackwards()?e.anchorNode.nodeType===Node.TEXT_NODE?No(e.anchorNode.parentElement):No(e.anchorNode):e.focusNode.nodeType===Node.TEXT_NODE?No(e.focusNode.parentElement):No(e.focusNode)}function yn(){var e=rangy.getSelection(),t=e.isBackwards()?e.anchorNode:e.focusNode,n=e.isBackwards()?e.focusOffset:e.anchorOffset;if(n!==t.textContent.length)return!1;var i=t.nextSibling;return i&&""!==No(i).html()?!1:!0}function bn(){var e=rangy.getSelection(),t=e.isBackwards()?e.focusNode:e.anchorNode;if(e.isBackwards()?e.focusOffset:0!==e.anchorOffset)return!1;var n=t.previousSibling;return n&&""!==No(n).html()?!1:!0}function wn(){return""===rangy.getSelection().toHtml()}function Cn(e,t){t=t||{};var n=rangy.createCssClassApplier(t.classes||"",{normalize:!0,elementTagName:e,elementProperties:t.attributes||{}});on(function(i){if(zt(i)){var o=No("<"+e+"/>").addClass(t.classes).attr(t.attributes||{}).append(ct(i.cloneContents()));Lt(i,o)}else n.toggleRange(i)},null,this)}function Tn(e,t,n){on(function(i){var o=fn(i);o.is(e)?o.attr(t):Cn(e,{classes:n,attributes:t})},null,this)}function En(){return 0!==rangy.getSelection().rangeCount}function Sn(){return rangy.getSelection().getRangeAt(0)}function xn(e,t){t=t||rangy.getSelection();var n=n(),i=gn()[0],o=rangy.createRange();o.setStartBefore(i),o.setEnd(n.startContainer,n.startOffset);var a=o.cloneContents(),r=rangy.createRange();r.setStart(n.endContainer,n.endOffset),r.setEndAfter(i);var s=r.cloneContents(),l=W(No(ct(a)));return l+=W(No(e).attr("data-replacement",!0)),l+=W(No(ct(s))),l=No(l),No(i).replaceWith(l),l.parent().find("[data-replacement]").removeAttr("data-replacement")}function _n(e,t,n){if(n=n||rangy.getSelection(),En()){var i=mn()[0],o=vn()[0],a=gn()[0],r=$(a,t),s=$(i,t),l=$(o,t);return r&&s&&l?rn(e):xn(e,n)}}function Rn(e,t){on(function(n){for(var i=No(n.commonAncestorContainer);i.length&&i[0]!==t[0]&&(i[0].nodeType===Node.TEXT_NODE||"inline"===i.css("display"));)i=i.parent();i[0]===t[0]&&"inline"!==t.css("display")&&(J(t,"div"),i=t.children().first()),et(i,e)},null,this)}function kn(e,t,n){on(function(i){var o,a=at(No(i.startContainer),t),r=at(No(i.endContainer),t);if(a&&r){a.is(r)?o=a:a&&r&&(o=a.nextUntil(r).andSelf().add(r));for(var s=0,l=o.length;l>s;s++)e(o[s])}else e(J(t,n).get(0))})}function Nn(e,t,n,i){var o=!1,a=new jQuery;kn(function(t){if(a.push(t),!o)for(var n=0,i=e.length;i>n;n++)No(t).hasClass(e[n])||(o=!0)},n,i),No(a).removeClass(t.join(" ")),o?No(a).addClass(e.join(" ")):No(a).removeClass(e.join(" "))}function Dn(e,t){t=t||rangy.getSelection();for(var n=t.getAllRanges(),i=[],o=0,a=n.length;a>o;o++){var r=n[o].cloneRange();n[o].startContainer===e||Dt(n[o].startContainer,e)||r.setStart(e,0),n[o].endContainer===e||Dt(n[o].endContainer,e)||r.setEnd(e,e.childNodes.length),i.push(r)}t.setRanges(i)}function An(e,t){if(e=e||document.body,t=t||rangy.getSelection(),En()){var n=Sn().cloneRange(),i=n.extractContents();""===ct(i)&&(Mt(n,n.commonAncestorContainer),t.setSingleRange(n),i=n.extractContents()),i=No("<div/>").append(ct(i)).html().replace(/(<\/?.*?>)/gi,function(e){return null!==e.match(/^<(img|object|param|embed|iframe)/)?e:""});for(var o=n.commonAncestorContainer;o&&o.parentNode!==e;)o=o.parentNode;if(o){n.setEndAfter(o);var a=n.extractContents();n.collapseAfter(o),n.insertNode(a),n.collapseAfter(o)}i=No.parseHTML(i),null!==i&&No(i.reverse()).each(function(){return No(this).is("img")?(n.insertNode(No(this).removeAttr("width height class style").get(0)),void 0):(n.insertNode(this),void 0)})}}function On(e,t,n,i){Jt();var o="domTools"+Math.ceil(1e7*Math.random());on(function(e){var a=rangy.createCssClassApplier(i,{elementTagName:n});a.isAppliedToRange(e)?a.toggleSelection():rangy.createCssClassApplier(t,{elementTagName:o}).toggleSelection()},null,this),No(o).each(function(){No(this).replaceWith(No("<"+e+"/>").addClass(t).html(No(this).html()))}),en()}function In(){var e=rangy.getSelection().getAllRanges();1===e.length&&""===Qt(e[0])&&rangy.getSelection().expand("word")}function Pn(e,t,n){for(var i=rangy.getSelection().getAllRanges(),o=0,a=i.length;a>o;o++){var r=No(kt(i[o].startContainer));(n||!r.is(e)&&!r.is(t))&&(r=r.parentsUntil(t,e)),r=n?r.last():r.first(),1!==r.length||r.is(t)||i[o].setStart(r[0],0),r=No(kt(i[o].endContainer)),(n||!r.is(e)&&!r.is(t))&&(r=r.parentsUntil(t,e)),r=n?r.last():r.first(),1!==r.length||r.is(t)||i[o].setEnd(r[0],r[0].childNodes.length)}rangy.getSelection().setRanges(i)}function Mn(){if(En()){var e=Sn();Vt(e),an(e)}}function Bn(e,t){var n=new jQuery;return on(function(i){for(var o=i.startContainer;o.nodeType===Node.TEXT_NODE;)o=o.parentNode;for(var a=i.endContainer;a.nodeType===Node.TEXT_NODE;)a=a.parentNode;var r=function(){t.is(this)||n.push(this)};do{if(No(o).filter(e).each(r),t.is(o)||0!==n.length||No(o).parentsUntil(t,e).each(r),No(o).find(e).each(r),No(a).is(o))break;o=No(o).next()}while(o.length>0&&0===No(o).prevAll().has(a).length)}),n}function Ln(e,t,n){var i=Bn(t.join(","),n);if(i.length)Jt(),st(i,e),en();else{var o=n.get(0);o.innerHTML.trim()?(Jt(),o.innerHTML="<"+e+">"+o.innerHTML+"</"+e+">",en()):(o.innerHTML="<"+e+">&nbsp;</"+e+">",sn(o.childNodes[0]))}}function zn(e,t){var n=!0;return on(function(i){var o=No(i.commonAncestorContainer).find("*");0!==No(i.commonAncestorContainer).parentsUntil(t,e).length||0!==o.length&&o.length===o.filter(e).length||(n=!1)}),n}function Fn(e){e=e||rangy.getSelection(),e.deleteFromDocument()}function Hn(e){var t=Yt();return{element:e.clone(!0),ranges:t?Kt(t,e.get(0)):null}}function Un(e,t){e.replaceWith(t.element);var n=null;try{t.ranges&&(n=$t(t.ranges,t.element.get(0)))}catch(i){}return{element:t.element,ranges:n}}function jn(e,t){allowed=[];for(var n=0;n<t.length;n++)t[n].match(/[a-z][a-z0-9]{0,}/g)&&allowed.push(t[n]);var i=/<\/?([a-z][a-z0-9]*)\b[^>]*\/?>/gi,o=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return e.replace(o,"").replace(i,function(e,t){return allowed.indexOf(t.toLowerCase())>-1?e:""})}function Wn(e,t){return e.replace(/([A-Z])/g,function(e){return(t||"-")+e.toLowerCase()})}function Gn(e){return No(No.parseHTML(e)).is(":empty")}function qn(e,t){var n=e.get(0),i={};for(var o in t)i[o]=n.style[o];for(o in t)e.css(o,t[o]);return i}function Vn(e,t,n){var i=t.get(0),o={};for(var a in n)o[a]=i.style[a];for(a in n)e.css(a,t.css(a)),t.css(a,n[a]);return o}function Kn(e,t){for(var n in t)e.css(n,t[n]||"")}function $n(e,t,n){n=n||{};for(var i=document.createElement("table");t--;)for(var o=i.insertRow(0),a=0;e>a;a++){var r=o.insertCell(0);n.placeHolder&&(r.innerHTML=n.placeHolder)}return i}function Xn(e,n,i){return t(e,0,0,1,n,i||{})}function Zn(e,n){t(e,0,0,-1,n)}function Qn(e,t,n){var i=new GoogTable(e);return i.insertRow(t,n)}function Yn(e,n){t(e,-1,n,0,0)}function Jn(e){for(var t,n,i,o,a=[],r=e.parentNode.parentNode.parentNode.tBodies[0].rows,s=0;s<r.length;s++){n=r[s].sectionRowIndex,n=s;for(var l=0;l<r[s].cells.length;l++){for(t=l;a[n]&&a[n][t];)t++;for(i=t;i<t+(r[s].cells[l].colSpan||1);++i)for(o=n;o<n+(r[s].cells[l].rowSpan||1);++o)a[o]||(a[o]=[]),a[o][i]=!0;if(e===r[s].cells[l])return{x:t,y:n}}}}function ei(e,t){for(var n=e.tBodies[0].rows,i=0;i<n.length;i++)for(var o=0;o<n[i].cells.length;o++){var a=Jn(n[i].cells[o]);if(a.x===t.x&&a.y===t.y)return n[i].cells[o]}return null}function ti(e,t,n){for(var i=Math.min(t.x,n.x),o=i,a=Math.min(t.y,n.y),r=Math.max(t.x,n.x),s=Math.max(t.y,n.y),l=[];s>=a;){for(;r>=o;){var c=ei(e,{x:o,y:a});null!==c&&l.push(c),o++}o=i,a++}return l}function ni(){}function oi(e,t,n,i,o){var a=new GoogTable(e);a.mergeCells(t,n,i,o)}function ai(){}function ri(e,t,n){var i=new GoogTable(e);i.splitCell(t,n)}function si(e){for(var t=0,n=e.rows.length;n>t;t++)if(e.rows[t].cells.length>0)return!1;return!0}function li(e){return e instanceof rangy.WrappedRange}function ci(e){return e instanceof rangy.WrappedSelection}function ui(e,t){return No(e).button(t)}function di(e,t){return No(e).button("option","text",!0),No(e).button("option","label",t)}function hi(e,t){return No(e).button("option","icons",{primary:t})}function pi(e){return No(e).button("option","disabled",!1)}function fi(e){return!No(e).is(".ui-state-disabled")}function gi(e){return No(e).button("option","disabled",!0)}function mi(e){return No(e).addClass("ui-state-highlight")}function vi(e){return No(e).removeClass("ui-state-highlight")}function yi(e,t){return No(e).menu(t)}function bi(e,t){t.dialogClass="undefined"!=typeof t.dialogClass?t.dialogClass+" ui-dialog-fixed":"ui-dialog-fixed";var n=No(e).dialog(t);return n.parent().css({top:(parseInt(n.parent().css("top"))||0)-No(window).scrollTop()}),n.dialog("option","position","center"),n}function wi(e){return No(e).dialog("open")}function Ci(e){return No(e).dialog("close")}function Ti(e,t){return No(e).tabs(t)}function Ei(e){"success"==e.type&&(e.state="confirmation"),No.pnotify(No.extend({type:"success",styling:"jqueryui",history:!1},e))}function Si(){if(void 0===Do){Do=!0,Ao=/(iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),Ao&&(No("html").addClass("raptor-ios"),Ao&&No(document).on("scroll",function(){setInterval(function(){No("body").css("height","+=1").css("height","-=1")},0)})),Io=/Firefox/i.test(navigator.userAgent),Io&&No("html").addClass("raptor-ff");var e=function(){var e=-1;return-1!=navigator.appVersion.indexOf("MSIE")&&(e=parseFloat(navigator.appVersion.split("MSIE")[1])),e}();Po=-1!==e,Po&&9>e&&(Do=!1,No(function(){var e=No("<div/>").addClass("raptor-unsupported").html('<div class="raptor-unsupported-overlay"></div><div class="raptor-unsupported-content">    It has been detected that you a using a browser that is not supported by Raptor, please    use one of the following browsers:    <ul>        <li><a href="http://www.google.com/chrome">Google Chrome</a></li>        <li><a href="http://www.firefox.com">Mozilla Firefox</a></li>        <li><a href="http://windows.microsoft.com/ie">Internet Explorer</a></li>    </ul>    <div class="raptor-unsupported-input">        <button class="raptor-unsupported-close">Close</button>        <input name="raptor-unsupported-show" type="checkbox" />        <label>Don\'t show this message again</label>    </div><div>').appendTo("body"),t=function(e){var t=1;e.siblings().each(function(){var e=No(this).css("z-index");!isNaN(e)&&e>t&&(t=e+1)}),e.css("z-index",t)};t(e),e.find(".raptor-unsupported-close").click(function(){e.remove()})})),Oo=void 0!==jQuery.hotkeys}return Do}function xi(e){this.name=e}function _i(e,t){this.name=e;for(var n in t)this[n]=t[n]}function Ri(e,t){this.raptor=e,this.uiOrder=t}function ki(){xi.call(this,"toolbar"),this.wrapper=null}function Ni(){xi.call(this,"hoverPanel"),this.hoverPanel=null,this.visible=!1}function Di(){xi.call(this,"elementHoverPanel"),this.elements="img",this.hoverPanel=null,this.visible=!1,this.target=null,this.enabled=!0}function Ai(e){this.text=!1,this.label=null,this.icon=null,this.hotkey=null;for(var t in e)this[t]=e[t]}function Oi(e){this.preview=!0,this.previewing=!1,Ai.call(this,e)}function Ii(e){this.disable=!1,Ai.call(this,e)}function Pi(e){Oi.call(this,e)}function Mi(e){Ai.call(this,e)}function Bi(e){Pi.call(this,e)}function Li(e){this.state=null,Ai.call(this,e)}function zi(e){Li.call(this,e),Ii.call(this,e)}function Fi(e,t){this.menu=e,this.name=e.name,this.raptor=e.raptor,this.options=e.options,Ai.call(this,t)}function Hi(e){this.menu=null,this.menuContent="",this.button=null;for(var t in e)this[t]=e[t]}function Ui(e){Hi.call(this,e)}function ji(){Ui.call(this,{name:"classMenu"})}function Wi(){this.colors=["white","black","grey","blue","red","green","purple","orange"],this.currentColor="automatic",Ui.call(this,{name:"colorMenuBasic"})}function Gi(e,t){this.options={dockToElement:!1,docked:!1,position:"top",spacer:!0,persist:!0},this.dockState=!1,this.marker=!1,_i.call(this,e||"dock",t)}function qi(){this.options={fonts:["arial","palatino","georgia","times","comic-sans","impact","courier"]},Ui.call(this,{name:"fontFamilyMenu"})}function Vi(){this.options={persist:!0},Ui.call(this,{name:"languageMenu"})}function Ki(e){this.raptor=e,this.label=c("linkTypeDocumentLabel")}function $i(e){this.raptor=e,this.label=c("linkTypeEmailLabel")}function Xi(e){this.raptor=e,this.label=c("linkTypeExternalLabel")}function Zi(e){this.raptor=e,this.label=c("linkTypeInternalLabel")}function Qi(e,t){_i.call(this,e||"noBreak",t)}function Yi(e,t){_i.call(this,e||"normaliseLineBreaks",t)}function Ji(e,t){this.options={allowedTags:["h1","h2","h3","h4","h5","h6","ul","ol","li","blockquote","p","a","span","hr","br","strong","em"],allowedAttributes:["href","title"],allowedEmptyTags:["hr","br"],panels:["formatted-clean","plain-text","formatted-unclean","source"]},_i.call(this,e||"paste",t)}function eo(e,t){this.options={content:c("placeholderPluginDefaultContent"),tag:"p",select:!0},_i.call(this,e||"placeholder",t)}function to(e,t){this.options={retain:!1},_i.call(this,e||"saveJson",t),this.size=null}function no(e,t){this.method="put",this.options={retain:!1},_i.call(this,e||"saveRest",t)
}function io(){Ui.call(this,{name:"snippetMenu"})}function oo(e){Mi.call(this,e)}function ao(){Hi.call(this,{name:"tableCreate"})}function ro(e,t){_i.call(this,e||"tableSupport",t)}function so(){Ui.call(this,{name:"tagMenu"})}function lo(e){Pi.call(this,e)}function co(e,t){_i.call(this,e||"toolTip",t)}function uo(e,t){_i.call(this,e||"unsavedEditWarning",t)}GoogTable=function(e){this.element=goog.dom.getAncestorByTagNameAndClass(e,goog.dom.TagName.TABLE),this.element||goog.log.error(this.logger_,"Can't create Table based on a node that isn't a table, or descended from a table."),this.dom_=goog.dom.getDomHelper(this.element),this.refresh()},GoogTable.prototype.refresh=function(){var e=this.rows=[],t=this.element.getElementsByTagName(goog.dom.TagName.TBODY)[0];if(t){for(var n=[],i=t.firstChild;i;i=i.nextSibling)i.nodeName==goog.dom.TagName.TR&&n.push(i);for(var o,a=0;o=n[a];a++)for(var r,s=e[a],l=GoogTable.getChildCellElements(o),c=0,u=0;r=l[u];u++){for(;s&&s.columns[c];)c++;for(var d=new GoogTableCell(r,a,c),h=0;h<d.rowSpan;h++){var p=a+h,f=e[p];f||e.push(f=new GoogTableRow(n[p],p));var g=c+d.colSpan;f.columns.length<g&&(f.columns.length=g);for(var m=0;m<d.colSpan;m++){var v=c+m;f.columns[v]=d}}c+=d.colSpan}}},GoogTable.getChildCellElements=function(e){for(var t,n=[],i=0;t=e.childNodes[i];i++)(t.nodeName==goog.dom.TagName.TD||t.nodeName==goog.dom.TagName.TH)&&n.push(t);return n},GoogTable.prototype.insertRow=function(e){var t,n,i=goog.isDefAndNotNull(e)?e:this.rows.length;0==i?(t=this.rows[0],n=!1):(t=this.rows[i-1],n=!0);for(var o,a=this.dom_.createElement("tr"),r=0;o=t.columns[r];r+=1)n&&o.endRow>i||!n&&o.startRow<i?(o.setRowSpan(o.rowSpan+1),o.colSpan>1&&(r+=o.colSpan-1)):a.appendChild(this.createEmptyTd()),n?goog.dom.insertSiblingAfter(a,t.element):goog.dom.insertSiblingBefore(a,t.element);return this.refresh(),a},GoogTable.prototype.insertColumn=function(e){for(var t,n=goog.isDefAndNotNull(e)?e:this.rows[0]&&this.rows[0].columns.length||0,i=[],o=0;t=this.rows[o];o++){var a=t.columns[n];if(a&&a.endCol>=n&&a.startCol<n)a.setColSpan(a.colSpan+1),o+=a.rowSpan-1;else{var r=this.createEmptyTd();r.style.width=GoogTable.OPTIMUM_EMPTY_CELL_WIDTH+"px",this.insertCellElement(r,o,n),i.push(r)}}return this.refresh(),i},GoogTable.prototype.removeRow=function(e){var t=this.rows[e];t||goog.log.warning(this.logger_,"Can't remove row at position "+e+": no such row.");for(var n,i=0;n=t.columns[i];i+=n.colSpan)n.rowSpan>1&&(n.setRowSpan(n.rowSpan-1),n.startRow==e&&this.insertCellElement(n.element,e+1,n.startCol));t.element.parentNode.removeChild(t.element),this.refresh()},GoogTable.prototype.removeColumn=function(e){for(var t,n=0;t=this.rows[n];n++){var i=t.columns[e];i||goog.log.error(this.logger_,"Can't remove cell at position "+n+", "+e+": no such cell."),i.colSpan>1?i.setColSpan(i.colSpan-1):i.element.parentNode.removeChild(i.element),n+=i.rowSpan-1}this.refresh()},GoogTable.prototype.mergeCells=function(e,t,n,i){var o,a=[];if(e==n&&t==i)return goog.log.warning(this.logger_,"Can't merge single cell"),!1;for(var r=e;n>=r;r++)for(var s=t;i>=s;s++){if(o=this.rows[r].columns[s],o.startRow<e||o.endRow>n||o.startCol<t||o.endCol>i)return goog.log.warning(this.logger_,"Can't merge cells: the cell in row "+r+", column "+s+"extends outside the supplied rectangle."),!1;a.push(o)}for(var l=a[0],c=l.element,u=this.dom_.getDocument(),r=1;o=a[r];r++){var d=o.element;if(d.parentNode&&d!=c){c.lastChild&&c.lastChild.nodeType==goog.dom.NodeType.TEXT&&c.appendChild(u.createTextNode(" "));for(var h;h=d.firstChild;)c.appendChild(h);d.parentNode.removeChild(d)}}return l.setColSpan(i-t+1),l.setRowSpan(n-e+1),i>t&&(c.removeAttribute("width"),c.style.width=null),this.refresh(),!0},GoogTable.prototype.splitCell=function(e,t){for(var n=this.rows[e],i=n.columns[t],o=[],a=0;a<i.rowSpan;a++)for(var r=0;r<i.colSpan;r++)if(a>0||r>0){var s=this.createEmptyTd();this.insertCellElement(s,e+a,t+r),o.push(s)}return i.setColSpan(1),i.setRowSpan(1),this.refresh(),o},GoogTable.prototype.insertCellElement=function(e,t,n){for(var i,o=this.rows[t],a=null,r=n;i=o.columns[r];r+=i.colSpan)if(i.startRow==t){a=i.element;break}o.element.insertBefore(e,a)},GoogTable.prototype.createEmptyTd=function(){return this.dom_.createDom(goog.dom.TagName.TD,{},goog.string.Unicode.NBSP)},GoogTableRow=function(e,t){this.index=t,this.element=e,this.columns=[]},GoogTableCell=function(e,t,n){this.element=e,this.colSpan=parseInt(e.colSpan,10)||1,this.rowSpan=parseInt(e.rowSpan,10)||1,this.startRow=t,this.startCol=n,this.updateCoordinates_()},GoogTableCell.prototype.updateCoordinates_=function(){this.endCol=this.startCol+this.colSpan-1,this.endRow=this.startRow+this.rowSpan-1},GoogTableCell.prototype.setColSpan=function(e){e!=this.colSpan&&(e>1?this.element.colSpan=e:(this.element.colSpan=1,this.element.removeAttribute("colSpan")),this.colSpan=e,this.updateCoordinates_())},GoogTableCell.prototype.setRowSpan=function(e){e!=this.rowSpan&&(e>1?this.element.rowSpan=e.toString():(this.element.rowSpan="1",this.element.removeAttribute("rowSpan")),this.rowSpan=e,this.updateCoordinates_())},GoogTable.OPTIMUM_EMPTY_CELL_WIDTH=60,GoogTable.OPTIMUM_MAX_NEW_TABLE_WIDTH=600,GoogTable.DEFAULT_BORDER_COLOR="#888",GoogTable.createDomTable=function(e,t,n,i){var o={borderWidth:"1",borderColor:GoogTable.DEFAULT_BORDER_COLOR};for(var a in i)o[a]=i[a];for(var r,s=new goog.dom.DomHelper(e),l=s.createTable(n,t,!0),c=10,u=Math.max(c,Math.min(GoogTable.OPTIMUM_EMPTY_CELL_WIDTH,GoogTable.OPTIMUM_MAX_NEW_TABLE_WIDTH/t)),d=l.getElementsByTagName(goog.dom.TagName.TD),h=0;r=d[h];h++)r.style.width=u+"px";return goog.style.setStyle(l,{borderCollapse:"collapse",borderColor:o.borderColor,borderWidth:o.borderWidth+"px"}),l.border=o.borderWidth,l.setAttribute("bordercolor",o.borderColor),l.setAttribute("cellspacing","0"),l},function(){function e(){this.returnValue=!1}function t(){this.cancelBubble=!0}var n,i,o=0,a=[],r={},s={},l={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},c=/[<>&\"\']/g,u=window.setTimeout,d={};!function(e){var t,n,i,o=e.split(/,/);for(t=0;t<o.length;t+=2)for(i=o[t+1].split(/ /),n=0;n<i.length;n++)s[i[n]]=o[t]}("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mpga mpega mp2 mp3,audio/x-wav,wav,audio/mp4,m4a,image/bmp,bmp,image/gif,gif,image/jpeg,jpeg jpg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe");var h={VERSION:"1.5.7",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,IMAGE_FORMAT_ERROR:-700,IMAGE_MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:s,ua:function(){var e,t,n,i=navigator,o=i.userAgent,a=i.vendor;return e=/WebKit/.test(o),n=e&&-1!==a.indexOf("Apple"),t=window.opera&&window.opera.buildNumber,{windows:-1!==navigator.platform.indexOf("Win"),android:/Android/.test(o),ie:!e&&!t&&/MSIE/gi.test(o)&&/Explorer/gi.test(i.appName),webkit:e,gecko:!e&&/Gecko/.test(o),safari:n,opera:!!t}}(),typeOf:function(e){return{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},extend:function(e){return h.each(arguments,function(t,n){n>0&&h.each(t,function(t,n){e[n]=t})}),e},cleanName:function(e){var t,n;for(n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<n.length;t+=2)e=e.replace(n[t],n[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,"")},addRuntime:function(e,t){return t.name=e,a[e]=t,a.push(t),t},guid:function(){var e,t=(new Date).getTime().toString(32);for(e=0;5>e;e++)t+=Math.floor(65535*Math.random()).toString(32);return(h.guidPrefix||"p")+t+(o++).toString(32)},buildUrl:function(e,t){var n="";return h.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e},each:function(e,t){var i,o,a;if(e)if(i=e.length,i===n){for(o in e)if(e.hasOwnProperty(o)&&t(e[o],o)===!1)return}else for(a=0;i>a;a++)if(t(e[a],a)===!1)return},formatSize:function(e){return e===n||/\D/.test(e)?h.translate("N/A"):e>1073741824?Math.round(e/1073741824,1)+" GB":e>1048576?Math.round(e/1048576,1)+" MB":e>1024?Math.round(e/1024,1)+" KB":e+" b"},getPos:function(e,t){function n(e){var t,n,i=0,o=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===l.compatMode?l.documentElement:l.body,i=n.left+t.scrollLeft,o=n.top+t.scrollTop),{x:i,y:o}}var i,o,a,r=0,s=0,l=document;if(e=e,t=t||l.body,e&&e.getBoundingClientRect&&h.ua.ie&&(!l.documentMode||l.documentMode<8))return o=n(e),a=n(t),{x:o.x-a.x,y:o.y-a.y};for(i=e;i&&i!=t&&i.nodeType;)r+=i.offsetLeft||0,s+=i.offsetTop||0,i=i.offsetParent;for(i=e.parentNode;i&&i!=t&&i.nodeType;)r-=i.scrollLeft||0,s-=i.scrollTop||0,i=i.parentNode;return{x:r,y:s}},getSize:function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}},parseSize:function(e){var t;return"string"==typeof e&&(e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),t=e[2],e=+e[1],"g"==t&&(e*=1073741824),"m"==t&&(e*=1048576),"k"==t&&(e*=1024)),e},xmlEncode:function(e){return e?(""+e).replace(c,function(e){return l[e]?"&"+l[e]+";":e}):e},toArray:function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]=e[t];return n},inArray:function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n}return-1},addI18n:function(e){return h.extend(r,e)},translate:function(e){return r[e]||e},isEmptyObj:function(e){if(e===n)return!0;for(var t in e)return!1;return!0},hasClass:function(e,t){var n;return""==e.className?!1:(n=new RegExp("(^|\\s+)"+t+"(\\s+|$)"),n.test(e.className))},addClass:function(e,t){h.hasClass(e,t)||(e.className=""==e.className?t:e.className.replace(/\s+$/,"")+" "+t)},removeClass:function(e,t){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})},getStyle:function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},addEvent:function(o,a,r){var s,l,c;c=arguments[3],a=a.toLowerCase(),i===n&&(i="Plupload_"+h.guid()),o.addEventListener?(s=r,o.addEventListener(a,s,!1)):o.attachEvent&&(s=function(){var n=window.event;n.target||(n.target=n.srcElement),n.preventDefault=e,n.stopPropagation=t,r(n)},o.attachEvent("on"+a,s)),o[i]===n&&(o[i]=h.guid()),d.hasOwnProperty(o[i])||(d[o[i]]={}),l=d[o[i]],l.hasOwnProperty(a)||(l[a]=[]),l[a].push({func:s,orig:r,key:c})},removeEvent:function(e,t){var o,a,r;if("function"==typeof arguments[2]?a=arguments[2]:r=arguments[2],t=t.toLowerCase(),e[i]&&d[e[i]]&&d[e[i]][t]){o=d[e[i]][t];for(var s=o.length-1;s>=0&&(o[s].key!==r&&o[s].orig!==a||(e.removeEventListener?e.removeEventListener(t,o[s].func,!1):e.detachEvent&&e.detachEvent("on"+t,o[s].func),o[s].orig=null,o[s].func=null,o.splice(s,1),a===n));s--);if(o.length||delete d[e[i]][t],h.isEmptyObj(d[e[i]])){delete d[e[i]];try{delete e[i]}catch(l){e[i]=n}}}},removeAllEvents:function(e){var t=arguments[1];e[i]!==n&&e[i]&&h.each(d[e[i]],function(n,i){h.removeEvent(e,i,t)})}};h.Uploader=function(e){function t(){var e,t,n=0;if(this.state==h.STARTED){for(t=0;t<l.length;t++)e||l[t].status!=h.QUEUED?n++:(e=l[t],e.status=h.UPLOADING,this.trigger("BeforeUpload",e)&&this.trigger("UploadFile",e));n==l.length&&(this.stop(),this.trigger("UploadComplete",l))}}function i(){var e,t;for(o.reset(),e=0;e<l.length;e++)t=l[e],t.size!==n?(o.size+=t.size,o.loaded+=t.loaded):o.size=n,t.status==h.DONE?o.uploaded++:t.status==h.FAILED?o.failed++:o.queued++;o.size===n?o.percent=l.length>0?Math.ceil(100*(o.uploaded/l.length)):0:(o.bytesPerSec=Math.ceil(o.loaded/((+new Date-r||1)/1e3)),o.percent=o.size>0?Math.ceil(100*(o.loaded/o.size)):0)}var o,r,s={},l=[],c=!1;o=new h.QueueProgress,e=h.extend({chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",filters:[]},e),h.extend(this,{state:h.STOPPED,runtime:"",features:{},files:l,settings:e,total:o,id:h.guid(),init:function(){function o(){var e,t,n,i=c[f++];if(i){if(e=i.getFeatures(),t=p.settings.required_features)for(t=t.split(","),n=0;n<t.length;n++)if(!e[t[n]])return o(),void 0;i.init(p,function(t){t&&t.success?(p.features=e,p.runtime=i.name,p.trigger("Init",{runtime:i.name}),p.trigger("PostInit"),p.refresh()):o()})}else p.trigger("Error",{code:h.INIT_ERROR,message:h.translate("Init error.")})}var s,c,d,p=this,f=0;if("function"==typeof e.preinit?e.preinit(p):h.each(e.preinit,function(e,t){p.bind(t,e)}),e.page_url=e.page_url||document.location.pathname.replace(/\/[^\/]+$/g,"/"),/^(\w+:\/\/|\/)/.test(e.url)||(e.url=e.page_url+e.url),e.chunk_size=h.parseSize(e.chunk_size),e.max_file_size=h.parseSize(e.max_file_size),p.bind("FilesAdded",function(t,i){var o,a,r,s=0,c=e.filters;for(c&&c.length&&(r=[],h.each(c,function(e){h.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?r.push("\\.*"):r.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),r=new RegExp(r.join("|")+"$","i")),o=0;o<i.length;o++)a=i[o],a.loaded=0,a.percent=0,a.status=h.QUEUED,!r||r.test(a.name)?a.size!==n&&a.size>e.max_file_size?t.trigger("Error",{code:h.FILE_SIZE_ERROR,message:h.translate("File size error."),file:a}):(l.push(a),s++):t.trigger("Error",{code:h.FILE_EXTENSION_ERROR,message:h.translate("File extension error."),file:a});return s?(u(function(){p.trigger("QueueChanged"),p.refresh()},1),void 0):!1}),e.unique_names&&p.bind("UploadFile",function(e,t){var n=t.name.match(/\.([^.]+)$/),i="tmp";n&&(i=n[1]),t.target_name=t.id+"."+i}),p.bind("UploadProgress",function(e,t){t.percent=t.size>0?Math.ceil(100*(t.loaded/t.size)):100,i()}),p.bind("StateChanged",function(e){if(e.state==h.STARTED)r=+new Date;else if(e.state==h.STOPPED)for(s=e.files.length-1;s>=0;s--)e.files[s].status==h.UPLOADING&&(e.files[s].status=h.QUEUED,i())}),p.bind("QueueChanged",i),p.bind("Error",function(e,n){n.file&&(n.file.status=h.FAILED,i(),e.state==h.STARTED&&u(function(){t.call(p)},1))}),p.bind("FileUploaded",function(e,n){n.status=h.DONE,n.loaded=n.size,e.trigger("UploadProgress",n),u(function(){t.call(p)},1)}),e.runtimes)for(c=[],d=e.runtimes.split(/\s?,\s?/),s=0;s<d.length;s++)a[d[s]]&&c.push(a[d[s]]);else c=a;o(),"function"==typeof e.init?e.init(p):h.each(e.init,function(e,t){p.bind(t,e)})},refresh:function(){this.trigger("Refresh")},start:function(){l.length&&this.state!=h.STARTED&&(this.state=h.STARTED,this.trigger("StateChanged"),t.call(this))},stop:function(){this.state!=h.STOPPED&&(this.state=h.STOPPED,this.trigger("CancelUpload"),this.trigger("StateChanged"))},disableBrowse:function(){c=arguments[0]!==n?arguments[0]:!0,this.trigger("DisableBrowse",c)},getFile:function(e){var t;for(t=l.length-1;t>=0;t--)if(l[t].id===e)return l[t]},removeFile:function(e){var t;for(t=l.length-1;t>=0;t--)if(l[t].id===e.id)return this.splice(t,1)[0]},splice:function(e,t){var i;return i=l.splice(e===n?0:e,t===n?l.length:t),this.trigger("FilesRemoved",i),this.trigger("QueueChanged"),i},trigger:function(e){var t,n,i=s[e.toLowerCase()];if(i)for(n=Array.prototype.slice.call(arguments),n[0]=this,t=0;t<i.length;t++)if(i[t].func.apply(i[t].scope,n)===!1)return!1;return!0},hasEventListener:function(e){return!!s[e.toLowerCase()]},bind:function(e,t,n){var i;e=e.toLowerCase(),i=s[e]||[],i.push({func:t,scope:n||this}),s[e]=i},unbind:function(e){e=e.toLowerCase();var t,i=s[e],o=arguments[1];if(i){if(o!==n){for(t=i.length-1;t>=0;t--)if(i[t].func===o){i.splice(t,1);break}}else i=[];i.length||delete s[e]}},unbindAll:function(){var e=this;h.each(s,function(t,n){e.unbind(n)})},destroy:function(){this.stop(),this.trigger("Destroy"),this.unbindAll()}})},h.File=function(e,t,n){var i=this;i.id=e,i.name=t,i.size=n,i.loaded=0,i.percent=0,i.status=0},h.Runtime=function(){this.getFeatures=function(){},this.init=function(){}},h.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},h.runtimes={},window.plupload=h}(),function(e,t,n){function i(e){return t.getElementById(e)}n.runtimes.Html4=n.addRuntime("html4",{getFeatures:function(){return{multipart:!0,triggerDialog:n.ua.gecko&&e.FormData||n.ua.webkit}},init:function(o,a){o.bind("Init",function(a){function r(){var e,s,l,c;u=n.guid(),v.push(u),e=t.createElement("form"),e.setAttribute("id","form_"+u),e.setAttribute("method","post"),e.setAttribute("enctype","multipart/form-data"),e.setAttribute("encoding","multipart/form-data"),e.setAttribute("target",a.id+"_iframe"),e.style.position="absolute",s=t.createElement("input"),s.setAttribute("id","input_"+u),s.setAttribute("type","file"),s.setAttribute("accept",b),s.setAttribute("size",1),c=i(a.settings.browse_button),a.features.triggerDialog&&c&&n.addEvent(i(a.settings.browse_button),"click",function(e){s.disabled||s.click(),e.preventDefault()},a.id),n.extend(s.style,{width:"100%",height:"100%",opacity:0,fontSize:"99px",cursor:"pointer"}),n.extend(e.style,{overflow:"hidden"}),l=a.settings.shim_bgcolor,l&&(e.style.background=l),y&&n.extend(s.style,{filter:"alpha(opacity=0)"}),n.addEvent(s,"change",function(t){var l,d=t.target,h=[];d.value&&(i("form_"+u).style.top="-1048575px",l=d.value.replace(/\\/g,"/"),l=l.substring(l.length,l.lastIndexOf("/")+1),h.push(new n.File(u,l)),a.features.triggerDialog?n.removeEvent(c,"click",a.id):n.removeAllEvents(e,a.id),n.removeEvent(s,"change",a.id),r(),h.length&&o.trigger("FilesAdded",h))},a.id),e.appendChild(s),g.appendChild(e),a.refresh()}function s(){var i=t.createElement("div");i.innerHTML='<iframe id="'+a.id+'_iframe" name="'+a.id+'_iframe" src="'+m+':&quot;&quot;" style="display:none"></iframe>',l=i.firstChild,g.appendChild(l),n.addEvent(l,"load",function(t){var i,o,r=t.target;if(c){try{i=r.contentWindow.document||r.contentDocument||e.frames[r.id].document}catch(s){return a.trigger("Error",{code:n.SECURITY_ERROR,message:n.translate("Security error."),file:c}),void 0}o=i.documentElement.innerText||i.documentElement.textContent,o&&(c.status=n.DONE,c.loaded=1025,c.percent=100,a.trigger("UploadProgress",c),a.trigger("FileUploaded",c,{response:o}))}},a.id)}var l,c,u,d,h,p,f,g=t.body,m="javascript",v=[],y=/MSIE/.test(navigator.userAgent),b=[],w=a.settings.filters;e:for(d=0;d<w.length;d++)for(h=w[d].extensions.split(/,/),f=0;f<h.length;f++){if("*"===h[f]){b=[];break e}p=n.mimeTypes[h[f]],p&&-1===n.inArray(p,b)&&b.push(p)}b=b.join(","),a.settings.container&&(g=i(a.settings.container),"static"===n.getStyle(g,"position")&&(g.style.position="relative")),a.bind("UploadFile",function(e,o){var a,r;o.status!=n.DONE&&o.status!=n.FAILED&&e.state!=n.STOPPED&&(a=i("form_"+o.id),r=i("input_"+o.id),r.setAttribute("name",e.settings.file_data_name),a.setAttribute("action",e.settings.url),n.each(n.extend({name:o.target_name||o.name},e.settings.multipart_params),function(e,i){var o=t.createElement("input");n.extend(o,{type:"hidden",name:i,value:e}),a.insertBefore(o,a.firstChild)}),c=o,i("form_"+u).style.top="-1048575px",a.submit())}),a.bind("FileUploaded",function(e){e.refresh()}),a.bind("StateChanged",function(t){t.state==n.STARTED?s():t.state==n.STOPPED&&e.setTimeout(function(){n.removeEvent(l,"load",t.id),l.parentNode&&l.parentNode.removeChild(l)},0),n.each(t.files,function(e){if(e.status===n.DONE||e.status===n.FAILED){var t=i("form_"+e.id);t&&t.parentNode.removeChild(t)}})}),a.bind("Refresh",function(e){var o,a,r,s,l,c,d,h,p;o=i(e.settings.browse_button),o&&(l=n.getPos(o,i(e.settings.container)),c=n.getSize(o),d=i("form_"+u),h=i("input_"+u),n.extend(d.style,{top:l.y+"px",left:l.x+"px",width:c.w+"px",height:c.h+"px"}),e.features.triggerDialog&&("static"===n.getStyle(o,"position")&&n.extend(o.style,{position:"relative"}),p=parseInt(o.style.zIndex,10),isNaN(p)&&(p=0),n.extend(o.style,{zIndex:p}),n.extend(d.style,{zIndex:p-1})),r=e.settings.browse_button_hover,s=e.settings.browse_button_active,a=e.features.triggerDialog?o:d,r&&(n.addEvent(a,"mouseover",function(){n.addClass(o,r)},e.id),n.addEvent(a,"mouseout",function(){n.removeClass(o,r)},e.id)),s&&(n.addEvent(a,"mousedown",function(){n.addClass(o,s)},e.id),n.addEvent(t.body,"mouseup",function(){n.removeClass(o,s)},e.id)))}),o.bind("FilesRemoved",function(e,t){var n,o;for(n=0;n<t.length;n++)o=i("form_"+t[n].id),o&&o.parentNode.removeChild(o)}),o.bind("DisableBrowse",function(e,n){var i=t.getElementById("input_"+u);i&&(i.disabled=n)}),o.bind("Destroy",function(e){var o,a,r,s={inputContainer:"form_"+u,inputFile:"input_"+u,browseButton:e.settings.browse_button};for(o in s)a=i(s[o]),a&&n.removeAllEvents(a,e.id);n.removeAllEvents(t.body,e.id),n.each(v,function(e){r=i("form_"+e),r&&r.parentNode.removeChild(r)})}),r()}),a({success:!0})}})}(window,document,plupload),function(e,t,n,o){function a(e){var n=e.naturalWidth,i=e.naturalHeight;if(n*i>1048576){var o=t.createElement("canvas");o.width=o.height=1;var a=o.getContext("2d");return a.drawImage(e,-n+1,0),0===a.getImageData(0,0,1,1).data[3]}return!1}function r(e,n,i){var o=t.createElement("canvas");o.width=1,o.height=i;var a=o.getContext("2d");a.drawImage(e,0,0);for(var r=a.getImageData(0,0,1,i).data,s=0,l=i,c=i;c>s;){var u=r[4*(c-1)+3];0===u?l=c:s=c,c=l+s>>1}var d=c/i;return 0===d?1:d}function s(e,n,i){var o=e.naturalWidth,s=e.naturalHeight,l=i.width,c=i.height,u=n.getContext("2d");u.save();var d=a(e);d&&(o/=2,s/=2);var h=1024,p=t.createElement("canvas");p.width=p.height=h;for(var f=p.getContext("2d"),g=r(e,o,s),m=0;s>m;){for(var v=m+h>s?s-m:h,y=0;o>y;){var b=y+h>o?o-y:h;f.clearRect(0,0,h,h),f.drawImage(e,-y,-m);var w=y*l/o<<0,C=Math.ceil(b*l/o),T=m*c/s/g<<0,E=Math.ceil(v*c/s/g);u.drawImage(p,0,0,b,v,w,T,C,E),y+=h}m+=h}u.restore(),p=f=null}function l(t,n){var i;return"FileReader"in e?(i=new FileReader,i.readAsDataURL(t),i.onload=function(){n(i.result)},void 0):n(t.getAsDataURL())}function c(t,n){var i;return"FileReader"in e?(i=new FileReader,i.readAsBinaryString(t),i.onload=function(){n(i.result)},void 0):n(t.getAsBinary())}function u(e,n,i,o){var a,r,c,u=this;l(g[e.id],function(l){a=t.createElement("canvas"),a.style.display="none",t.body.appendChild(a),r=new Image,r.onerror=r.onabort=function(){o({success:!1})},r.onload=function(){var t,d,f,g;if(n.width||(n.width=r.width),n.height||(n.height=r.height),c=Math.min(n.width/r.width,n.height/r.height),1>c)t=Math.round(r.width*c),d=Math.round(r.height*c);else{if(!n.quality||"image/jpeg"!==i)return o({success:!1}),void 0;t=r.width,d=r.height}if(a.width=t,a.height=d,s(r,a,{width:t,height:d}),"image/jpeg"===i&&(f=new h(atob(l.substring(l.indexOf("base64,")+7))),f.headers&&f.headers.length&&(g=new p,g.init(f.get("exif")[0])&&(g.setExif("PixelXDimension",t),g.setExif("PixelYDimension",d),f.set("exif",g.getBinary()),u.hasEventListener("ExifData")&&u.trigger("ExifData",e,g.EXIF()),u.hasEventListener("GpsData")&&u.trigger("GpsData",e,g.GPS())))),n.quality&&"image/jpeg"===i)try{l=a.toDataURL(i,n.quality/100)}catch(m){l=a.toDataURL(i)}else l=a.toDataURL(i);l=l.substring(l.indexOf("base64,")+7),l=atob(l),f&&f.headers&&f.headers.length&&(l=f.restore(l),f.purge()),a.parentNode.removeChild(a),o({success:!0,data:l})},r.src=l})}function d(){function e(e,t){var n,o=a?0:-8*(t-1),r=0;for(n=0;t>n;n++)r|=i.charCodeAt(e+n)<<Math.abs(o+8*n);return r}function t(e,t,n){var n=3===arguments.length?n:i.length-t-1;i=i.substr(0,t)+e+i.substr(n+t)}function n(e,n,i){var o,r="",s=a?0:-8*(i-1);for(o=0;i>o;o++)r+=String.fromCharCode(255&n>>Math.abs(s+8*o));t(r,e,i)}var i,a=!1;return{II:function(e){return e===o?a:(a=e,void 0)},init:function(e){a=!1,i=e},SEGMENT:function(e,n,o){switch(arguments.length){case 1:return i.substr(e,i.length-e-1);case 2:return i.substr(e,n);case 3:t(o,e,n);break;default:return i}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(t,i){return i===o?e(t,4):(n(t,i,4),void 0)},SLONG:function(t){var n=e(t,4);return n>2147483647?n-4294967296:n},STRING:function(t,n){var i="";for(n+=t;n>t;t++)i+=String.fromCharCode(e(t,1));return i}}}function h(e){var t,n,i,a={65505:{app:"EXIF",name:"APP1",signature:"Exif\0"},65506:{app:"ICC",name:"APP2",signature:"ICC_PROFILE\0"},65517:{app:"IPTC",name:"APP13",signature:"Photoshop 3.0\0"}},r=[],s=o,l=0;if(t=new d,t.init(e),65496===t.SHORT(0)){for(n=2,i=Math.min(1048576,e.length);i>=n;)if(s=t.SHORT(n),s>=65488&&65495>=s)n+=2;else{if(65498===s||65497===s)break;l=t.SHORT(n+2)+2,a[s]&&t.STRING(n+4,a[s].signature.length)===a[s].signature&&r.push({hex:s,app:a[s].app.toUpperCase(),name:a[s].name.toUpperCase(),start:n,length:l,segment:t.SEGMENT(n,l)}),n+=l}return t.init(null),{headers:r,restore:function(e){t.init(e);var i=new h(e);if(!i.headers)return!1;for(var o=i.headers.length;o>0;o--){var a=i.headers[o-1];t.SEGMENT(a.start,a.length,"")}i.purge(),n=65504==t.SHORT(2)?4+t.SHORT(4):2;for(var o=0,s=r.length;s>o;o++)t.SEGMENT(n,0,r[o].segment),n+=r[o].length;return t.SEGMENT()},get:function(e){for(var t=[],n=0,i=r.length;i>n;n++)r[n].app===e.toUpperCase()&&t.push(r[n].segment);return t},set:function(e,t){var n=[];"string"==typeof t?n.push(t):n=t;for(var i=ii=0,o=r.length;o>i&&(r[i].app===e.toUpperCase()&&(r[i].segment=n[ii],r[i].length=n[ii].length,ii++),!(ii>=n.length));i++);},purge:function(){r=[],t.init(null)}}}}function p(){function e(e,t){var n,i,a,s,u,d,h,p,f=r.SHORT(e),g=[],m={};for(n=0;f>n;n++)if(h=d=e+12*n+2,a=t[r.SHORT(h)],a!==o){switch(s=r.SHORT(h+=2),u=r.LONG(h+=2),h+=4,g=[],s){case 1:case 7:for(u>4&&(h=r.LONG(h)+c.tiffHeader),i=0;u>i;i++)g[i]=r.BYTE(h+i);break;case 2:u>4&&(h=r.LONG(h)+c.tiffHeader),m[a]=r.STRING(h,u-1);continue;case 3:for(u>2&&(h=r.LONG(h)+c.tiffHeader),i=0;u>i;i++)g[i]=r.SHORT(h+2*i);break;case 4:for(u>1&&(h=r.LONG(h)+c.tiffHeader),i=0;u>i;i++)g[i]=r.LONG(h+4*i);break;case 5:for(h=r.LONG(h)+c.tiffHeader,i=0;u>i;i++)g[i]=r.LONG(h+4*i)/r.LONG(h+4*i+4);break;case 9:for(h=r.LONG(h)+c.tiffHeader,i=0;u>i;i++)g[i]=r.SLONG(h+4*i);break;case 10:for(h=r.LONG(h)+c.tiffHeader,i=0;u>i;i++)g[i]=r.SLONG(h+4*i)/r.SLONG(h+4*i+4);break;default:continue}p=1==u?g[0]:g,m[a]=l.hasOwnProperty(a)&&"object"!=typeof p?l[a][p]:p}return m}function t(){var t=o,n=c.tiffHeader;return r.II(18761==r.SHORT(n)),42!==r.SHORT(n+=2)?!1:(c.IFD0=c.tiffHeader+r.LONG(n+=2),t=e(c.IFD0,s.tiff),c.exifIFD="ExifIFDPointer"in t?c.tiffHeader+t.ExifIFDPointer:o,c.gpsIFD="GPSInfoIFDPointer"in t?c.tiffHeader+t.GPSInfoIFDPointer:o,!0)}function a(e,t,n){var o,a,l,u=0;if("string"==typeof t){var d=s[e.toLowerCase()];for(hex in d)if(d[hex]===t){t=hex;break}}for(o=c[e.toLowerCase()+"IFD"],a=r.SHORT(o),i=0;a>i;i++)if(l=o+12*i+2,r.SHORT(l)==t){u=l+8;break}return u?(r.LONG(u,n),!0):!1}var r,s,l,c={};return r=new d,s={tiff:{274:"Orientation",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return c={tiffHeader:10},e!==o&&e.length?(r.init(e),65505===r.SHORT(0)&&"EXIF\0"===r.STRING(4,5).toUpperCase()?t():!1):!1},EXIF:function(){var t;if(t=e(c.exifIFD,s.exif),t.ExifVersion&&"array"===n.typeOf(t.ExifVersion)){for(var i=0,o="";i<t.ExifVersion.length;i++)o+=String.fromCharCode(t.ExifVersion[i]);t.ExifVersion=o}return t},GPS:function(){var t;return t=e(c.gpsIFD,s.gps),t.GPSVersionID&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:a("exif",e,t)},getBinary:function(){return r.SEGMENT()}}}var f,g={};n.runtimes.Html5=n.addRuntime("html5",{getFeatures:function(){var i,o,a,r,s,l;return o=a=s=l=!1,e.XMLHttpRequest&&(i=new XMLHttpRequest,a=!!i.upload,o=!(!i.sendAsBinary&&!i.upload)),o&&(r=!!(i.sendAsBinary||e.Uint8Array&&e.ArrayBuffer),s=!(!File||!File.prototype.getAsDataURL&&!e.FileReader||!r),l=!(!File||!(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice))),f=n.ua.safari&&n.ua.windows,{html5:o,dragdrop:function(){var e=t.createElement("div");return"draggable"in e||"ondragstart"in e&&"ondrop"in e}(),jpgresize:s,pngresize:s,multipart:s||!!e.FileReader||!!e.FormData,canSendBinary:r,cantSendBlobInFormData:!(!(n.ua.gecko&&e.FormData&&e.FileReader)||FileReader.prototype.readAsArrayBuffer)||n.ua.android,progress:a,chunks:l,multi_selection:!(n.ua.safari&&n.ua.windows),triggerDialog:n.ua.gecko&&e.FormData||n.ua.webkit}
},init:function(i,o){function a(e){var t,o,a,r=[],s={};for(o=0;o<e.length;o++)t=e[o],s[t.name]&&n.ua.safari&&n.ua.windows||(s[t.name]=!0,a=n.guid(),g[a]=t,r.push(new n.File(a,t.fileName||t.name,t.fileSize||t.size)));r.length&&i.trigger("FilesAdded",r)}var r,s;return r=this.getFeatures(),r.html5?(i.bind("Init",function(e){var o,r,s,l,c,u,d,h=[],p=e.settings.filters,f=t.body;o=t.createElement("div"),o.id=e.id+"_html5_container",n.extend(o.style,{position:"absolute",background:i.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",zIndex:99999,opacity:i.settings.shim_bgcolor?"":0}),o.className="plupload html5",i.settings.container&&(f=t.getElementById(i.settings.container),"static"===n.getStyle(f,"position")&&(f.style.position="relative")),f.appendChild(o);e:for(s=0;s<p.length;s++)for(c=p[s].extensions.split(/,/),l=0;l<c.length;l++){if("*"===c[l]){h=[];break e}u=n.mimeTypes[c[l]],u&&-1===n.inArray(u,h)&&h.push(u)}if(o.innerHTML='<input id="'+i.id+'_html5"  style="font-size:999px" type="file" accept="'+h.join(",")+'" '+(i.settings.multi_selection&&i.features.multi_selection?'multiple="multiple"':"")+" />",o.scrollTop=100,d=t.getElementById(i.id+"_html5"),e.features.triggerDialog?n.extend(d.style,{position:"absolute",width:"100%",height:"100%"}):n.extend(d.style,{cssFloat:"right",styleFloat:"right"}),d.onchange=function(){a(this.files),this.value=""},r=t.getElementById(e.settings.browse_button)){var g=e.settings.browse_button_hover,m=e.settings.browse_button_active,v=e.features.triggerDialog?r:o;g&&(n.addEvent(v,"mouseover",function(){n.addClass(r,g)},e.id),n.addEvent(v,"mouseout",function(){n.removeClass(r,g)},e.id)),m&&(n.addEvent(v,"mousedown",function(){n.addClass(r,m)},e.id),n.addEvent(t.body,"mouseup",function(){n.removeClass(r,m)},e.id)),e.features.triggerDialog&&n.addEvent(r,"click",function(n){var i=t.getElementById(e.id+"_html5");i&&!i.disabled&&i.click(),n.preventDefault()},e.id)}}),i.bind("PostInit",function(){var e=t.getElementById(i.settings.drop_element);if(e){if(f)return n.addEvent(e,"dragenter",function(){var o,r,s;o=t.getElementById(i.id+"_drop"),o||(o=t.createElement("input"),o.setAttribute("type","file"),o.setAttribute("id",i.id+"_drop"),o.setAttribute("multiple","multiple"),n.addEvent(o,"change",function(){a(this.files),n.removeEvent(o,"change",i.id),o.parentNode.removeChild(o)},i.id),n.addEvent(o,"dragover",function(e){e.stopPropagation()},i.id),e.appendChild(o)),r=n.getPos(e,t.getElementById(i.settings.container)),s=n.getSize(e),"static"===n.getStyle(e,"position")&&n.extend(e.style,{position:"relative"}),n.extend(o.style,{position:"absolute",display:"block",top:0,left:0,width:s.w+"px",height:s.h+"px",opacity:0})},i.id),void 0;n.addEvent(e,"dragover",function(e){e.preventDefault()},i.id),n.addEvent(e,"drop",function(e){var t=e.dataTransfer;t&&t.files&&a(t.files),e.preventDefault()},i.id)}}),i.bind("Refresh",function(e){var o,a,r,s,l;o=t.getElementById(i.settings.browse_button),o&&(a=n.getPos(o,t.getElementById(e.settings.container)),r=n.getSize(o),s=t.getElementById(i.id+"_html5_container"),n.extend(s.style,{top:a.y+"px",left:a.x+"px",width:r.w+"px",height:r.h+"px"}),i.features.triggerDialog&&("static"===n.getStyle(o,"position")&&n.extend(o.style,{position:"relative"}),l=parseInt(n.getStyle(o,"zIndex"),10),isNaN(l)&&(l=0),n.extend(o.style,{zIndex:l}),n.extend(s.style,{zIndex:l-1})))}),i.bind("DisableBrowse",function(e,n){var i=t.getElementById(e.id+"_html5");i&&(i.disabled=n)}),i.bind("CancelUpload",function(){s&&s.abort&&s.abort()}),i.bind("UploadFile",function(t,i){function o(e,t,n){var i;if(!File.prototype.slice)return(i=File.prototype.webkitSlice||File.prototype.mozSlice)?i.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(o){return e.slice(t,n-t)}}function a(a){function l(){function h(e){if(s.sendAsBinary)s.sendAsBinary(e);else if(t.features.canSendBinary){for(var n=new Uint8Array(e.length),i=0;i<e.length;i++)n[i]=255&e.charCodeAt(i);s.send(n.buffer)}}function p(o){var a,d=0,p="----pluploadboundary"+n.guid(),C="--",T="\r\n",E="";if(s=new XMLHttpRequest,s.upload&&(s.upload.onprogress=function(e){i.loaded=Math.min(i.size,u+e.loaded-d),t.trigger("UploadProgress",i)}),s.onreadystatechange=function(){var e,r;if(4==s.readyState&&t.state!==n.STOPPED){try{e=s.status}catch(d){e=0}if(e>=400)t.trigger("Error",{code:n.HTTP_ERROR,message:n.translate("HTTP Error."),file:i,status:e});else{if(g){if(r={chunk:c,chunks:g,response:s.responseText,status:e},t.trigger("ChunkUploaded",i,r),u+=y,r.cancelled)return i.status=n.FAILED,void 0;i.loaded=Math.min(i.size,(c+1)*v)}else i.loaded=i.size;t.trigger("UploadProgress",i),o=f=a=E=null,!g||++c>=g?(i.status=n.DONE,t.trigger("FileUploaded",i,{response:s.responseText,status:e})):l()}}},t.settings.multipart&&r.multipart){if(m.name=i.target_name||i.name,s.open("post",w,!0),n.each(t.settings.headers,function(e,t){s.setRequestHeader(t,e)}),"string"!=typeof o&&e.FormData)return a=new FormData,n.each(n.extend(m,t.settings.multipart_params),function(e,t){a.append(t,e)}),a.append(t.settings.file_data_name,o),s.send(a),void 0;if("string"==typeof o)return s.setRequestHeader("Content-Type","multipart/form-data; boundary="+p),n.each(n.extend(m,t.settings.multipart_params),function(e,t){E+=C+p+T+'Content-Disposition: form-data; name="'+t+'"'+T+T,E+=unescape(encodeURIComponent(e))+T}),b=n.mimeTypes[i.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",E+=C+p+T+'Content-Disposition: form-data; name="'+t.settings.file_data_name+'"; filename="'+unescape(encodeURIComponent(i.name))+'"'+T+"Content-Type: "+b+T+T+o+T+C+p+C+T,d=E.length-o.length,o=E,h(o),void 0}w=n.buildUrl(t.settings.url,n.extend(m,t.settings.multipart_params)),s.open("post",w,!0),s.setRequestHeader("Content-Type","application/octet-stream"),n.each(t.settings.headers,function(e,t){s.setRequestHeader(t,e)}),"string"==typeof o?h(o):s.send(o)}var f,g,m,v,y,b,w=t.settings.url;i.status!=n.DONE&&i.status!=n.FAILED&&t.state!=n.STOPPED&&(m={name:i.target_name||i.name},d.chunk_size&&i.size>d.chunk_size&&(r.chunks||"string"==typeof a)?(v=d.chunk_size,g=Math.ceil(i.size/v),y=Math.min(v,i.size-c*v),f="string"==typeof a?a.substring(c*v,c*v+y):o(a,c*v,c*v+y),m.chunk=c,m.chunks=g):(y=i.size,f=a),t.settings.multipart&&r.multipart&&"string"!=typeof f&&e.FileReader&&r.cantSendBlobInFormData&&r.chunks&&t.settings.chunk_size?function(){var e=new FileReader;e.onload=function(){p(e.result),e=null},e.readAsBinaryString(f)}():p(f))}var c=0,u=0;l()}var l,d=t.settings;l=g[i.id],r.jpgresize&&t.settings.resize&&/\.(png|jpg|jpeg)$/i.test(i.name)?u.call(t,i,t.settings.resize,/\.png$/i.test(i.name)?"image/png":"image/jpeg",function(e){e.success?(i.size=e.data.length,a(e.data)):r.chunks?a(l):c(l,a)}):!r.chunks&&r.jpgresize?c(l,a):a(l)}),i.bind("Destroy",function(e){var i,o,a=t.body,r={inputContainer:e.id+"_html5_container",inputFile:e.id+"_html5",browseButton:e.settings.browse_button,dropElm:e.settings.drop_element};for(i in r)o=t.getElementById(r[i]),o&&n.removeAllEvents(o,e.id);n.removeAllEvents(t.body,e.id),e.settings.container&&(a=t.getElementById(e.settings.container)),a.removeChild(t.getElementById(r.inputContainer))}),o({success:!0}),void 0):(o({success:!1}),void 0)}})}(window,document,plupload),function(e,t,n,i){function o(e){return n.translate(e)||e}function a(e){e.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="plupload"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+o("Select files")+'</div><div class="plupload_header_text">'+o("Add files to the upload queue and click the start button.")+'</div></div></div><div class="plupload_content"><table class="plupload_filelist"><tr class="ui-widget-header plupload_filelist_header"><td class="plupload_cell plupload_file_name">'+o("Filename")+'</td><td class="plupload_cell plupload_file_status">'+o("Status")+'</td><td class="plupload_cell plupload_file_size">'+o("Size")+'</td><td class="plupload_cell plupload_file_action">&nbsp;</td></tr></table><div class="plupload_scroll"><table class="plupload_filelist_content"></table></div><table class="plupload_filelist"><tr class="ui-widget-header ui-widget-content plupload_filelist_footer"><td class="plupload_cell plupload_file_name"><div class="plupload_buttons"><!-- Visible --><a class="plupload_button plupload_add">'+o("Add Files")+'</a>&nbsp;<a class="plupload_button plupload_start">'+o("Start Upload")+'</a>&nbsp;<a class="plupload_button plupload_stop plupload_hidden">'+o("Stop Upload")+'</a>&nbsp;</div><div class="plupload_started plupload_hidden"><!-- Hidden --><div class="plupload_progress plupload_right"><div class="plupload_progress_container"></div></div><div class="plupload_cell plupload_upload_status"></div><div class="plupload_clearer">&nbsp;</div></div></td><td class="plupload_file_status"><span class="plupload_total_status">0%</span></td><td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td><td class="plupload_file_action"></td></tr></table></div></div></div><input class="plupload_count" value="0" type="hidden"></div>')}var r={};i.widget("ui.plupload",{contents_bak:"",runtime:null,options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",dragdrop:!0,multiple_queues:!0,buttons:{browse:!0,start:!0,stop:!0},autostart:!1,sortable:!1,rename:!1,max_file_count:0},FILE_COUNT_ERROR:-9001,_create:function(){var e,t,s=this;e=this.element.attr("id"),e||(e=n.guid(),this.element.attr("id",e)),this.id=e,this.contents_bak=this.element.html(),a(this.element),this.container=i(".plupload_container",this.element).attr("id",e+"_container"),this.filelist=i(".plupload_filelist_content",this.container).attr({id:e+"_filelist",unselectable:"on"}),this.browse_button=i(".plupload_add",this.container).attr("id",e+"_browse"),this.start_button=i(".plupload_start",this.container).attr("id",e+"_start"),this.stop_button=i(".plupload_stop",this.container).attr("id",e+"_stop"),i.ui.button&&(this.browse_button.button({icons:{primary:"ui-icon-circle-plus"}}),this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:!0}),this.stop_button.button({icons:{primary:"ui-icon-circle-close"}})),this.progressbar=i(".plupload_progress_container",this.container),i.ui.progressbar&&this.progressbar.progressbar(),this.counter=i(".plupload_count",this.element).attr({id:e+"_count",name:e+"_count"}),t=this.uploader=r[e]=new n.Uploader(i.extend({container:e,browse_button:e+"_browse"},this.options)),t.bind("Error",function(e,t){t.code===n.INIT_ERROR&&s.destroy()}),t.bind("Init",function(e,n){s.options.buttons.browse||(s.browse_button.button("disable").hide(),e.disableBrowse(!0)),s.options.buttons.start||s.start_button.button("disable").hide(),s.options.buttons.stop||s.stop_button.button("disable").hide(),!s.options.unique_names&&s.options.rename&&s._enableRenaming(),t.features.dragdrop&&s.options.dragdrop&&s._enableDragAndDrop(),s.container.attr("title",o("Using runtime: ")+(s.runtime=n.runtime)),s.start_button.click(function(e){i(this).button("option","disabled")||s.start(),e.preventDefault()}),s.stop_button.click(function(e){s.stop(),e.preventDefault()})}),s.options.max_file_count&&t.bind("FilesAdded",function(e,t){var n=[],i=t.length,a=e.files.length+i-s.options.max_file_count;a>0&&(n=t.splice(i-a,a),e.trigger("Error",{code:s.FILE_COUNT_ERROR,message:o("File count error."),file:n}))}),t.init(),t.bind("FilesAdded",function(e,t){s._trigger("selected",null,{up:e,files:t}),s.options.autostart&&setTimeout(function(){s.start()},10)}),t.bind("FilesRemoved",function(e,t){s._trigger("removed",null,{up:e,files:t})}),t.bind("QueueChanged",function(){s._updateFileList()}),t.bind("StateChanged",function(){s._handleState()}),t.bind("UploadFile",function(e,t){s._handleFileStatus(t)}),t.bind("FileUploaded",function(e,t){s._handleFileStatus(t),s._trigger("uploaded",null,{up:e,file:t})}),t.bind("UploadProgress",function(e,t){i("#"+t.id).find(".plupload_file_status").html(t.percent+"%").end().find(".plupload_file_size").html(n.formatSize(t.size)),s._handleFileStatus(t),s._updateTotalProgress(),s._trigger("progress",null,{up:e,file:t})}),t.bind("UploadComplete",function(e,t){s._trigger("complete",null,{up:e,files:t})}),t.bind("Error",function(e,t){var i,a,r=t.file;if(r){if(i="<strong>"+t.message+"</strong>",a=t.details)i+=" <br /><i>"+t.details+"</i>";else{switch(t.code){case n.FILE_EXTENSION_ERROR:a=o("File: %s").replace("%s",r.name);break;case n.FILE_SIZE_ERROR:a=o("File: %f, size: %s, max file size: %m").replace(/%([fsm])/g,function(e,t){switch(t){case"f":return r.name;case"s":return r.size;case"m":return n.parseSize(s.options.max_file_size)}});break;case s.FILE_COUNT_ERROR:a=o("Upload element accepts only %d file(s) at a time. Extra files were stripped.").replace("%d",s.options.max_file_count);break;case n.IMAGE_FORMAT_ERROR:a=n.translate("Image format either wrong or not supported.");break;case n.IMAGE_MEMORY_ERROR:a=n.translate("Runtime ran out of available memory.");break;case n.IMAGE_DIMENSIONS_ERROR:a=n.translate("Resoultion out of boundaries! <b>%s</b> runtime supports images only up to %wx%hpx.").replace(/%([swh])/g,function(t,n){switch(n){case"s":return e.runtime;case"w":return e.features.maxWidth;case"h":return e.features.maxHeight}});break;case n.HTTP_ERROR:a=o("Upload URL might be wrong or doesn't exist")}i+=" <br /><i>"+a+"</i>"}s.notify("error",i),s._trigger("error",null,{up:e,file:r,error:i})}})},_setOption:function(e,t){var n=this;"buttons"==e&&"object"==typeof t&&(t=i.extend(n.options.buttons,t),t.browse?(n.browse_button.button("enable").show(),up.disableBrowse(!1)):(n.browse_button.button("disable").hide(),up.disableBrowse(!0)),t.start?n.start_button.button("enable").show():n.start_button.button("disable").hide(),t.stop?n.start_button.button("enable").show():n.stop_button.button("disable").hide()),n.uploader.settings[e]=t},start:function(){this.uploader.start(),this._trigger("start",null)},stop:function(){this.uploader.stop(),this._trigger("stop",null)},getFile:function(e){var t;return t="number"==typeof e?this.uploader.files[e]:this.uploader.getFile(e)},removeFile:function(e){var t=this.getFile(e);t&&this.uploader.removeFile(t)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},_handleState:function(){var e=this,t=this.uploader;t.state===n.STARTED?(i(e.start_button).button("disable"),i([]).add(e.stop_button).add(".plupload_started").removeClass("plupload_hidden"),i(".plupload_upload_status",e.element).html(o("Uploaded %d/%d files").replace("%d/%d",t.total.uploaded+"/"+t.files.length)),i(".plupload_header_content",e.element).addClass("plupload_header_content_bw")):(i([]).add(e.stop_button).add(".plupload_started").addClass("plupload_hidden"),e.options.multiple_queues&&(i(e.start_button).button("enable"),i(".plupload_header_content",e.element).removeClass("plupload_header_content_bw")),e._updateFileList())},_handleFileStatus:function(e){var t,o;if(i("#"+e.id).length){switch(e.status){case n.DONE:t="plupload_done",o="ui-icon ui-icon-circle-check";break;case n.FAILED:t="ui-state-error plupload_failed",o="ui-icon ui-icon-alert";break;case n.QUEUED:t="plupload_delete",o="ui-icon ui-icon-circle-minus";break;case n.UPLOADING:t="ui-state-highlight plupload_uploading",o="ui-icon ui-icon-circle-arrow-w";var a=i(".plupload_scroll",this.container),r=a.scrollTop(),s=a.height(),l=i("#"+e.id).position().top+i("#"+e.id).height();l>s&&a.scrollTop(r+l-s)}t+=" ui-state-default plupload_file",i("#"+e.id).attr("class",t).find(".ui-icon").attr("class",o)}},_updateTotalProgress:function(){var e=this.uploader;this.progressbar.progressbar("value",e.total.percent),this.element.find(".plupload_total_status").html(e.total.percent+"%").end().find(".plupload_total_file_size").html(n.formatSize(e.total.size)).end().find(".plupload_upload_status").html(o("Uploaded %d/%d files").replace("%d/%d",e.total.uploaded+"/"+e.files.length))},_updateFileList:function(){var e,t,a=this,r=this.uploader,s=this.filelist,l=0,c=this.id+"_";i.ui.sortable&&this.options.sortable&&i("tbody.ui-sortable",s).sortable("destroy"),s.empty(),i.each(r.files,function(o,u){t="",e=c+l,u.status===n.DONE&&(u.target_name&&(t+='<input type="hidden" name="'+e+'_tmpname" value="'+n.xmlEncode(u.target_name)+'" />'),t+='<input type="hidden" name="'+e+'_name" value="'+n.xmlEncode(u.name)+'" />',t+='<input type="hidden" name="'+e+'_status" value="'+(u.status===n.DONE?"done":"failed")+'" />',l++,a.counter.val(l)),s.append('<tr class="ui-state-default plupload_file" id="'+u.id+'"><td class="plupload_cell plupload_file_name"><span>'+u.name+'</span></td><td class="plupload_cell plupload_file_status">'+u.percent+'%</td><td class="plupload_cell plupload_file_size">'+n.formatSize(u.size)+'</td><td class="plupload_cell plupload_file_action"><div class="ui-icon"></div>'+t+"</td></tr>"),a._handleFileStatus(u),i("#"+u.id+".plupload_delete .ui-icon, #"+u.id+".plupload_done .ui-icon").click(function(e){i("#"+u.id).remove(),r.removeFile(u),e.preventDefault()}),a._trigger("updatelist",null,s)}),0===r.total.queued?i(".ui-button-text",a.browse_button).html(o("Add Files")):i(".ui-button-text",a.browse_button).html(o("%d files queued").replace("%d",r.total.queued)),r.files.length===r.total.uploaded+r.total.failed?a.start_button.button("disable"):a.start_button.button("enable"),s[0].scrollTop=s[0].scrollHeight,a._updateTotalProgress(),!r.files.length&&r.features.dragdrop&&r.settings.dragdrop?i("#"+e+"_filelist").append('<tr><td class="plupload_droptext">'+o("Drag files here.")+"</td></tr>"):a.options.sortable&&i.ui.sortable&&a._enableSortingList()},_enableRenaming:function(){var e=this;this.filelist.on("click",".plupload_delete .plupload_file_name span",function(t){var n,o,a,r=i(t.target),s="";n=e.uploader.getFile(r.parents("tr")[0].id),a=n.name,o=/^(.+)(\.[^.]+)$/.exec(a),o&&(a=o[1],s=o[2]),r.hide().after('<input class="plupload_file_rename" type="text" />'),r.next().val(a).focus().blur(function(){r.show().next().remove()}).keydown(function(e){var t=i(this);-1!==i.inArray(e.keyCode,[13,27])&&(e.preventDefault(),13===e.keyCode&&(n.name=t.val()+s,r.html(n.name)),t.blur())})})},_enableDragAndDrop:function(){this.filelist.append('<tr><td class="plupload_droptext">'+o("Drag files here.")+"</td></tr>"),this.filelist.parent().attr("id",this.id+"_dropbox"),this.uploader.settings.drop_element=this.options.drop_element=this.id+"_dropbox"},_enableSortingList:function(){var e=this;i("tbody tr",this.filelist).length<2||i("tbody",this.filelist).sortable({containment:"parent",items:".plupload_delete",helper:function(e,t){return t.clone(!0).find("td:not(.plupload_file_name)").remove().end().css("width","100%")},stop:function(){var t=[];i.each(i(this).sortable("toArray"),function(n,i){t[t.length]=e.uploader.getFile(i)}),t.unshift(t.length),t.unshift(0),Array.prototype.splice.apply(e.uploader.files,t)}})},notify:function(e,t){var n=i('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+o("Close")+'"></span><p><span class="ui-icon"></span>'+t+"</p></div>");n.addClass("ui-state-"+("error"===e?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+("error"===e?"alert":"info")).end().find(".plupload_message_close").click(function(){n.remove()}).end(),i(".plupload_header_content",this.container).append(n)},destroy:function(){i(".plupload_button",this.element).unbind(),i.ui.button&&i(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy"),i.ui.progressbar&&this.progressbar.progressbar("destroy"),i.ui.sortable&&this.options.sortable&&i("tbody",this.filelist).sortable("destroy"),this.uploader.destroy(),this.element.empty().html(this.contents_bak),this.contents_bak="",i.Widget.prototype.destroy.apply(this)}})}(window,document,plupload,jQuery);var ho=-1,po=1,fo=0;o.Diff,o.prototype.diff_main=function(e,t,n,i){"undefined"==typeof i&&(i=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var o=i;if(null==e||null==t)throw new Error("Null input. (diff_main)");if(e==t)return e?[[fo,e]]:[];"undefined"==typeof n&&(n=!0);var a=n,r=this.diff_commonPrefix(e,t),s=e.substring(0,r);e=e.substring(r),t=t.substring(r),r=this.diff_commonSuffix(e,t);var l=e.substring(e.length-r);e=e.substring(0,e.length-r),t=t.substring(0,t.length-r);var c=this.diff_compute_(e,t,a,o);return s&&c.unshift([fo,s]),l&&c.push([fo,l]),this.diff_cleanupMerge(c),c},o.prototype.diff_compute_=function(e,t,n,i){var o;if(!e)return[[po,t]];if(!t)return[[ho,e]];var a=e.length>t.length?e:t,r=e.length>t.length?t:e,s=a.indexOf(r);if(-1!=s)return o=[[po,a.substring(0,s)],[fo,r],[po,a.substring(s+r.length)]],e.length>t.length&&(o[0][0]=o[2][0]=ho),o;if(1==r.length)return[[ho,e],[po,t]];var l=this.diff_halfMatch_(e,t);if(l){var c=l[0],u=l[1],d=l[2],h=l[3],p=l[4],f=this.diff_main(c,d,n,i),g=this.diff_main(u,h,n,i);return f.concat([[fo,p]],g)}return n&&e.length>100&&t.length>100?this.diff_lineMode_(e,t,i):this.diff_bisect_(e,t,i)},o.prototype.diff_lineMode_=function(e,t,n){var i=this.diff_linesToChars_(e,t);e=i.chars1,t=i.chars2;var o=i.lineArray,a=this.diff_main(e,t,!1,n);this.diff_charsToLines_(a,o),this.diff_cleanupSemantic(a),a.push([fo,""]);for(var r=0,s=0,l=0,c="",u="";r<a.length;){switch(a[r][0]){case po:l++,u+=a[r][1];break;case ho:s++,c+=a[r][1];break;case fo:if(s>=1&&l>=1){a.splice(r-s-l,s+l),r=r-s-l;for(var i=this.diff_main(c,u,!1,n),d=i.length-1;d>=0;d--)a.splice(r,0,i[d]);r+=i.length}l=0,s=0,c="",u=""}r++}return a.pop(),a},o.prototype.diff_bisect_=function(e,t,n){for(var i=e.length,o=t.length,a=Math.ceil((i+o)/2),r=a,s=2*a,l=new Array(s),c=new Array(s),u=0;s>u;u++)l[u]=-1,c[u]=-1;l[r+1]=0,c[r+1]=0;for(var d=i-o,h=0!=d%2,p=0,f=0,g=0,m=0,v=0;a>v&&!((new Date).getTime()>n);v++){for(var y=-v+p;v-f>=y;y+=2){var b,w=r+y;b=y==-v||y!=v&&l[w-1]<l[w+1]?l[w+1]:l[w-1]+1;for(var C=b-y;i>b&&o>C&&e.charAt(b)==t.charAt(C);)b++,C++;if(l[w]=b,b>i)f+=2;else if(C>o)p+=2;else if(h){var T=r+d-y;if(T>=0&&s>T&&-1!=c[T]){var E=i-c[T];if(b>=E)return this.diff_bisectSplit_(e,t,b,C,n)}}}for(var S=-v+g;v-m>=S;S+=2){var E,T=r+S;E=S==-v||S!=v&&c[T-1]<c[T+1]?c[T+1]:c[T-1]+1;for(var x=E-S;i>E&&o>x&&e.charAt(i-E-1)==t.charAt(o-x-1);)E++,x++;if(c[T]=E,E>i)m+=2;else if(x>o)g+=2;else if(!h){var w=r+d-S;if(w>=0&&s>w&&-1!=l[w]){var b=l[w],C=r+b-w;if(E=i-E,b>=E)return this.diff_bisectSplit_(e,t,b,C,n)}}}}return[[ho,e],[po,t]]},o.prototype.diff_bisectSplit_=function(e,t,n,i,o){var a=e.substring(0,n),r=t.substring(0,i),s=e.substring(n),l=t.substring(i),c=this.diff_main(a,r,!1,o),u=this.diff_main(s,l,!1,o);return c.concat(u)},o.prototype.diff_linesToChars_=function(e,t){function n(e){for(var t="",n=0,a=-1,r=i.length;a<e.length-1;){a=e.indexOf("\n",n),-1==a&&(a=e.length-1);var s=e.substring(n,a+1);n=a+1,(o.hasOwnProperty?o.hasOwnProperty(s):void 0!==o[s])?t+=String.fromCharCode(o[s]):(t+=String.fromCharCode(r),o[s]=r,i[r++]=s)}return t}var i=[],o={};i[0]="";var a=n(e),r=n(t);return{chars1:a,chars2:r,lineArray:i}},o.prototype.diff_charsToLines_=function(e,t){for(var n=0;n<e.length;n++){for(var i=e[n][1],o=[],a=0;a<i.length;a++)o[a]=t[i.charCodeAt(a)];e[n][1]=o.join("")}},o.prototype.diff_commonPrefix=function(e,t){if(!e||!t||e.charAt(0)!=t.charAt(0))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,a=0;o>n;)e.substring(a,o)==t.substring(a,o)?(n=o,a=n):i=o,o=Math.floor((i-n)/2+n);return o},o.prototype.diff_commonSuffix=function(e,t){if(!e||!t||e.charAt(e.length-1)!=t.charAt(t.length-1))return 0;for(var n=0,i=Math.min(e.length,t.length),o=i,a=0;o>n;)e.substring(e.length-o,e.length-a)==t.substring(t.length-o,t.length-a)?(n=o,a=n):i=o,o=Math.floor((i-n)/2+n);return o},o.prototype.diff_commonOverlap_=function(e,t){var n=e.length,i=t.length;if(0==n||0==i)return 0;n>i?e=e.substring(n-i):i>n&&(t=t.substring(0,n));var o=Math.min(n,i);if(e==t)return o;for(var a=0,r=1;;){var s=e.substring(o-r),l=t.indexOf(s);if(-1==l)return a;r+=l,(0==l||e.substring(o-r)==t.substring(0,r))&&(a=r,r++)}},o.prototype.diff_halfMatch_=function(e,t){function n(e,t,n){for(var i,o,a,s,l=e.substring(n,n+Math.floor(e.length/4)),c=-1,u="";-1!=(c=t.indexOf(l,c+1));){var d=r.diff_commonPrefix(e.substring(n),t.substring(c)),h=r.diff_commonSuffix(e.substring(0,n),t.substring(0,c));u.length<h+d&&(u=t.substring(c-h,c)+t.substring(c,c+d),i=e.substring(0,n-h),o=e.substring(n+d),a=t.substring(0,c-h),s=t.substring(c+d))}return 2*u.length>=e.length?[i,o,a,s,u]:null}if(this.Diff_Timeout<=0)return null;var i=e.length>t.length?e:t,o=e.length>t.length?t:e;if(i.length<4||2*o.length<i.length)return null;var a,r=this,s=n(i,o,Math.ceil(i.length/4)),l=n(i,o,Math.ceil(i.length/2));if(!s&&!l)return null;a=l?s?s[4].length>l[4].length?s:l:l:s;var c,u,d,h;e.length>t.length?(c=a[0],u=a[1],d=a[2],h=a[3]):(d=a[0],h=a[1],c=a[2],u=a[3]);var p=a[4];return[c,u,d,h,p]},o.prototype.diff_cleanupSemantic=function(e){for(var t=!1,n=[],i=0,o=null,a=0,r=0,s=0,l=0,c=0;a<e.length;)e[a][0]==fo?(n[i++]=a,r=l,s=c,l=0,c=0,o=e[a][1]):(e[a][0]==po?l+=e[a][1].length:c+=e[a][1].length,o&&o.length<=Math.max(r,s)&&o.length<=Math.max(l,c)&&(e.splice(n[i-1],0,[ho,o]),e[n[i-1]+1][0]=po,i--,i--,a=i>0?n[i-1]:-1,r=0,s=0,l=0,c=0,o=null,t=!0)),a++;for(t&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),a=1;a<e.length;){if(e[a-1][0]==ho&&e[a][0]==po){var u=e[a-1][1],d=e[a][1],h=this.diff_commonOverlap_(u,d),p=this.diff_commonOverlap_(d,u);h>=p?(h>=u.length/2||h>=d.length/2)&&(e.splice(a,0,[fo,d.substring(0,h)]),e[a-1][1]=u.substring(0,u.length-h),e[a+1][1]=d.substring(h),a++):(p>=u.length/2||p>=d.length/2)&&(e.splice(a,0,[fo,u.substring(0,p)]),e[a-1][0]=po,e[a-1][1]=d.substring(0,d.length-p),e[a+1][0]=ho,e[a+1][1]=u.substring(p),a++),a++}a++}},o.prototype.diff_cleanupSemanticLossless=function(e){function t(e,t){if(!e||!t)return 6;var n=e.charAt(e.length-1),i=t.charAt(0),a=n.match(o.nonAlphaNumericRegex_),r=i.match(o.nonAlphaNumericRegex_),s=a&&n.match(o.whitespaceRegex_),l=r&&i.match(o.whitespaceRegex_),c=s&&n.match(o.linebreakRegex_),u=l&&i.match(o.linebreakRegex_),d=c&&e.match(o.blanklineEndRegex_),h=u&&t.match(o.blanklineStartRegex_);return d||h?5:c||u?4:a&&!s&&l?3:s||l?2:a||r?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==fo&&e[n+1][0]==fo){var i=e[n-1][1],a=e[n][1],r=e[n+1][1],s=this.diff_commonSuffix(i,a);if(s){var l=a.substring(a.length-s);i=i.substring(0,i.length-s),a=l+a.substring(0,a.length-s),r=l+r}for(var c=i,u=a,d=r,h=t(i,a)+t(a,r);a.charAt(0)===r.charAt(0);){i+=a.charAt(0),a=a.substring(1)+r.charAt(0),r=r.substring(1);var p=t(i,a)+t(a,r);p>=h&&(h=p,c=i,u=a,d=r)}e[n-1][1]!=c&&(c?e[n-1][1]=c:(e.splice(n-1,1),n--),e[n][1]=u,d?e[n+1][1]=d:(e.splice(n+1,1),n--))}n++}},o.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,o.whitespaceRegex_=/\s/,o.linebreakRegex_=/[\r\n]/,o.blanklineEndRegex_=/\n\r?\n$/,o.blanklineStartRegex_=/^\r?\n\r?\n/,o.prototype.diff_cleanupEfficiency=function(e){for(var t=!1,n=[],i=0,o=null,a=0,r=!1,s=!1,l=!1,c=!1;a<e.length;)e[a][0]==fo?(e[a][1].length<this.Diff_EditCost&&(l||c)?(n[i++]=a,r=l,s=c,o=e[a][1]):(i=0,o=null),l=c=!1):(e[a][0]==ho?c=!0:l=!0,o&&(r&&s&&l&&c||o.length<this.Diff_EditCost/2&&3==r+s+l+c)&&(e.splice(n[i-1],0,[ho,o]),e[n[i-1]+1][0]=po,i--,o=null,r&&s?(l=c=!0,i=0):(i--,a=i>0?n[i-1]:-1,l=c=!1),t=!0)),a++;t&&this.diff_cleanupMerge(e)},o.prototype.diff_cleanupMerge=function(e){e.push([fo,""]);for(var t,n=0,i=0,o=0,a="",r="";n<e.length;)switch(e[n][0]){case po:o++,r+=e[n][1],n++;break;case ho:i++,a+=e[n][1],n++;break;case fo:i+o>1?(0!==i&&0!==o&&(t=this.diff_commonPrefix(r,a),0!==t&&(n-i-o>0&&e[n-i-o-1][0]==fo?e[n-i-o-1][1]+=r.substring(0,t):(e.splice(0,0,[fo,r.substring(0,t)]),n++),r=r.substring(t),a=a.substring(t)),t=this.diff_commonSuffix(r,a),0!==t&&(e[n][1]=r.substring(r.length-t)+e[n][1],r=r.substring(0,r.length-t),a=a.substring(0,a.length-t))),0===i?e.splice(n-o,i+o,[po,r]):0===o?e.splice(n-i,i+o,[ho,a]):e.splice(n-i-o,i+o,[ho,a],[po,r]),n=n-i-o+(i?1:0)+(o?1:0)+1):0!==n&&e[n-1][0]==fo?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,o=0,i=0,a="",r=""}""===e[e.length-1][1]&&e.pop();var s=!1;for(n=1;n<e.length-1;)e[n-1][0]==fo&&e[n+1][0]==fo&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)==e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),s=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),s=!0)),n++;s&&this.diff_cleanupMerge(e)},o.prototype.diff_xIndex=function(e,t){var n,i=0,o=0,a=0,r=0;for(n=0;n<e.length&&(e[n][0]!==po&&(i+=e[n][1].length),e[n][0]!==ho&&(o+=e[n][1].length),!(i>t));n++)a=i,r=o;return e.length!=n&&e[n][0]===ho?r:r+(t-a)},o.prototype.diff_prettyHtml=function(e){for(var t=[],n=/&/g,i=/</g,o=/>/g,a=/\n/g,r=0;r<e.length;r++){var s=e[r][0],l=e[r][1],c=l.replace(n,"&amp;").replace(i,"&lt;").replace(o,"&gt;").replace(a,"&para;<br>");switch(s){case po:t[r]='<ins style="background:#e6ffe6;">'+c+"</ins>";break;case ho:t[r]='<del style="background:#ffe6e6;">'+c+"</del>";break;case fo:t[r]="<span>"+c+"</span>"}}return t.join("")},o.prototype.diff_text1=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==po&&(t[n]=e[n][1]);return t.join("")},o.prototype.diff_text2=function(e){for(var t=[],n=0;n<e.length;n++)e[n][0]!==ho&&(t[n]=e[n][1]);return t.join("")},o.prototype.diff_levenshtein=function(e){for(var t=0,n=0,i=0,o=0;o<e.length;o++){var a=e[o][0],r=e[o][1];switch(a){case po:n+=r.length;break;case ho:i+=r.length;break;case fo:t+=Math.max(n,i),n=0,i=0}}return t+=Math.max(n,i)},o.prototype.diff_toDelta=function(e){for(var t=[],n=0;n<e.length;n++)switch(e[n][0]){case po:t[n]="+"+encodeURI(e[n][1]);break;case ho:t[n]="-"+e[n][1].length;break;case fo:t[n]="="+e[n][1].length}return t.join("	").replace(/%20/g," ")},o.prototype.diff_fromDelta=function(e,t){for(var n=[],i=0,o=0,a=t.split(/\t/g),r=0;r<a.length;r++){var s=a[r].substring(1);switch(a[r].charAt(0)){case"+":try{n[i++]=[po,decodeURI(s)]}catch(l){throw new Error("Illegal escape in diff_fromDelta: "+s)}break;case"-":case"=":var c=parseInt(s,10);if(isNaN(c)||0>c)throw new Error("Invalid number in diff_fromDelta: "+s);var u=e.substring(o,o+=c);n[i++]="="==a[r].charAt(0)?[fo,u]:[ho,u];break;default:if(a[r])throw new Error("Invalid diff operation in diff_fromDelta: "+a[r])}}if(o!=e.length)throw new Error("Delta length ("+o+") does not equal source text length ("+e.length+").");return n},o.prototype.match_main=function(e,t,n){if(null==e||null==t||null==n)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==t?0:e.length?e.substring(n,n+t.length)==t?n:this.match_bitap_(e,t,n):-1},o.prototype.match_bitap_=function(e,t,n){function i(e,i){var o=e/t.length,r=Math.abs(n-i);return a.Match_Distance?o+r/a.Match_Distance:r?1:o}if(t.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var o=this.match_alphabet_(t),a=this,r=this.Match_Threshold,s=e.indexOf(t,n);-1!=s&&(r=Math.min(i(0,s),r),s=e.lastIndexOf(t,n+t.length),-1!=s&&(r=Math.min(i(0,s),r)));var l=1<<t.length-1;s=-1;for(var c,u,d,h=t.length+e.length,p=0;p<t.length;p++){for(c=0,u=h;u>c;)i(p,n+u)<=r?c=u:h=u,u=Math.floor((h-c)/2+c);h=u;var f=Math.max(1,n-u+1),g=Math.min(n+u,e.length)+t.length,m=Array(g+2);m[g+1]=(1<<p)-1;for(var v=g;v>=f;v--){var y=o[e.charAt(v-1)];if(m[v]=0===p?(1|m[v+1]<<1)&y:(1|m[v+1]<<1)&y|(1|(d[v+1]|d[v])<<1)|d[v+1],m[v]&l){var b=i(p,v-1);if(r>=b){if(r=b,s=v-1,!(s>n))break;f=Math.max(1,2*n-s)}}}if(i(p+1,n)>r)break;d=m}return s},o.prototype.match_alphabet_=function(e){for(var t={},n=0;n<e.length;n++)t[e.charAt(n)]=0;for(var n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t},o.prototype.patch_addContext_=function(e,t){if(0!=t.length){for(var n=t.substring(e.start2,e.start2+e.length1),i=0;t.indexOf(n)!=t.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=t.substring(e.start2-i,e.start2+e.length1+i);
i+=this.Patch_Margin;var o=t.substring(e.start2-i,e.start2);o&&e.diffs.unshift([fo,o]);var a=t.substring(e.start2+e.length1,e.start2+e.length1+i);a&&e.diffs.push([fo,a]),e.start1-=o.length,e.start2-=o.length,e.length1+=o.length+a.length,e.length2+=o.length+a.length}},o.prototype.patch_make=function(e,t,n){var i,a;if("string"==typeof e&&"string"==typeof t&&"undefined"==typeof n)i=e,a=this.diff_main(i,t,!0),a.length>2&&(this.diff_cleanupSemantic(a),this.diff_cleanupEfficiency(a));else if(e&&"object"==typeof e&&"undefined"==typeof t&&"undefined"==typeof n)a=e,i=this.diff_text1(a);else if("string"==typeof e&&t&&"object"==typeof t&&"undefined"==typeof n)i=e,a=t;else{if("string"!=typeof e||"string"!=typeof t||!n||"object"!=typeof n)throw new Error("Unknown call format to patch_make.");i=e,a=n}if(0===a.length)return[];for(var r=[],s=new o.patch_obj,l=0,c=0,u=0,d=i,h=i,p=0;p<a.length;p++){var f=a[p][0],g=a[p][1];switch(l||f===fo||(s.start1=c,s.start2=u),f){case po:s.diffs[l++]=a[p],s.length2+=g.length,h=h.substring(0,u)+g+h.substring(u);break;case ho:s.length1+=g.length,s.diffs[l++]=a[p],h=h.substring(0,u)+h.substring(u+g.length);break;case fo:g.length<=2*this.Patch_Margin&&l&&a.length!=p+1?(s.diffs[l++]=a[p],s.length1+=g.length,s.length2+=g.length):g.length>=2*this.Patch_Margin&&l&&(this.patch_addContext_(s,d),r.push(s),s=new o.patch_obj,l=0,d=h,c=u)}f!==po&&(c+=g.length),f!==ho&&(u+=g.length)}return l&&(this.patch_addContext_(s,d),r.push(s)),r},o.prototype.patch_deepCopy=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=new o.patch_obj;a.diffs=[];for(var r=0;r<i.diffs.length;r++)a.diffs[r]=i.diffs[r].slice();a.start1=i.start1,a.start2=i.start2,a.length1=i.length1,a.length2=i.length2,t[n]=a}return t},o.prototype.patch_apply=function(e,t){if(0==e.length)return[t,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);t=n+t+n,this.patch_splitMax(e);for(var i=0,o=[],a=0;a<e.length;a++){var r,s=e[a].start2+i,l=this.diff_text1(e[a].diffs),c=-1;if(l.length>this.Match_MaxBits?(r=this.match_main(t,l.substring(0,this.Match_MaxBits),s),-1!=r&&(c=this.match_main(t,l.substring(l.length-this.Match_MaxBits),s+l.length-this.Match_MaxBits),(-1==c||r>=c)&&(r=-1))):r=this.match_main(t,l,s),-1==r)o[a]=!1,i-=e[a].length2-e[a].length1;else{o[a]=!0,i=r-s;var u;if(u=-1==c?t.substring(r,r+l.length):t.substring(r,c+this.Match_MaxBits),l==u)t=t.substring(0,r)+this.diff_text2(e[a].diffs)+t.substring(r+l.length);else{var d=this.diff_main(l,u,!1);if(l.length>this.Match_MaxBits&&this.diff_levenshtein(d)/l.length>this.Patch_DeleteThreshold)o[a]=!1;else{this.diff_cleanupSemanticLossless(d);for(var h,p=0,f=0;f<e[a].diffs.length;f++){var g=e[a].diffs[f];g[0]!==fo&&(h=this.diff_xIndex(d,p)),g[0]===po?t=t.substring(0,r+h)+g[1]+t.substring(r+h):g[0]===ho&&(t=t.substring(0,r+h)+t.substring(r+this.diff_xIndex(d,p+g[1].length))),g[0]!==ho&&(p+=g[1].length)}}}}}return t=t.substring(n.length,t.length-n.length),[t,o]},o.prototype.patch_addPadding=function(e){for(var t=this.Patch_Margin,n="",i=1;t>=i;i++)n+=String.fromCharCode(i);for(var i=0;i<e.length;i++)e[i].start1+=t,e[i].start2+=t;var o=e[0],a=o.diffs;if(0==a.length||a[0][0]!=fo)a.unshift([fo,n]),o.start1-=t,o.start2-=t,o.length1+=t,o.length2+=t;else if(t>a[0][1].length){var r=t-a[0][1].length;a[0][1]=n.substring(a[0][1].length)+a[0][1],o.start1-=r,o.start2-=r,o.length1+=r,o.length2+=r}if(o=e[e.length-1],a=o.diffs,0==a.length||a[a.length-1][0]!=fo)a.push([fo,n]),o.length1+=t,o.length2+=t;else if(t>a[a.length-1][1].length){var r=t-a[a.length-1][1].length;a[a.length-1][1]+=n.substring(0,r),o.length1+=r,o.length2+=r}return n},o.prototype.patch_splitMax=function(e){for(var t=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=t)){var i=e[n];e.splice(n--,1);for(var a=i.start1,r=i.start2,s="";0!==i.diffs.length;){var l=new o.patch_obj,c=!0;for(l.start1=a-s.length,l.start2=r-s.length,""!==s&&(l.length1=l.length2=s.length,l.diffs.push([fo,s]));0!==i.diffs.length&&l.length1<t-this.Patch_Margin;){var u=i.diffs[0][0],d=i.diffs[0][1];u===po?(l.length2+=d.length,r+=d.length,l.diffs.push(i.diffs.shift()),c=!1):u===ho&&1==l.diffs.length&&l.diffs[0][0]==fo&&d.length>2*t?(l.length1+=d.length,a+=d.length,c=!1,l.diffs.push([u,d]),i.diffs.shift()):(d=d.substring(0,t-l.length1-this.Patch_Margin),l.length1+=d.length,a+=d.length,u===fo?(l.length2+=d.length,r+=d.length):c=!1,l.diffs.push([u,d]),d==i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(d.length))}s=this.diff_text2(l.diffs),s=s.substring(s.length-this.Patch_Margin);var h=this.diff_text1(i.diffs).substring(0,this.Patch_Margin);""!==h&&(l.length1+=h.length,l.length2+=h.length,0!==l.diffs.length&&l.diffs[l.diffs.length-1][0]===fo?l.diffs[l.diffs.length-1][1]+=h:l.diffs.push([fo,h])),c||e.splice(++n,0,l)}}},o.prototype.patch_toText=function(e){for(var t=[],n=0;n<e.length;n++)t[n]=e[n];return t.join("")},o.prototype.patch_fromText=function(e){var t=[];if(!e)return t;for(var n=e.split("\n"),i=0,a=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;i<n.length;){var r=n[i].match(a);if(!r)throw new Error("Invalid patch string: "+n[i]);var s=new o.patch_obj;for(t.push(s),s.start1=parseInt(r[1],10),""===r[2]?(s.start1--,s.length1=1):"0"==r[2]?s.length1=0:(s.start1--,s.length1=parseInt(r[2],10)),s.start2=parseInt(r[3],10),""===r[4]?(s.start2--,s.length2=1):"0"==r[4]?s.length2=0:(s.start2--,s.length2=parseInt(r[4],10)),i++;i<n.length;){var l=n[i].charAt(0);try{var c=decodeURI(n[i].substring(1))}catch(u){throw new Error("Illegal escape in patch_fromText: "+c)}if("-"==l)s.diffs.push([ho,c]);else if("+"==l)s.diffs.push([po,c]);else if(" "==l)s.diffs.push([fo,c]);else{if("@"==l)break;if(""!==l)throw new Error('Invalid patch mode "'+l+'" in: '+c)}i++}}return t},o.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},o.patch_obj.prototype.toString=function(){var e,t;e=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,t=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var n,i=["@@ -"+e+" +"+t+" @@\n"],o=0;o<this.diffs.length;o++){switch(this.diffs[o][0]){case po:n="+";break;case ho:n="-";break;case fo:n=" "}i[o+1]=n+encodeURI(this.diffs[o][1])+"\n"}return i.join("").replace(/%20/g," ")},this.diff_match_patch=o,this.DIFF_DELETE=ho,this.DIFF_INSERT=po,this.DIFF_EQUAL=fo,function(e){var t,n,i,o=e(window),a={jqueryui:{container:"ui-widget ui-widget-content ui-corner-all",notice:"ui-state-highlight",notice_icon:"ui-icon ui-icon-info",info:"",info_icon:"ui-icon ui-icon-info",success:"ui-state-default",success_icon:"ui-icon ui-icon-circle-check",error:"ui-state-error",error_icon:"ui-icon ui-icon-alert",closer:"ui-icon ui-icon-close",pin_up:"ui-icon ui-icon-pin-w",pin_down:"ui-icon ui-icon-pin-s",hi_menu:"ui-state-default ui-corner-bottom",hi_btn:"ui-state-default ui-corner-all",hi_btnhov:"ui-state-hover",hi_hnd:"ui-icon ui-icon-grip-dotted-horizontal"},bootstrap:{container:"alert",notice:"",notice_icon:"icon-exclamation-sign",info:"alert-info",info_icon:"icon-info-sign",success:"alert-success",success_icon:"icon-ok-sign",error:"alert-error",error_icon:"icon-warning-sign",closer:"icon-remove",pin_up:"icon-pause",pin_down:"icon-play",hi_menu:"well",hi_btn:"btn",hi_btnhov:"",hi_hnd:"icon-chevron-down"}},r=function(){i=e("body"),o=e(window),o.bind("resize",function(){n&&clearTimeout(n),n=setTimeout(e.pnotify_position_all,10)})};document.body?r():e(r),e.extend({pnotify_remove_all:function(){var t=o.data("pnotify");t&&t.length&&e.each(t,function(){this.pnotify_remove&&this.pnotify_remove()})},pnotify_position_all:function(){n&&clearTimeout(n),n=null;var t=o.data("pnotify");t&&t.length&&(e.each(t,function(){var e=this.opts.stack;e&&(e.nextpos1=e.firstpos1,e.nextpos2=e.firstpos2,e.addpos2=0,e.animation=!0)}),e.each(t,function(){this.pnotify_position()}))},pnotify:function(r){var s,l;"object"!=typeof r?(l=e.extend({},e.pnotify.defaults),l.text=r):l=e.extend({},e.pnotify.defaults,r);for(var c in l)"string"==typeof c&&c.match(/^pnotify_/)&&(l[c.replace(/^pnotify_/,"")]=l[c]);if(l.before_init&&l.before_init(l)===!1)return null;var u,h=function(t,n){f.css("display","none");var i=document.elementFromPoint(t.clientX,t.clientY);f.css("display","block");var o=e(i),a=o.css("cursor");f.css("cursor","auto"!=a?a:"default"),u&&u.get(0)==i||(u&&(d.call(u.get(0),"mouseleave",t.originalEvent),d.call(u.get(0),"mouseout",t.originalEvent)),d.call(i,"mouseenter",t.originalEvent),d.call(i,"mouseover",t.originalEvent)),d.call(i,n,t.originalEvent),u=o},p=a[l.styling],f=e("<div />",{"class":"ui-pnotify "+l.addclass,css:{display:"none"},mouseenter:function(e){l.nonblock&&e.stopPropagation(),l.mouse_reset&&"out"==s&&(f.stop(!0),s="in",f.css("height","auto").animate({width:l.width,opacity:l.nonblock?l.nonblock_opacity:l.opacity},"fast")),l.nonblock&&f.stop().animate({opacity:l.nonblock_opacity},"fast"),l.hide&&l.mouse_reset&&f.pnotify_cancel_remove(),l.sticker&&!l.nonblock&&f.sticker.trigger("pnotify_icon").css("visibility","visible"),l.closer&&!l.nonblock&&f.closer.css("visibility","visible")},mouseleave:function(t){l.nonblock&&t.stopPropagation(),u=null,f.css("cursor","auto"),l.nonblock&&"out"!=s&&f.stop().animate({opacity:l.opacity},"fast"),l.hide&&l.mouse_reset&&f.pnotify_queue_remove(),l.sticker_hover&&f.sticker.css("visibility","hidden"),l.closer_hover&&f.closer.css("visibility","hidden"),e.pnotify_position_all()},mouseover:function(e){l.nonblock&&e.stopPropagation()},mouseout:function(e){l.nonblock&&e.stopPropagation()},mousemove:function(e){l.nonblock&&(e.stopPropagation(),h(e,"onmousemove"))},mousedown:function(e){l.nonblock&&(e.stopPropagation(),e.preventDefault(),h(e,"onmousedown"))},mouseup:function(e){l.nonblock&&(e.stopPropagation(),e.preventDefault(),h(e,"onmouseup"))},click:function(e){l.nonblock&&(e.stopPropagation(),h(e,"onclick"))},dblclick:function(e){l.nonblock&&(e.stopPropagation(),h(e,"ondblclick"))}});f.opts=l;var g;g=l.state?"ui-state-"+l.state:p[l.type]?p[l.type]:p.notice,f.container=e("<div />",{"class":p.container+" ui-pnotify-container "+g}).appendTo(f),""!=l.cornerclass&&f.container.removeClass("ui-corner-all").addClass(l.cornerclass),l.shadow&&f.container.addClass("ui-pnotify-shadow"),f.pnotify_version="1.2.2",f.pnotify=function(t){var n=l;"string"==typeof t?l.text=t:l=e.extend({},l,t);for(var i in l)"string"==typeof i&&i.match(/^pnotify_/)&&(l[i.replace(/^pnotify_/,"")]=l[i]);return f.opts=l,l.cornerclass!=n.cornerclass&&f.container.removeClass("ui-corner-all").addClass(l.cornerclass),l.shadow!=n.shadow&&(l.shadow?f.container.addClass("ui-pnotify-shadow"):f.container.removeClass("ui-pnotify-shadow")),l.addclass===!1?f.removeClass(n.addclass):l.addclass!==n.addclass&&f.removeClass(n.addclass).addClass(l.addclass),l.title===!1?f.title_container.slideUp("fast"):l.title!==n.title&&(l.title_escape?f.title_container.text(l.title).slideDown(200):f.title_container.html(l.title).slideDown(200)),l.text===!1?f.text_container.slideUp("fast"):l.text!==n.text&&(l.text_escape?f.text_container.text(l.text).slideDown(200):f.text_container.html(l.insert_brs?String(l.text).replace(/\n/g,"<br />"):l.text).slideDown(200)),f.pnotify_history=l.history,f.pnotify_hide=l.hide,l.type!=n.type&&f.container.removeClass(p.error+" "+p.notice+" "+p.success+" "+p.info).addClass("error"==l.type?p.error:"info"==l.type?p.info:"success"==l.type?p.success:p.notice),(l.icon!==n.icon||l.icon===!0&&l.type!=n.type)&&(f.container.find("div.ui-pnotify-icon").remove(),l.icon!==!1&&e("<div />",{"class":"ui-pnotify-icon"}).append(e("<span />",{"class":l.icon===!0?"error"==l.type?p.error_icon:"info"==l.type?p.info_icon:"success"==l.type?p.success_icon:p.notice_icon:l.icon})).prependTo(f.container)),l.width!==n.width&&f.animate({width:l.width}),l.min_height!==n.min_height&&f.container.animate({minHeight:l.min_height}),l.opacity!==n.opacity&&f.fadeTo(l.animate_speed,l.opacity),!l.closer||l.nonblock?f.closer.css("display","none"):f.closer.css("display","block"),!l.sticker||l.nonblock?f.sticker.css("display","none"):f.sticker.css("display","block"),f.sticker.trigger("pnotify_icon"),l.sticker_hover?f.sticker.css("visibility","hidden"):l.nonblock||f.sticker.css("visibility","visible"),l.closer_hover?f.closer.css("visibility","hidden"):l.nonblock||f.closer.css("visibility","visible"),l.hide?n.hide||f.pnotify_queue_remove():f.pnotify_cancel_remove(),f.pnotify_queue_position(),f},f.pnotify_position=function(e){var t=f.opts.stack;if(t){t.nextpos1||(t.nextpos1=t.firstpos1),t.nextpos2||(t.nextpos2=t.firstpos2),t.addpos2||(t.addpos2=0);var n="none"==f.css("display");if(!n||e){var i,a,r,s={};switch(t.dir1){case"down":r="top";break;case"up":r="bottom";break;case"left":r="right";break;case"right":r="left"}i=parseInt(f.css(r)),isNaN(i)&&(i=0),"undefined"!=typeof t.firstpos1||n||(t.firstpos1=i,t.nextpos1=t.firstpos1);var l;switch(t.dir2){case"down":l="top";break;case"up":l="bottom";break;case"left":l="right";break;case"right":l="left"}if(a=parseInt(f.css(l)),isNaN(a)&&(a=0),"undefined"!=typeof t.firstpos2||n||(t.firstpos2=a,t.nextpos2=t.firstpos2),("down"==t.dir1&&t.nextpos1+f.height()>o.height()||"up"==t.dir1&&t.nextpos1+f.height()>o.height()||"left"==t.dir1&&t.nextpos1+f.width()>o.width()||"right"==t.dir1&&t.nextpos1+f.width()>o.width())&&(t.nextpos1=t.firstpos1,t.nextpos2+=t.addpos2+("undefined"==typeof t.spacing2?25:t.spacing2),t.addpos2=0),t.animation&&t.nextpos2<a)switch(t.dir2){case"down":s.top=t.nextpos2+"px";break;case"up":s.bottom=t.nextpos2+"px";break;case"left":s.right=t.nextpos2+"px";break;case"right":s.left=t.nextpos2+"px"}else t.nextpos2&&f.css(l,t.nextpos2+"px");switch(t.dir2){case"down":case"up":f.outerHeight(!0)>t.addpos2&&(t.addpos2=f.height());break;case"left":case"right":f.outerWidth(!0)>t.addpos2&&(t.addpos2=f.width())}if(t.nextpos1)if(t.animation&&(i>t.nextpos1||s.top||s.bottom||s.right||s.left))switch(t.dir1){case"down":s.top=t.nextpos1+"px";break;case"up":s.bottom=t.nextpos1+"px";break;case"left":s.right=t.nextpos1+"px";break;case"right":s.left=t.nextpos1+"px"}else f.css(r,t.nextpos1+"px");switch((s.top||s.bottom||s.right||s.left)&&f.animate(s,{duration:this.opts.position_animate_speed,queue:!1}),t.dir1){case"down":case"up":t.nextpos1+=f.height()+("undefined"==typeof t.spacing1?25:t.spacing1);break;case"left":case"right":t.nextpos1+=f.width()+("undefined"==typeof t.spacing1?25:t.spacing1)}}}},f.pnotify_queue_position=function(t){n&&clearTimeout(n),t||(t=10),n=setTimeout(e.pnotify_position_all,t)},f.pnotify_display=function(){m=o.data("pnotify"),m&&m.length>l.maxonscreen&&e.each(m.slice(0,m.length-l.maxonscreen),function(){this.pnotify_remove&&this.pnotify_remove()}),f.parent().length||f.appendTo(i),l.before_open&&l.before_open(f)===!1||("top"!=l.stack.push&&f.pnotify_position(!0),"fade"==l.animation||"fade"==l.animation.effect_in?f.show().fadeTo(0,0).hide():1!=l.opacity&&f.show().fadeTo(0,l.opacity).hide(),f.animate_in(function(){l.after_open&&l.after_open(f),f.pnotify_queue_position(),l.hide&&f.pnotify_queue_remove()}))},f.pnotify_remove=function(){f.timer&&(window.clearTimeout(f.timer),f.timer=null),l.before_close&&l.before_close(f)===!1||f.animate_out(function(){l.after_close&&l.after_close(f)===!1||(f.pnotify_queue_position(),l.remove&&f.detach())})},f.animate_in=function(e){s="in";var t;t="undefined"!=typeof l.animation.effect_in?l.animation.effect_in:l.animation,"none"==t?(f.show(),e()):"show"==t?f.show(l.animate_speed,e):"fade"==t?f.show().fadeTo(l.animate_speed,l.opacity,e):"slide"==t?f.slideDown(l.animate_speed,e):"function"==typeof t?t("in",e,f):f.show(t,"object"==typeof l.animation.options_in?l.animation.options_in:{},l.animate_speed,e)},f.animate_out=function(e){s="out";var t;t="undefined"!=typeof l.animation.effect_out?l.animation.effect_out:l.animation,"none"==t?(f.hide(),e()):"show"==t?f.hide(l.animate_speed,e):"fade"==t?f.fadeOut(l.animate_speed,e):"slide"==t?f.slideUp(l.animate_speed,e):"function"==typeof t?t("out",e,f):f.hide(t,"object"==typeof l.animation.options_out?l.animation.options_out:{},l.animate_speed,e)},f.pnotify_cancel_remove=function(){f.timer&&window.clearTimeout(f.timer)},f.pnotify_queue_remove=function(){f.pnotify_cancel_remove(),f.timer=window.setTimeout(function(){f.pnotify_remove()},isNaN(l.delay)?0:l.delay)},f.closer=e("<div />",{"class":"ui-pnotify-closer",css:{cursor:"pointer",visibility:l.closer_hover?"hidden":"visible"},click:function(){f.pnotify_remove(),f.sticker.css("visibility","hidden"),f.closer.css("visibility","hidden")}}).append(e("<span />",{"class":p.closer,title:l.labels.close})).appendTo(f.container),(!l.closer||l.nonblock)&&f.closer.css("display","none"),f.sticker=e("<div />",{"class":"ui-pnotify-sticker",css:{cursor:"pointer",visibility:l.sticker_hover?"hidden":"visible"},click:function(){l.hide=!l.hide,l.hide?f.pnotify_queue_remove():f.pnotify_cancel_remove(),e(this).trigger("pnotify_icon")}}).bind("pnotify_icon",function(){e(this).children().removeClass(p.pin_up+" "+p.pin_down).addClass(l.hide?p.pin_up:p.pin_down)}).append(e("<span />",{"class":p.pin_up,title:l.labels.stick})).appendTo(f.container),(!l.sticker||l.nonblock)&&f.sticker.css("display","none"),l.icon!==!1&&e("<div />",{"class":"ui-pnotify-icon"}).append(e("<span />",{"class":l.icon===!0?"error"==l.type?p.error_icon:"info"==l.type?p.info_icon:"success"==l.type?p.success_icon:p.notice_icon:l.icon})).prependTo(f.container),f.title_container=e("<span />",{"class":"ui-pnotify-title"}).appendTo(f.container),l.title===!1?f.title_container.hide():l.title_escape?f.title_container.text(l.title):f.title_container.html(l.title),f.text_container=e("<div />",{"class":"ui-pnotify-text"}).appendTo(f.container),l.text===!1?f.text_container.hide():l.text_escape?f.text_container.text(l.text):f.text_container.html(l.insert_brs?String(l.text).replace(/\n/g,"<br />"):l.text),"string"==typeof l.width&&f.css("width",l.width),"string"==typeof l.min_height&&f.container.css("min-height",l.min_height),f.pnotify_history=l.history,f.pnotify_hide=l.hide;var m=o.data("pnotify");if((null==m||"object"!=typeof m)&&(m=[]),m="top"==l.stack.push?e.merge([f],m):e.merge(m,[f]),o.data("pnotify",m),"top"==l.stack.push&&f.pnotify_queue_position(1),l.after_init&&l.after_init(f),l.history){var v=o.data("pnotify_history");if("undefined"==typeof v){v=e("<div />",{"class":"ui-pnotify-history-container "+p.hi_menu,mouseleave:function(){v.animate({top:"-"+t+"px"},{duration:100,queue:!1})}}).append(e("<div />",{"class":"ui-pnotify-history-header",text:l.labels.redisplay})).append(e("<button />",{"class":"ui-pnotify-history-all "+p.hi_btn,text:l.labels.all,mouseenter:function(){e(this).addClass(p.hi_btnhov)},mouseleave:function(){e(this).removeClass(p.hi_btnhov)},click:function(){return e.each(m,function(){this.pnotify_history&&(this.is(":visible")?this.pnotify_hide&&this.pnotify_queue_remove():this.pnotify_display&&this.pnotify_display())}),!1}})).append(e("<button />",{"class":"ui-pnotify-history-last "+p.hi_btn,text:l.labels.last,mouseenter:function(){e(this).addClass(p.hi_btnhov)},mouseleave:function(){e(this).removeClass(p.hi_btnhov)},click:function(){var e,t=-1;do{if(e=-1==t?m.slice(t):m.slice(t,t+1),!e[0])break;t--}while(!e[0].pnotify_history||e[0].is(":visible"));return e[0]?(e[0].pnotify_display&&e[0].pnotify_display(),!1):!1}})).appendTo(i);var y=e("<span />",{"class":"ui-pnotify-history-pulldown "+p.hi_hnd,mouseenter:function(){v.animate({top:"0"},{duration:100,queue:!1})}}).appendTo(v);t=y.offset().top+2,v.css({top:"-"+t+"px"}),o.data("pnotify_history",v)}}return l.stack.animation=!1,l.auto_display&&f.pnotify_display(),f}});var s=/^on/,l=/^(dbl)?click$|^mouse(move|down|up|over|out|enter|leave)$|^contextmenu$/,c=/^(focus|blur|select|change|reset)$|^key(press|down|up)$/,u=/^(scroll|resize|(un)?load|abort|error)$/,d=function(t,n){var i;if(t=t.toLowerCase(),document.createEvent&&this.dispatchEvent){if(t=t.replace(s,""),t.match(l)?(e(this).offset(),i=document.createEvent("MouseEvents"),i.initMouseEvent(t,n.bubbles,n.cancelable,n.view,n.detail,n.screenX,n.screenY,n.clientX,n.clientY,n.ctrlKey,n.altKey,n.shiftKey,n.metaKey,n.button,n.relatedTarget)):t.match(c)?(i=document.createEvent("UIEvents"),i.initUIEvent(t,n.bubbles,n.cancelable,n.view,n.detail)):t.match(u)&&(i=document.createEvent("HTMLEvents"),i.initEvent(t,n.bubbles,n.cancelable)),!i)return;this.dispatchEvent(i)}else t.match(s)||(t="on"+t),i=document.createEventObject(n),this.fireEvent(t,i)};e.pnotify.defaults={title:!1,title_escape:!1,text:!1,text_escape:!1,styling:"bootstrap",addclass:"",cornerclass:"",nonblock:!1,nonblock_opacity:.2,history:!0,maxonscreen:1/0,auto_display:!0,width:"300px",min_height:"16px",type:"notice",icon:!0,animation:"fade",animate_speed:"slow",position_animate_speed:500,opacity:1,shadow:!0,closer:!0,closer_hover:!0,sticker:!0,sticker_hover:!0,hide:!0,delay:8e3,mouse_reset:!0,remove:!0,insert_brs:!0,stack:{dir1:"down",dir2:"left",push:"bottom",spacing1:25,spacing2:25},labels:{redisplay:"Redisplay",all:"All",last:"Last",close:"Close",stick:"Stick"}}}(jQuery),"document"in self&&!("classList"in document.createElement("_")&&"classList"in document.createElementNS("http://www.w3.org/2000/svg","svg"))&&function(e){"use strict";if("Element"in e){var t="classList",n="prototype",i=e.Element[n],o=Object,a=String[n].trim||function(){return this.replace(/^\s+|\s+$/g,"")},r=Array[n].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1},s=function(e,t){this.name=e,this.code=DOMException[e],this.message=t},l=function(e,t){if(""===t)throw new s("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(t))throw new s("INVALID_CHARACTER_ERR","String contains an invalid character");return r.call(e,t)},c=function(e){for(var t=a.call(e.getAttribute("class")),n=t?t.split(/\s+/):[],i=0,o=n.length;o>i;i++)this.push(n[i]);this._updateClassName=function(){e.setAttribute("class",this.toString())}},u=c[n]=[],d=function(){return new c(this)};if(s[n]=Error[n],u.item=function(e){return this[e]||null},u.contains=function(e){return e+="",-1!==l(this,e)},u.add=function(){var e,t=arguments,n=0,i=t.length,o=!1;do e=t[n]+"",-1===l(this,e)&&(this.push(e),o=!0);while(++n<i);o&&this._updateClassName()},u.remove=function(){var e,t=arguments,n=0,i=t.length,o=!1;do{e=t[n]+"";var a=l(this,e);-1!==a&&(this.splice(a,1),o=!0)}while(++n<i);o&&this._updateClassName()},u.toggle=function(e,t){e+="";var n=this.contains(e),i=n?t!==!0&&"remove":t!==!1&&"add";return i&&this[i](e),!n},u.toString=function(){return this.join(" ")},o.defineProperty){var h={get:d,enumerable:!0,configurable:!0};try{o.defineProperty(i,t,h)}catch(p){-2146823252===p.number&&(h.enumerable=!1,o.defineProperty(i,t,h))}}else o[n].__defineGetter__&&i.__defineGetter__(t,d)}}(self);var go=function(){function e(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}function t(t){var n=!1,i=function(){n||(n=!0,t())};document.write('<script defer src="//:" id="__onload_ie_pixastic__"></script>');var o=document.getElementById("__onload_ie_pixastic__");o.onreadystatechange=function(){"complete"==o.readyState&&(o.parentNode.removeChild(o),i())},document.addEventListener&&document.addEventListener("DOMContentLoaded",i,!1),e(window,"load",i)}function n(){for(var e=o("pixastic",null,"img"),t=o("pixastic",null,"canvas"),n=e.concat(t),i=0;i<n.length;i++)!function(){for(var e=n[i],t=[],o=e.className.split(" "),a=0;a<o.length;a++){var r=o[a];if("pixastic-"==r.substring(0,9)){var s=r.substring(9);""!=s&&t.push(s)}}if(t.length)if("img"==e.tagName.toLowerCase()){var l=new Image;if(l.src=e.src,l.complete)for(var c=0;c<t.length;c++){var u=go.applyAction(e,e,t[c],null);u&&(e=u)}else l.onload=function(){for(var n=0;n<t.length;n++){var i=go.applyAction(e,e,t[n],null);i&&(e=i)}}}else setTimeout(function(){for(var n=0;n<t.length;n++){var i=go.applyAction(e,e,t[n],null);i&&(e=i)}},1)}()}function o(e,t,n){var o=new Array;null==t&&(t=document),null==n&&(n="*");var a=t.getElementsByTagName(n),r=a.length,s=new RegExp("(^|\\s)"+e+"(\\s|$)");for(i=0,j=0;r>i;i++)s.test(a[i].className)&&(o[j]=a[i],j++);return o}function a(e,t){if(go.debug)try{switch(t){case"warn":console.warn("Pixastic:",e);break;case"error":console.error("Pixastic:",e);break;default:console.log("Pixastic:",e)}}catch(n){}}"undefined"!=typeof pixastic_parseonload&&pixastic_parseonload&&t(n);var r=function(){var e=document.createElement("canvas"),t=!1;try{t=!("function"!=typeof e.getContext||!e.getContext("2d"))}catch(n){}return function(){return t}}(),s=function(){var e,t=document.createElement("canvas"),n=!1;try{"function"==typeof t.getContext&&(e=t.getContext("2d"))&&(n="function"==typeof e.getImageData)}catch(i){}return function(){return n}}(),l=function(){var e=!1,t=document.createElement("canvas");if(r()&&s()){t.width=t.height=1;var n=t.getContext("2d");n.fillStyle="rgb(255,0,0)",n.fillRect(0,0,1,1);var i=document.createElement("canvas");i.width=i.height=1;var o=i.getContext("2d");o.fillStyle="rgb(0,0,255)",o.fillRect(0,0,1,1),n.globalAlpha=.5,n.drawImage(i,0,0);var a=n.getImageData(0,0,1,1).data;e=255!=a[2]}return function(){return e}}();return{parseOnLoad:!1,debug:!1,applyAction:function(e,t,n,i){i=i||{};var o="canvas"==e.tagName.toLowerCase();if(o&&go.Client.isIE())return go.debug&&a("Tried to process a canvas element but browser is IE."),!1;var r,s,l=!1;go.Client.hasCanvas()&&(l=!!i.resultCanvas,r=i.resultCanvas||document.createElement("canvas"),s=r.getContext("2d"));var c=e.offsetWidth,u=e.offsetHeight;if(o&&(c=e.width,u=e.height),0==c||0==u){if(null!=e.parentNode)return go.debug&&a("Image has 0 width and/or height."),void 0;var d=e.style.position,h=e.style.left;e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),c=e.offsetWidth,u=e.offsetHeight,document.body.removeChild(e),e.style.position=d,e.style.left=h}if(n.indexOf("(")>-1){var p=n;n=p.substr(0,p.indexOf("("));var f=p.match(/\((.*?)\)/);if(f[1]){f=f[1].split(";");for(var g=0;g<f.length;g++)if(thisArg=f[g].split("="),2==thisArg.length)if("rect"==thisArg[0]){var m=thisArg[1].split(",");i[thisArg[0]]={left:parseInt(m[0],10)||0,top:parseInt(m[1],10)||0,width:parseInt(m[2],10)||0,height:parseInt(m[3],10)||0}}else i[thisArg[0]]=thisArg[1]}}i.rect?(i.rect.left=Math.round(i.rect.left),i.rect.top=Math.round(i.rect.top),i.rect.width=Math.round(i.rect.width),i.rect.height=Math.round(i.rect.height)):i.rect={left:0,top:0,width:c,height:u};var v=!1;if(go.Actions[n]&&"function"==typeof go.Actions[n].process&&(v=!0),!v)return go.debug&&a('Invalid action "'+n+'". Maybe file not included?'),!1;if(!go.Actions[n].checkSupport())return go.debug&&a('Action "'+n+'" not supported by this browser.'),!1;go.Client.hasCanvas()?(r!==e&&(r.width=c,r.height=u),l||(r.style.width=c+"px",r.style.height=u+"px"),s.drawImage(t,0,0,c,u),e.__pixastic_org_image?(r.__pixastic_org_image=e.__pixastic_org_image,r.__pixastic_org_width=e.__pixastic_org_width,r.__pixastic_org_height=e.__pixastic_org_height):(r.__pixastic_org_image=e,r.__pixastic_org_width=c,r.__pixastic_org_height=u)):go.Client.isIE()&&"undefined"==typeof e.__pixastic_org_style&&(e.__pixastic_org_style=e.style.cssText);var y={image:e,canvas:r,width:c,height:u,useData:!0,options:i},b=go.Actions[n].process(y);return b?go.Client.hasCanvas()?(y.useData&&go.Client.hasCanvasImageData()&&(r.getContext("2d").putImageData(y.canvasData,i.rect.left,i.rect.top),r.getContext("2d").fillRect(0,0,0,0)),i.leaveDOM||(r.title=e.title,r.imgsrc=e.imgsrc,o||(r.alt=e.alt),o||(r.imgsrc=e.src),r.className=e.className,r.style.cssText=e.style.cssText,r.name=e.name,r.tabIndex=e.tabIndex,r.id=e.id,e.parentNode&&e.parentNode.replaceChild&&e.parentNode.replaceChild(r,e)),i.resultCanvas=r,r):e:!1},prepareData:function(e,t){var n=e.canvas.getContext("2d"),i=e.options.rect,o=n.getImageData(i.left,i.top,i.width,i.height),a=o.data;return t||(e.canvasData=o),a},process:function(e,t,n,i){if("img"==e.tagName.toLowerCase()){var o=new Image;if(o.src=e.src,o.complete){var a=go.applyAction(e,o,t,n);return i&&i(a),a}o.onload=function(){var a=go.applyAction(e,o,t,n);i&&i(a)}}if("canvas"==e.tagName.toLowerCase()){var a=go.applyAction(e,e,t,n);return i&&i(a),a}},revert:function(e){if(go.Client.hasCanvas()){if("canvas"==e.tagName.toLowerCase()&&e.__pixastic_org_image)return e.width=e.__pixastic_org_width,e.height=e.__pixastic_org_height,e.getContext("2d").drawImage(e.__pixastic_org_image,0,0),e.parentNode&&e.parentNode.replaceChild&&e.parentNode.replaceChild(e.__pixastic_org_image,e),e}else go.Client.isIE()&&"undefined"!=typeof e.__pixastic_org_style&&(e.style.cssText=e.__pixastic_org_style)},Client:{hasCanvas:r,hasCanvasImageData:s,hasGlobalAlpha:l,isIE:function(){return!!document.all&&!!window.attachEvent&&!window.opera}},Actions:{}}}();go.Actions.blur={process:function(e){if("undefined"==typeof e.options.fixMargin&&(e.options.fixMargin=!0),go.Client.hasCanvasImageData()){for(var t=go.prepareData(e),n=go.prepareData(e,!0),i=[[0,1,0],[1,2,1],[0,1,0]],o=0,a=0;3>a;a++)for(var r=0;3>r;r++)o+=i[a][r];o=1/(2*o);var s=e.options.rect,l=s.width,c=s.height,u=4*l,d=c;do{var h=(d-1)*u,p=1==d?0:d-2,f=d==c?d-1:d,g=4*p*l,m=4*f*l,v=l;do{var y=h+(4*v-4),b=g+4*(1==v?0:v-2),w=m+4*(v==l?v-1:v);t[y]=(2*(n[b]+n[y-4]+n[y+4]+n[w])+4*n[y])*o,t[y+1]=(2*(n[b+1]+n[y-3]+n[y+5]+n[w+1])+4*n[y+1])*o,t[y+2]=(2*(n[b+2]+n[y-2]+n[y+6]+n[w+2])+4*n[y+2])*o}while(--v)}while(--d);return!0}return go.Client.isIE()?(e.image.style.filter+=" progid:DXImageTransform.Microsoft.Blur(pixelradius=1.5)",e.options.fixMargin&&(e.image.style.marginLeft=(parseInt(e.image.style.marginLeft,10)||0)-2+"px",e.image.style.marginTop=(parseInt(e.image.style.marginTop,10)||0)-2+"px"),!0):void 0},checkSupport:function(){return go.Client.hasCanvasImageData()||go.Client.isIE()}},go.Actions.brightness={process:function(e){var t=parseInt(e.options.brightness,10)||0,n=parseFloat(e.options.contrast)||0,i=!(!e.options.legacy||"false"==e.options.legacy);if(i)t=Math.min(150,Math.max(-150,t));else var o=1+Math.min(150,Math.max(-150,t))/150;if(n=Math.max(0,n+1),go.Client.hasCanvasImageData()){var a,r,s,l,c=go.prepareData(e),u=e.options.rect,d=u.width,h=u.height,p=d*h,f=4*p;1!=n?i?(s=n,l=(t-128)*n+128):(s=o*n,l=128*-n+128):i?(s=1,l=t):(s=o,l=0);for(var g,m,v;p--;)c[f]=(g=c[f-=4]*s+l)>255?255:0>g?0:g,c[a]=(m=c[a=f+1]*s+l)>255?255:0>m?0:m,c[r]=(v=c[r=f+2]*s+l)>255?255:0>v?0:v;return!0}},checkSupport:function(){return go.Client.hasCanvasImageData()}},go.Actions.coloradjust={process:function(e){var t=parseFloat(e.options.red)||0,n=parseFloat(e.options.green)||0,i=parseFloat(e.options.blue)||0;if(t=Math.round(255*t),n=Math.round(255*n),i=Math.round(255*i),go.Client.hasCanvasImageData()){for(var o,a,r,s,l,c=go.prepareData(e),u=e.options.rect,d=u.width*u.height,h=4*d;d--;)h-=4,t&&(c[h]=(r=c[h]+t)<0?0:r>255?255:r),n&&(c[o]=(s=c[o=h+1]+n)<0?0:s>255?255:s),i&&(c[a]=(l=c[a=h+2]+i)<0?0:l>255?255:l);return!0}},checkSupport:function(){return go.Client.hasCanvasImageData()}},go.Actions.desaturate={process:function(e){var t=!(!e.options.average||"false"==e.options.average);if(go.Client.hasCanvasImageData()){var n,i,o=go.prepareData(e),a=e.options.rect,r=a.width,s=a.height,l=r*s,c=4*l;if(t)for(;l--;)o[c-=4]=o[n=c+1]=o[i=c+2]=(o[c]+o[n]+o[i])/3;else for(;l--;)o[c-=4]=o[n=c+1]=o[i=c+2]=.3*o[c]+.59*o[n]+.11*o[i];return!0}return go.Client.isIE()?(e.image.style.filter+=" gray",!0):void 0},checkSupport:function(){return go.Client.hasCanvasImageData()||go.Client.isIE()}},go.Actions.glow={process:function(e){var t=parseFloat(e.options.amount)||0,n=parseFloat(e.options.radius)||0;if(t=Math.min(1,Math.max(0,t)),n=Math.min(5,Math.max(0,n)),go.Client.hasCanvasImageData()){var i=e.options.rect,o=document.createElement("canvas");o.width=e.width,o.height=e.height;var a=o.getContext("2d");a.drawImage(e.canvas,0,0);var r=2,s=Math.round(e.width/r),l=Math.round(e.height/r),c=document.createElement("canvas");c.width=s,c.height=l;for(var u=Math.round(20*n),d=c.getContext("2d"),h=0;u>h;h++){var p=Math.max(1,Math.round(s-h)),f=Math.max(1,Math.round(l-h));
d.clearRect(0,0,s,l),d.drawImage(o,0,0,e.width,e.height,0,0,p,f),a.clearRect(0,0,e.width,e.height),a.drawImage(c,0,0,p,f,0,0,e.width,e.height)}for(var g=go.prepareData(e),m=go.prepareData({canvas:o,options:e.options}),v=i.width*i.height,y=4*v,b=y+1,w=y+2;v--;)(g[y-=4]+=t*m[y])>255&&(g[y]=255),(g[b-=4]+=t*m[b])>255&&(g[b]=255),(g[w-=4]+=t*m[w])>255&&(g[w]=255);return!0}},checkSupport:function(){return go.Client.hasCanvasImageData()}},go.Actions.hsl={process:function(e){var t=parseInt(e.options.hue,10)||0,n=(parseInt(e.options.saturation,10)||0)/100,i=(parseInt(e.options.lightness,10)||0)/100;if(0>n)var o=1+n;else var o=1+2*n;t=t%360/360;var a=6*t,r=255*i,s=1+i,l=1-i;if(go.Client.hasCanvasImageData()){for(var c=go.prepareData(e),u=e.options.rect,d=u.width*u.height,h=4*d,p=h+1,f=h+2;d--;){var g=c[h-=4],m=c[p=h+1],v=c[f=h+2];if(0!=t||0!=n){var y=g;m>y&&(y=m),v>y&&(y=v);var b=g;b>m&&(b=m),b>v&&(b=v);var w=y-b,C=(b+y)/510;if(C>0&&w>0){if(.5>=C){var T=w/(y+b)*o;T>1&&(T=1);var E=C*(1+T)}else{var T=w/(510-y-b)*o;T>1&&(T=1);var E=C+T-C*T}if(g==y)if(m==b)var S=5+(y-v)/w+a;else var S=1-(y-m)/w+a;else if(m==y)if(v==b)var S=1+(y-g)/w+a;else var S=3-(y-v)/w+a;else if(g==b)var S=3+(y-m)/w+a;else var S=5-(y-g)/w+a;0>S&&(S+=6),S>=6&&(S-=6);var x=C+C-E,_=S>>0;0==_?(g=255*E,m=255*(x+(E-x)*(S-_)),v=255*x):1==_?(g=255*(E-(E-x)*(S-_)),m=255*E,v=255*x):2==_?(g=255*x,m=255*E,v=255*(x+(E-x)*(S-_))):3==_?(g=255*x,m=255*(E-(E-x)*(S-_)),v=255*E):4==_?(g=255*(x+(E-x)*(S-_)),m=255*x,v=255*E):5==_&&(g=255*E,m=255*x,v=255*(E-(E-x)*(S-_)))}}0>i?(g*=s,m*=s,v*=s):i>0&&(g=g*l+r,m=m*l+r,v=v*l+r),c[h]=0>g?0:g>255?255:g,c[p]=0>m?0:m>255?255:m,c[f]=0>v?0:v>255?255:v}return!0}},checkSupport:function(){return go.Client.hasCanvasImageData()}},go.Actions.invert={process:function(e){if(go.Client.hasCanvasImageData()){for(var t=go.prepareData(e),n=!!e.options.invertAlpha,i=e.options.rect,o=i.width*i.height,a=4*o,r=a+1,s=a+2,l=a+3;o--;)t[a-=4]=255-t[a],t[r-=4]=255-t[r],t[s-=4]=255-t[s],n&&(t[l-=4]=255-t[l]);return!0}return go.Client.isIE()?(e.image.style.filter+=" invert",!0):void 0},checkSupport:function(){return go.Client.hasCanvasImageData()||go.Client.isIE()}},go.Actions.posterize={process:function(e){var t=256;if("undefined"!=typeof e.options.levels&&(t=parseInt(e.options.levels,10)||1),go.Client.hasCanvasImageData()){var n=go.prepareData(e);t=Math.max(2,Math.min(256,t));var i=256/t,o=256/(t-1),a=e.options.rect,r=a.width,s=a.height,l=4*r,c=s;do{var u=(c-1)*l,d=r;do{var h=u+4*(d-1),p=o*(n[h]/i>>0),f=o*(n[h+1]/i>>0),g=o*(n[h+2]/i>>0);p>255&&(p=255),f>255&&(f=255),g>255&&(g=255),n[h]=p,n[h+1]=f,n[h+2]=g}while(--d)}while(--c);return!0}},checkSupport:function(){return go.Client.hasCanvasImageData()}},go.Actions.removenoise={process:function(e){if(go.Client.hasCanvasImageData()){var t=go.prepareData(e),n=e.options.rect,i=n.width,o=n.height,a=4*i,r=o;do{var s=(r-1)*a,l=r==o?r-1:r,c=1==r?0:r-2,u=4*c*i,d=4*l*i,h=i;do{var p,f,g,m,v,y,b=s+(4*h-4),w=u+4*(1==h?0:h-2),C=d+4*(h==i?h-1:h);p=f=t[w];var T=t[b-4],E=t[b+4],S=t[C];p>T&&(p=T),p>E&&(p=E),p>S&&(p=S),T>f&&(f=T),E>f&&(f=E),S>f&&(f=S),g=m=t[w+1];var x=t[b-3],_=t[b+5],R=t[C+1];g>x&&(g=x),g>_&&(g=_),g>R&&(g=R),x>m&&(m=x),_>m&&(m=_),R>m&&(m=R),v=y=t[w+2];var k=t[b-2],N=t[b+6],D=t[C+2];v>k&&(v=k),v>N&&(v=N),v>D&&(v=D),k>y&&(y=k),N>y&&(y=N),D>y&&(y=D),t[b]>f?t[b]=f:t[b]<p&&(t[b]=p),t[b+1]>m?t[b+1]=m:t[b+1]<g&&(t[b+1]=g),t[b+2]>y?t[b+2]=y:t[b+2]<v&&(t[b+2]=v)}while(--h)}while(--r);return!0}},checkSupport:function(){return go.Client.hasCanvasImageData()}},go.Actions.sepia={process:function(e){var t=parseInt(e.options.mode,10)||0;if(0>t&&(t=0),t>1&&(t=1),go.Client.hasCanvasImageData()){var n=go.prepareData(e),i=e.options.rect,o=i.width,a=i.height,r=4*o,s=a;do{var l=(s-1)*r,c=o;do{var u=l+4*(c-1);if(t)var d=.299*n[u]+.587*n[u+1]+.114*n[u+2],h=d+39,p=d+14,f=d-36;else var g=n[u],m=n[u+1],v=n[u+2],h=.393*g+.769*m+.189*v,p=.349*g+.686*m+.168*v,f=.272*g+.534*m+.131*v;0>h&&(h=0),h>255&&(h=255),0>p&&(p=0),p>255&&(p=255),0>f&&(f=0),f>255&&(f=255),n[u]=h,n[u+1]=p,n[u+2]=f}while(--c)}while(--s);return!0}},checkSupport:function(){return go.Client.hasCanvasImageData()}},go.Actions.sharpen={process:function(e){var t=0;if("undefined"!=typeof e.options.amount&&(t=parseFloat(e.options.amount)||0),0>t&&(t=0),t>1&&(t=1),go.Client.hasCanvasImageData()){for(var n=go.prepareData(e),i=go.prepareData(e,!0),o=15,a=1+3*t,r=[[0,-a,0],[-a,o,-a],[0,-a,0]],s=0,l=0;3>l;l++)for(var c=0;3>c;c++)s+=r[l][c];s=1/s;var u=e.options.rect,d=u.width,h=u.height;o*=s,a*=s;var p=4*d,f=h;do{var g=(f-1)*p,m=f==h?f-1:f,v=1==f?0:f-2,y=v*p,b=m*p,w=d;do{var C=g+(4*w-4),T=y+4*(1==w?0:w-2),E=b+4*(w==d?w-1:w),S=(-i[T]-i[C-4]-i[C+4]-i[E])*a+i[C]*o,x=(-i[T+1]-i[C-3]-i[C+5]-i[E+1])*a+i[C+1]*o,_=(-i[T+2]-i[C-2]-i[C+6]-i[E+2])*a+i[C+2]*o;0>S&&(S=0),0>x&&(x=0),0>_&&(_=0),S>255&&(S=255),x>255&&(x=255),_>255&&(_=255),n[C]=S,n[C+1]=x,n[C+2]=_}while(--w)}while(--f);return!0}},checkSupport:function(){return go.Client.hasCanvasImageData()}},go.Actions.solarize={process:function(e){if(!(!e.options.average||"false"==e.options.average),go.Client.hasCanvasImageData()){var t=go.prepareData(e),n=e.options.rect,i=n.width,o=n.height,a=4*i,r=o;do{var s=(r-1)*a,l=i;do{var c=s+4*(l-1),u=t[c],d=t[c+1],h=t[c+2];u>127&&(u=255-u),d>127&&(d=255-d),h>127&&(h=255-h),t[c]=u,t[c+1]=d,t[c+2]=h}while(--l)}while(--r);return!0}},checkSupport:function(){return go.Client.hasCanvasImageData()}},function(e){function t(e,t){var n=typeof e[t];return n==w||!(n!=b||!e[t])||"unknown"==n}function n(e,t){return!(typeof e[t]!=b||!e[t])}function i(e,t){return typeof e[t]!=C}function o(e){return function(t,n){for(var i=n.length;i--;)if(!e(t,n[i]))return!1;return!0}}function a(e){return e&&_(e,x)&&k(e,S)}function r(e){return n(e,"body")?e.body:e.getElementsByTagName("body")[0]}function s(e){n(window,"console")&&t(window.console,"log")&&window.console.log(e)}function l(e,t){t?window.alert(e):s(e)}function c(e){D.initialized=!0,D.supported=!1,l("Rangy is not supported on this page in your browser. Reason: "+e,D.config.alertOnFail)}function u(e){l("Rangy warning: "+e,D.config.alertOnWarn)}function d(e){return e.message||e.description||String(e)}function h(){if(!D.initialized){var e,n=!1,i=!1;t(document,"createRange")&&(e=document.createRange(),_(e,E)&&k(e,T)&&(n=!0),e.detach());var o=r(document);if(!o||"body"!=o.nodeName.toLowerCase())return c("No body element found"),void 0;if(o&&t(o,"createTextRange")&&(e=o.createTextRange(),a(e)&&(i=!0)),!n&&!i)return c("Neither Range nor TextRange are available"),void 0;D.initialized=!0,D.features={implementsDomRange:n,implementsTextRange:i};var l,u;for(var h in N)(l=N[h])instanceof f&&l.init(l,D);for(var p=0,g=O.length;g>p;++p)try{O[p](D)}catch(m){u="Rangy init listener threw an exception. Continuing. Detail: "+d(m),s(u)}}}function p(e){e=e||window,h();for(var t=0,n=I.length;n>t;++t)I[t](e)}function f(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function g(e,t,n,i){var o=new f(t,n,function(e){if(!e.initialized){e.initialized=!0;try{i(D,e),e.supported=!0}catch(n){var o="Module '"+t+"' failed to load: "+d(n);s(o)}}});N[t]=o}function m(){}function v(){}var y="function"==typeof e.define&&e.define.amd,b="object",w="function",C="undefined",T=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],E=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],S=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],x=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],_=o(t),R=o(n),k=o(i),N={},D={version:"1.3alpha.",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:n,isHostProperty:i,areHostMethods:_,areHostObjects:R,areHostProperties:k,isTextRange:a,getBody:r},features:{},modules:N,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1}};D.fail=c,D.warn=u,{}.hasOwnProperty?D.util.extend=function(e,t,n){var i,o;for(var a in t)t.hasOwnProperty(a)&&(i=e[a],o=t[a],n&&null!==i&&"object"==typeof i&&null!==o&&"object"==typeof o&&D.util.extend(i,o,!0),e[a]=o);return e}:c("hasOwnProperty not supported"),function(){var e=document.createElement("div");e.appendChild(document.createElement("span"));var t,n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(t=function(e){return n.call(e,0)})}catch(i){}t||(t=function(e){for(var t=[],n=0,i=e.length;i>n;++n)t[n]=e[n];return t}),D.util.toArray=t}();var A;t(document,"addEventListener")?A=function(e,t,n){e.addEventListener(t,n,!1)}:t(document,"attachEvent")?A=function(e,t,n){e.attachEvent("on"+t,n)}:c("Document does not have required addEventListener or attachEvent method"),D.util.addListener=A;var O=[];D.init=h,D.addInitListener=function(e){D.initialized?e(D):O.push(e)};var I=[];D.addCreateMissingNativeApiListener=function(e){I.push(e)},D.createMissingNativeApi=p,f.prototype={init:function(){for(var e,t,n=this.dependencies||[],i=0,o=n.length;o>i;++i){if(t=n[i],e=N[t],!(e&&e instanceof f))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error("Module '"+this.name+"' failed to load: "+e)},warn:function(e){D.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){D.warn("DEPRECATED: "+e+" in module "+this.name+"is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},D.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]),g(!1,e,n,t)},D.createCoreModule=function(e,t,n){g(!0,e,t,n)},D.RangePrototype=m,D.rangePrototype=new m,D.selectionPrototype=new v;var P=!1,M=function(){P||(P=!0,D.initialized||h())};return typeof window==C?(c("No window found"),void 0):typeof document==C?(c("No document found"),void 0):(t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",M,!1),A(window,"load",M),y&&e.define(function(){return D.amd=!0,D}),e.rangy=D,void 0)}(this),rangy.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==N||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function i(e){var t=e.parentNode;return 1==t.nodeType?t:null}function o(e){for(var t=0;e=e.previousSibling;)++t;return t}function a(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function r(e,t){var n,i=[];for(n=e;n;n=n.parentNode)i.push(n);for(n=t;n;n=n.parentNode)if(I(i,n))return n;return null}function s(e,t,n){for(var i=n?t:t.parentNode;i;){if(i===e)return!0;i=i.parentNode}return!1}function l(e,t){return s(e,t,!0)}function c(e,t,n){for(var i,o=n?e:e.parentNode;o;){if(i=o.parentNode,i===t)return o;o=i}return null}function u(e){var t=e.nodeType;return 3==t||4==t||8==t}function d(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function h(e,t){var n=t.nextSibling,i=t.parentNode;return n?i.insertBefore(e,n):i.appendChild(e),e}function p(e,t,n){var i=e.cloneNode(!1);if(i.deleteData(0,t),e.deleteData(t,e.length-t),h(i,e),n)for(var a,r=0;a=n[r++];)a.node==e&&a.offset>t?(a.node=i,a.offset-=t):a.node==e.parentNode&&a.offset>o(e)&&++a.offset;return i}function f(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=N)return e.ownerDocument;if(typeof e.document!=N)return e.document;if(e.parentNode)return f(e.parentNode);throw t.createError("getDocument: no document found for node")}function g(e){var n=f(e);if(typeof n.defaultView!=N)return n.defaultView;if(typeof n.parentWindow!=N)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=N)return e.contentDocument;if(typeof e.contentWindow!=N)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){if(typeof e.contentWindow!=N)return e.contentWindow;if(typeof e.contentDocument!=N)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function y(e){return e&&D.isHostMethod(e,"setTimeout")&&D.isHostObject(e,"document")}function b(e,t,n){var i;if(e?D.isHostProperty(e,"nodeType")?i=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):f(e):y(e)&&(i=e.document):i=document,!i)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return i}function w(e){for(var t;t=e.parentNode;)e=t;return e}function C(e,n,i,a){var s,l,u,d,h;if(e==i)return n===a?0:a>n?-1:1;if(s=c(i,e,!0))return n<=o(s)?-1:1;if(s=c(e,i,!0))return o(s)<a?-1:1;if(l=r(e,i),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(u=e===l?l:c(e,l,!0),d=i===l?l:c(i,l,!0),u===d)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(h=l.firstChild;h;){if(h===u)return-1;if(h===d)return 1;h=h.nextSibling}}function T(e){try{return e.parentNode,!1}catch(t){return!0}}function E(e){if(!e)return"[No node]";if(P&&T(e))return"[Broken node]";if(u(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+o(e)+"]["+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function S(e){for(var t,n=f(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function x(e){this.root=e,this._next=e}function _(e){return new x(e)}function R(e,t){this.node=e,this.offset=t}function k(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var N="undefined",D=e.util;D.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),D.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var A=document.createElement("div");D.areHostMethods(A,["insertBefore","appendChild","cloneNode"]||!D.areHostObjects(A,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),D.isHostProperty(A,"innerHTML")||t.fail("Element is missing innerHTML property");var O=document.createTextNode("test");D.areHostMethods(O,["splitText","deleteData","insertData","appendData","cloneNode"]||!D.areHostObjects(A,["previousSibling","nextSibling","childNodes","parentNode"])||!D.areHostProperties(O,["data"]))||t.fail("Incomplete Text Node implementation");var I=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},P=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br>",P=T(n),e.features.crashyTextNodes=P}();var M;typeof window.getComputedStyle!=N?M=function(e,t){return g(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=N?M=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found"),x.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},R.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+E(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},k.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},k.prototype.toString=function(){return this.message},e.dom={arrayContains:I,isHtmlNamespace:n,parentElement:i,getNodeIndex:o,getNodeLength:a,getCommonAncestor:r,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:c,isCharacterDataNode:u,isTextOrCommentNode:d,insertAfter:h,splitDataNode:p,getDocument:f,getWindow:g,getIframeWindow:v,getIframeDocument:m,getBody:D.getBody,isWindow:y,getContentDocument:b,getRootContainer:w,comparePoints:C,isBrokenNode:T,inspectNode:E,getComputedStyleProperty:M,fragmentFromNodeChildren:S,createIterator:_,DomPosition:R},e.DOMException=k}),rangy.createCoreModule("DomRange",["DomUtil"],function(e){function t(e,t){return 3!=e.nodeType&&(j(e,t.startContainer)||j(e,t.endContainer))}function n(e){return e.document||W(e.startContainer)}function i(e){return new z(e.parentNode,U(e))}function o(e){return new z(e.parentNode,U(e)+1)}function a(e,t,n){var i=11==e.nodeType?e.firstChild:e;return H(t)?n==t.length?B.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:q(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),i}function r(e,t,i){if(_(e),_(t),n(t)!=n(e))throw new F("WRONG_DOCUMENT_ERR");var o=G(e.startContainer,e.startOffset,t.endContainer,t.endOffset),a=G(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return i?0>=o&&a>=0:0>o&&a>0}function s(e){for(var t,i,o,a=n(e.range).createDocumentFragment();i=e.next();){if(t=e.isPartiallySelectedSubtree(),i=i.cloneNode(!t),t&&(o=e.getSubtreeIterator(),i.appendChild(s(o)),o.detach(!0)),10==i.nodeType)throw new F("HIERARCHY_REQUEST_ERR");a.appendChild(i)}return a}function l(e,t,n){var i,o;n=n||{stop:!1};for(var a,r;a=e.next();)if(e.isPartiallySelectedSubtree()){if(t(a)===!1)return n.stop=!0,void 0;if(r=e.getSubtreeIterator(),l(r,t,n),r.detach(!0),n.stop)return}else for(i=B.createIterator(a);o=i.next();)if(t(o)===!1)return n.stop=!0,void 0}function c(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),c(t),t.detach(!0)):e.remove()}function u(e){for(var t,i,o=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),i=e.getSubtreeIterator(),t.appendChild(u(i)),i.detach(!0)):e.remove(),10==t.nodeType)throw new F("HIERARCHY_REQUEST_ERR");o.appendChild(t)}return o}function d(e,t,n){var i,o=!(!t||!t.length),a=!!n;o&&(i=new RegExp("^("+t.join("|")+")$"));var r=[];return l(new p(e,!1),function(t){if(!(o&&!i.test(t.nodeType)||a&&!n(t))){var s=e.startContainer;if(t!=s||!H(s)||e.startOffset!=s.length){var l=e.endContainer;t==l&&H(l)&&0==e.endOffset||r.push(t)}}}),r}function h(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+B.inspectNode(e.startContainer)+":"+e.startOffset+", "+B.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function p(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&H(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||H(this.sc)?V(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||H(this.ec)?V(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function f(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function g(e){return function(t,n){for(var i,o=n?t:t.parentNode;o;){if(i=o.nodeType,$(e,i))return o;o=o.parentNode}return null}}function m(e,t){if(ot(e,t))throw new f("INVALID_NODE_TYPE_ERR")}function v(e){if(!e.startContainer)throw new F("INVALID_STATE_ERR")}function y(e,t){if(!$(t,e.nodeType))throw new f("INVALID_NODE_TYPE_ERR")}function b(e,t){if(0>t||t>(H(e)?e.length:e.childNodes.length))throw new F("INDEX_SIZE_ERR")}function w(e,t){if(nt(e,!0)!==nt(t,!0))throw new F("WRONG_DOCUMENT_ERR")}function C(e){if(it(e,!0))throw new F("NO_MODIFICATION_ALLOWED_ERR")}function T(e,t){if(!e)throw new F(t)}function E(e){return Z&&B.isBrokenNode(e)||!$(Y,e.nodeType)&&!nt(e,!0)}function S(e,t){return t<=(H(e)?e.length:e.childNodes.length)}function x(e){return!!e.startContainer&&!!e.endContainer&&!E(e.startContainer)&&!E(e.endContainer)&&S(e.startContainer,e.startOffset)&&S(e.endContainer,e.endOffset)}function _(e){if(v(e),!x(e))throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function R(e,t){_(e);var n=e.startContainer,i=e.startOffset,o=e.endContainer,a=e.endOffset,r=n===o;H(o)&&a>0&&a<o.length&&q(o,a,t),H(n)&&i>0&&i<n.length&&(n=q(n,i,t),r?(a-=i,o=n):o==n.parentNode&&a>=U(n)&&a++,i=0),e.setStartAndEnd(n,i,o,a)}function k(e){e.START_TO_START=ut,e.START_TO_END=dt,e.END_TO_END=ht,e.END_TO_START=pt,e.NODE_BEFORE=ft,e.NODE_AFTER=gt,e.NODE_BEFORE_AND_AFTER=mt,e.NODE_INSIDE=vt}function N(e){k(e),k(e.prototype)}function D(e,t){return function(){_(this);var n,i,a=this.startContainer,r=this.startOffset,s=this.commonAncestorContainer,c=new p(this,!0);a!==s&&(n=V(a,s,!0),i=o(n),a=i.node,r=i.offset),l(c,C),c.reset();var u=e(c);return c.detach(),t(this,a,r,a,r),u}}function A(n,a,r){function s(e,t){return function(n){v(this),y(n,Q),y(X(n),Y);var a=(e?i:o)(n);(t?l:d)(this,a.node,a.offset)}}function l(e,t,n){var i=e.endContainer,o=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((X(t)!=X(i)||1==G(t,n,i,o))&&(i=t,o=n),a(e,t,n,i,o))}function d(e,t,n){var i=e.startContainer,o=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((X(t)!=X(i)||-1==G(t,n,i,o))&&(i=t,o=n),a(e,i,o,t,n))}var h=function(){};h.prototype=e.rangePrototype,n.prototype=new h,L.extend(n.prototype,{setStart:function(e,t){v(this),m(e,!0),b(e,t),l(this,e,t)},setEnd:function(e,t){v(this),m(e,!0),b(e,t),d(this,e,t)},setStartAndEnd:function(){v(this);var e=arguments,t=e[0],n=e[1],i=t,o=n;switch(e.length){case 3:o=e[2];break;case 4:i=e[2],o=e[3]}a(this,t,n,i,o)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:s(!0,!0),setStartAfter:s(!1,!0),setEndBefore:s(!0,!1),setEndAfter:s(!1,!1),collapse:function(e){_(this),e?a(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):a(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){v(this),m(e,!0),a(this,e,0,e,K(e))},selectNode:function(e){v(this),m(e,!1),y(e,Q);var t=i(e),n=o(e);a(this,t.node,t.offset,n.node,n.offset)},extractContents:D(u,a),deleteContents:D(c,a),canSurroundContents:function(){_(this),C(this.startContainer),C(this.endContainer);var e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},detach:function(){r(this)},splitBoundaries:function(){R(this)},splitBoundariesPreservingPositions:function(e){R(this,e)},normalizeBoundaries:function(){_(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,i=this.endOffset,o=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,i=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},r=function(o){var a=o.previousSibling;if(a&&a.nodeType==o.nodeType){e=o;var r=o.length;if(t=a.length,o.insertData(0,a.data),a.parentNode.removeChild(a),e==n)i+=t,n=e;else if(n==o.parentNode){var s=U(o);i==s?(n=o,i=r):i>s&&i--}}},s=!0;if(H(n))n.length==i&&o(n);else{if(i>0){var l=n.childNodes[i-1];l&&H(l)&&o(l)}s=!this.collapsed}if(s){if(H(e))0==t&&r(e);else if(t<e.childNodes.length){var c=e.childNodes[t];c&&H(c)&&r(c)}}else e=n,t=i;a(this,e,t,n,i)},collapseToPoint:function(e,t){v(this),m(e,!0),b(e,t),this.setStartAndEnd(e,t)}}),N(n)}function O(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:B.getCommonAncestor(e.startContainer,e.endContainer)}function I(e,t,n,i,o){e.startContainer=t,e.startOffset=n,e.endContainer=i,e.endOffset=o,e.document=B.getDocument(t),O(e)}function P(e){v(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=e.document=null,e.collapsed=e.commonAncestorContainer=null}function M(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,O(this)}var B=e.dom,L=e.util,z=B.DomPosition,F=e.DOMException,H=B.isCharacterDataNode,U=B.getNodeIndex,j=B.isOrIsAncestorOf,W=B.getDocument,G=B.comparePoints,q=B.splitDataNode,V=B.getClosestAncestorIn,K=B.getNodeLength,$=B.arrayContains,X=B.getRootContainer,Z=e.features.crashyTextNodes;p.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,H(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!H(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new M(n(this.range));var t=this._current,i=t,o=0,a=t,r=K(t);j(t,this.sc)&&(i=this.sc,o=this.so),j(t,this.ec)&&(a=this.ec,r=this.eo),I(e,i,o,a,r)}return new p(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},f.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},f.prototype.toString=function(){return this.message};var Q=[1,3,4,5,7,8,10],Y=[2,9,11],J=[5,6,10,12],et=[1,3,4,5,7,8,10,11],tt=[1,3,4,5,7,8],nt=g([9,11]),it=g(J),ot=g([6,10,12]),at=document.createElement("style"),rt=!1;try{at.innerHTML="<b>x</b>",rt=3==at.firstChild.nodeType}catch(st){}e.features.htmlParsingConforms=rt;var lt=rt?function(e){var t=this.startContainer,n=W(t);if(!t)throw new F("INVALID_STATE_ERR");var i=null;return 1==t.nodeType?i=t:H(t)&&(i=B.parentElement(t)),i=null===i||"HTML"==i.nodeName&&B.isHtmlNamespace(W(i).documentElement)&&B.isHtmlNamespace(i)?n.createElement("body"):i.cloneNode(!1),i.innerHTML=e,B.fragmentFromNodeChildren(i)}:function(e){v(this);var t=n(this),i=t.createElement("body");return i.innerHTML=e,B.fragmentFromNodeChildren(i)},ct=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ut=0,dt=1,ht=2,pt=3,ft=0,gt=1,mt=2,vt=3;L.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){_(this),w(this.startContainer,t.startContainer);var n,i,o,a,r=e==pt||e==ut?"start":"end",s=e==dt||e==ut?"start":"end";return n=this[r+"Container"],i=this[r+"Offset"],o=t[s+"Container"],a=t[s+"Offset"],G(n,i,o,a)},insertNode:function(e){if(_(this),y(e,et),C(this.startContainer),j(e,this.startContainer))throw new F("HIERARCHY_REQUEST_ERR");var t=a(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){_(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&H(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var i=new p(this,!0);return e=s(i),i.detach(),e},canSurroundContents:function(){_(this),C(this.startContainer),C(this.endContainer);var e=new p(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(y(e,tt),!this.canSurroundContents())throw new f("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);a(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){_(this);for(var e,t=new M(n(this)),i=ct.length;i--;)e=ct[i],t[e]=this[e];return t},toString:function(){_(this);var e=this.startContainer;if(e===this.endContainer&&H(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new p(this,!0);return l(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){_(this);var t=e.parentNode,n=U(e);if(!t)throw new F("NOT_FOUND_ERR");var i=this.comparePoint(t,n),o=this.comparePoint(t,n+1);return 0>i?o>0?mt:ft:o>0?gt:vt},comparePoint:function(e,t){return _(this),T(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),G(e,t,this.startContainer,this.startOffset)<0?-1:G(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:lt,toHtml:function(){_(this);var e=this.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(_(this),T(e,"NOT_FOUND_ERR"),W(e)!==n(this))return!1;var i=e.parentNode,o=U(e);T(i,"NOT_FOUND_ERR");var a=G(i,o,this.endContainer,this.endOffset),r=G(i,o+1,this.startContainer,this.startOffset);return t?0>=a&&r>=0:0>a&&r>0},isPointInRange:function(e,t){return _(this),T(e,"HIERARCHY_REQUEST_ERR"),w(e,this.startContainer),G(e,t,this.startContainer,this.startOffset)>=0&&G(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return r(this,e,!1)},intersectsOrTouchesRange:function(e){return r(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=G(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=G(this.endContainer,this.endOffset,e.endContainer,e.endOffset),i=this.cloneRange();return-1==t&&i.setStart(e.startContainer,e.startOffset),1==n&&i.setEnd(e.endContainer,e.endOffset),i}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==G(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==G(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new f("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==vt},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,K(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var i=n.pop();t.setEnd(i,i.length);var o=this.containsRange(t);return t.detach(),o}return this.containsNodeContents(e)},getNodes:function(e,t){return _(this),d(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){v(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){v(this),this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var i=n(this),o=e.createRange(i);t=t||B.getBody(i),o.selectNodeContents(t);var a=this.intersection(o),r=0,s=0;return a&&(o.setEnd(a.startContainer,a.startOffset),r=o.toString().length,s=r+a.toString().length,o.detach()),{start:r,end:s,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var i,o,a,r,s=[t],l=!1,c=!1;!c&&(i=s.pop());)if(3==i.nodeType)o=n+i.length,!l&&e.start>=n&&e.start<=o&&(this.setStart(i,e.start-n),l=!0),l&&e.end>=n&&e.end<=o&&(this.setEnd(i,e.end-n),c=!0),n=o;else for(r=i.childNodes,a=r.length;a--;)s.push(r[a])},getName:function(){return"DomRange"},equals:function(e){return M.rangesEqual(this,e)},isValid:function(){return x(this)},inspect:function(){return h(this)}}),A(M,I,P),L.extend(M,{rangeProperties:ct,RangeIterator:p,copyComparisonConstants:N,createPrototypeRange:A,inspect:h,getRangeDocument:n,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=M,e.RangeException=f}),rangy.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,i,o=e.dom,a=e.util,r=o.DomPosition,s=e.DomRange,l=o.getBody,c=o.getContentDocument,u=o.isCharacterDataNode;if(e.features.implementsDomRange&&function(){function i(e){for(var t,n=p.length;n--;)t=p[n],e[t]=e.nativeRange[t];
e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function r(e,t,n,i,o){var a=e.startContainer!==t||e.startOffset!=n,r=e.endContainer!==i||e.endOffset!=o,s=!e.equals(e.nativeRange);(a||r||s)&&(e.setEnd(i,o),e.setStart(t,n))}function u(e){e.nativeRange.detach(),e.detached=!0;for(var t=p.length;t--;)e[p[t]]=null}var d,h,p=s.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,i(this)},s.createPrototypeRange(n,r,u),d=n.prototype,d.selectNode=function(e){this.nativeRange.selectNode(e),i(this)},d.cloneContents=function(){return this.nativeRange.cloneContents()},d.surroundContents=function(e){this.nativeRange.surroundContents(e),i(this)},d.collapse=function(e){this.nativeRange.collapse(e),i(this)},d.cloneRange=function(){return new n(this.nativeRange.cloneRange())},d.refresh=function(){i(this)},d.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");l(document).appendChild(f);var g=document.createRange();g.setStart(f,0),g.setEnd(f,0);try{g.setStart(f,1),d.setStart=function(e,t){this.nativeRange.setStart(e,t),i(this)},d.setEnd=function(e,t){this.nativeRange.setEnd(e,t),i(this)},h=function(e){return function(t){this.nativeRange[e](t),i(this)}}}catch(m){d.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}i(this)},d.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}i(this)},h=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(o){this.nativeRange[t](n),this.nativeRange[e](n)}i(this)}}}d.setStartBefore=h("setStartBefore","setEndBefore"),d.setStartAfter=h("setStartAfter","setEndAfter"),d.setEndBefore=h("setEndBefore","setStartBefore"),d.setEndAfter=h("setEndAfter","setStartAfter"),d.selectNodeContents=function(e){this.setStartAndEnd(e,0,o.getNodeLength(e))},g.selectNodeContents(f),g.setEnd(f,3);var v=document.createRange();v.selectNodeContents(f),v.setEnd(f,4),v.setStart(f,2),d.compareBoundaryPoints=-1==g.compareBoundaryPoints(g.START_TO_END,v)&&1==g.compareBoundaryPoints(g.END_TO_START,v)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var y=document.createElement("div");y.innerHTML="123";var b=y.firstChild,w=l(document);w.appendChild(y),g.setStart(b,1),g.setEnd(b,2),g.deleteContents(),"13"==b.data&&(d.deleteContents=function(){this.nativeRange.deleteContents(),i(this)},d.extractContents=function(){var e=this.nativeRange.extractContents();return i(this),e}),w.removeChild(y),w=null,a.isHostMethod(g,"createContextualFragment")&&(d.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),l(document).removeChild(f),g.detach(),v.detach(),d.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var d=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var i=n.parentElement();n=e.duplicate(),n.collapse(!1);var a=n.parentElement(),r=i==a?i:o.getCommonAncestor(i,a);return r==t?r:o.getCommonAncestor(t,r)},h=function(e){return 0==e.compareEndPoints("StartToEnd",e)},p=function(e,t,n,i,a){var s=e.duplicate();s.collapse(n);var l=s.parentElement();if(o.isOrIsAncestorOf(t,l)||(l=t),!l.canHaveHTML){var c=new r(l.parentNode,o.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var d=o.getDocument(l).createElement("span");d.parentNode&&d.parentNode.removeChild(d);for(var h,p,f,g,m,v=n?"StartToStart":"StartToEnd",y=a&&a.containerElement==l?a.nodeIndex:0,b=l.childNodes.length,w=b,C=w;;){if(C==b?l.appendChild(d):l.insertBefore(d,l.childNodes[C]),s.moveToElementText(d),h=s.compareEndPoints(v,e),0==h||y==w)break;if(-1==h){if(w==y+1)break;y=C}else w=w==y+1?y:C;C=Math.floor((y+w)/2),l.removeChild(d)}if(m=d.nextSibling,-1==h&&m&&u(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",e);var T;if(/[\r\n]/.test(m.data)){var E=s.duplicate(),S=E.text.replace(/\r\n/g,"\r").length;for(T=E.moveStart("character",S);-1==(h=E.compareEndPoints("StartToEnd",E));)T++,E.moveStart("character",1)}else T=s.text.length;g=new r(m,T)}else p=(i||!n)&&d.previousSibling,f=(i||n)&&d.nextSibling,g=f&&u(f)?new r(f,0):p&&u(p)?new r(p,p.data.length):new r(l,o.getNodeIndex(d));return d.parentNode.removeChild(d),{boundaryPosition:g,nodeInfo:{nodeIndex:C,containerElement:l}}},f=function(e,t){var n,i,a,r,s=e.offset,c=o.getDocument(e.node),d=l(c).createTextRange(),h=u(e.node);return h?(n=e.node,i=n.parentNode):(r=e.node.childNodes,n=s<r.length?r[s]:null,i=e.node),a=c.createElement("span"),a.innerHTML="&#feff;",n?i.insertBefore(a,n):i.appendChild(a),d.moveToElementText(a),d.collapse(!t),i.removeChild(a),h&&d[t?"moveStart":"moveEnd"]("character",s),d};if(i=function(e){this.textRange=e,this.refresh()},i.prototype=new s(document),i.prototype.refresh=function(){var e,t,n,i=d(this.textRange);h(this.textRange)?t=e=p(this.textRange,i,!0,!0).boundaryPosition:(n=p(this.textRange,i,!0,!1),e=n.boundaryPosition,t=p(this.textRange,i,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},i.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(i),i.rangeToTextRange=function(e){if(e.collapsed)return f(new r(e.startContainer,e.startOffset),!0);var t=f(new r(e.startContainer,e.startOffset),!0),n=f(new r(e.endContainer,e.endOffset),!1),i=l(s.getRangeDocument(e)).createTextRange();return i.setEndPoint("StartToStart",t),i.setEndPoint("EndToEnd",n),i},e.WrappedTextRange=i,!e.features.implementsDomRange||e.config.preferTextRange){var g=function(){return this}();"undefined"==typeof g.Range&&(g.Range=i),e.createNativeRange=function(e){return e=c(e,t,"createNativeRange"),l(e).createTextRange()},e.WrappedRange=i}}e.createRange=function(n){return n=c(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=c(e,t,"createRangyRange"),new s(e)},e.createIframeRange=function(n){return t.deprecationNotice("createIframeRange()","createRange(iframeEl)"),e.createRange(n)},e.createIframeRangyRange=function(n){return t.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),e.createRangyRange(n)},e.addCreateMissingNativeApiListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),rangy.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function i(e,n){if(e){if(k.isWindow(e))return e;if(e instanceof v)return e.win;var i=k.getContentDocument(e,t,n);return k.getWindow(i)}return window}function o(e){return i(e,"getWinSelection").getSelection()}function a(e){return i(e,"getDocSelection").document.selection}function r(e){var t=!1;return e.anchorNode&&(t=1==k.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function s(e,t,n){var i=n?"end":"start",o=n?"start":"end";e.anchorNode=t[i+"Container"],e.anchorOffset=t[i+"Offset"],e.focusNode=t[o+"Container"],e.focusOffset=t[o+"Offset"]}function l(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function c(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function u(t){var n;return t instanceof A?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof O?n=t.nativeRange:M.implementsDomRange&&t instanceof k.getWindow(t.startContainer).Range&&(n=t),n}function d(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!k.isAncestorOf(e[0],e[t]))return!1;return!0}function h(e){var n=e.getNodes();if(!d(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function p(e){return!!e&&"undefined"!=typeof e.text}function f(e,t){var n=new O(t);e._ranges=[n],s(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function g(t){if(t._ranges.length=0,"None"==t.docSelection.type)c(t);else{var n=t.docSelection.createRange();if(p(n))f(t,n);else{t.rangeCount=n.length;for(var i,o=L(n.item(0)),a=0;a<t.rangeCount;++a)i=e.createRange(o),i.selectNode(n.item(a)),t._ranges.push(i);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,s(t,t._ranges[t.rangeCount-1],!1)}}}function m(e,n){for(var i=e.docSelection.createRange(),o=h(n),a=L(i.item(0)),r=z(a).createControlRange(),s=0,l=i.length;l>s;++s)r.add(i.item(s));try{r.add(o)}catch(c){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}r.select(),g(e)}function v(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function y(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function b(e,t){for(var n,i,o=tt.length;o--;)if(n=tt[o],i=n.selection,"deleteAll"==t)y(i);else if(n.win==e)return"delete"==t?(tt.splice(o,1),!0):i;return"deleteAll"==t&&(tt.length=0),null}function w(e,n){for(var i,o=L(n[0].startContainer),a=z(o).createControlRange(),r=0,s=n.length;s>r;++r){i=h(n[r]);try{a.add(i)}catch(l){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}a.select(),g(e)}function C(e,t){if(e.win.document!=L(t))throw new I("WRONG_DOCUMENT_ERR")}function T(t){return function(n,i){var o;this.rangeCount?(o=this.getRangeAt(0),o["set"+(t?"Start":"End")](n,i)):(o=e.createRange(this.win.document),o.setStartAndEnd(n,i)),this.setSingleRange(o,this.isBackward())}}function E(e){var t=[],n=new P(e.anchorNode,e.anchorOffset),i=new P(e.focusNode,e.focusOffset),o="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var a=0,r=e.rangeCount;r>a;++a)t[a]=A.inspect(e.getRangeAt(a));return"["+o+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+i.inspect()+"]"}e.config.checkSelectionRanges=!0;var S,x,_="boolean",R="number",k=e.dom,N=e.util,D=N.isHostMethod,A=e.DomRange,O=e.WrappedRange,I=e.DOMException,P=k.DomPosition,M=e.features,B="Control",L=k.getDocument,z=k.getBody,F=A.rangesEqual,H=D(window,"getSelection"),U=N.isHostObject(document,"selection");M.implementsWinGetSelection=H,M.implementsDocSelection=U;var j=U&&(!H||e.config.preferTextRange);j?(S=a,e.isSelectionValid=function(e){var t=i(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||L(n.createRange().parentElement())==t}):H?(S=o,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=S;var W=S(),G=e.createNativeRange(document),q=z(document),V=N.areHostProperties(W,["anchorNode","focusNode","anchorOffset","focusOffset"]);M.selectionHasAnchorAndFocus=V;var K=D(W,"extend");M.selectionHasExtend=K;var $=typeof W.rangeCount==R;M.selectionHasRangeCount=$;var X=!1,Z=!0,Q=K?function(t,n){var i=A.getRangeDocument(n),o=e.createRange(i);o.collapseToPoint(n.endContainer,n.endOffset),t.addRange(u(o)),t.extend(n.startContainer,n.startOffset)}:null;N.areHostMethods(W,["addRange","getRangeAt","removeAllRanges"])&&typeof W.rangeCount==R&&M.implementsDomRange&&function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,i=n>1,o=[],a=r(t),s=0;n>s;++s)o[s]=t.getRangeAt(s);var l=z(document),c=l.appendChild(document.createElement("div"));c.contentEditable="false";var u=c.appendChild(document.createTextNode("")),d=document.createRange();if(d.setStart(u,1),d.collapse(!0),t.addRange(d),Z=1==t.rangeCount,t.removeAllRanges(),!i){var h=d.cloneRange();d.setStart(u,0),h.setEnd(u,3),h.setStart(u,2),t.addRange(d),t.addRange(h),X=2==t.rangeCount,h.detach()}for(l.removeChild(c),t.removeAllRanges(),d.detach(),s=0;n>s;++s)0==s&&a?Q?Q(t,o[s]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because browser does not support Selection.extend"),t.addRange(o[s])):t.addRange(o[s])}}(),M.selectionSupportsMultipleRanges=X,M.collapsedNonEditableSelectionsSupported=Z;var Y,J=!1;q&&D(q,"createControlRange")&&(Y=q.createControlRange(),N.areHostProperties(Y,["item","add"])&&(J=!0)),M.implementsControlRange=J,x=V?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var et;D(W,"getRangeAt")?et=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:V&&(et=function(t){var n=L(t.anchorNode),i=e.createRange(n);return i.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),i.collapsed!==this.isCollapsed&&i.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),i}),v.prototype=e.selectionPrototype;var tt=[],nt=function(e){if(e&&e instanceof v)return e.refresh(),e;e=i(e,"getNativeSelection");var t=b(e),n=S(e),o=U?a(e):null;return t?(t.nativeSelection=n,t.docSelection=o,t.refresh()):(t=new v(n,o,e),tt.push({win:e,selection:t})),t};e.getSelection=nt,e.getIframeSelection=function(n){return t.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),e.getSelection(k.getIframeWindow(n))};var it=v.prototype;if(!j&&V&&N.areHostMethods(W,["removeAllRanges","addRange"])){it.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),c(this)};var ot=function(e,t){Q(e.nativeSelection,t),e.refresh()};it.addRange=$?function(t,i){if(J&&U&&this.docSelection.type==B)m(this,t);else if(n(i)&&K)ot(this,t);else{var o;if(X?o=this.rangeCount:(this.removeAllRanges(),o=0),this.nativeSelection.addRange(u(t).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var a=et(this.nativeSelection,this.rangeCount-1);a&&!F(a,t)&&(t=new O(a))}this._ranges[this.rangeCount-1]=t,s(this,t,st(this.nativeSelection)),this.isCollapsed=x(this)}else this.refresh()}}:function(e,t){n(t)&&K?ot(this,e):(this.nativeSelection.addRange(u(e)),this.refresh())},it.setRanges=function(e){if(J&&e.length>1)w(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(D(W,"empty")&&D(G,"select")&&J&&j))return t.fail("No means of selecting a Range or TextRange was found"),!1;it.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=L(this.anchorNode);else if(this.docSelection.type==B){var t=this.docSelection.createRange();t.length&&(e=L(t.item(0)))}if(e){var n=z(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(i){}c(this)},it.addRange=function(t){this.docSelection.type==B?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,t,!1))},it.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?w(this,e):t&&this.addRange(e[0])}}it.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new I("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var at;if(j)at=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=z(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==B?g(t):p(n)?f(t,n):c(t)};else if(D(W,"getRangeAt")&&typeof W.rangeCount==R)at=function(t){if(J&&U&&t.docSelection.type==B)g(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,i=t.rangeCount;i>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));s(t,t._ranges[t.rangeCount-1],st(t.nativeSelection)),t.isCollapsed=x(t)}else c(t)};else{if(!V||typeof W.isCollapsed!=_||typeof G.collapsed!=_||!M.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;at=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=et(n,0),e._ranges=[t],e.rangeCount=1,l(e),e.isCollapsed=x(e)):c(e)}}it.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,i=this.anchorOffset;if(at(this),e){var o=t.length;if(o!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=i)return!0;for(;o--;)if(!F(t[o],this._ranges[o]))return!0;return!1}};var rt=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var i=0,o=n.length;o>i;++i)F(t,n[i])||e.addRange(n[i]);e.rangeCount||c(e)};it.removeRange=J?function(e){if(this.docSelection.type==B){for(var t,n=this.docSelection.createRange(),i=h(e),o=L(n.item(0)),a=z(o).createControlRange(),r=!1,s=0,l=n.length;l>s;++s)t=n.item(s),t!==i||r?a.add(n.item(s)):r=!0;a.select(),g(this)}else rt(this,e)}:function(e){rt(this,e)};var st;!j&&V&&M.implementsDomRange?(st=r,it.isBackward=function(){return st(this)}):st=it.isBackward=function(){return!1},it.isBackwards=it.isBackward,it.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},it.collapse=function(t,n){C(this,t);var i=e.createRange(t);i.collapseToPoint(t,n),this.setSingleRange(i),this.isCollapsed=!0},it.collapseToStart=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},it.collapseToEnd=function(){if(!this.rangeCount)throw new I("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},it.selectAllChildren=function(t){C(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},it.deleteFromDocument=function(){if(J&&U&&this.docSelection.type==B){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var i=0,o=n.length;o>i;++i)n[i].deleteContents();this.addRange(n[o-1])}}},it.eachRange=function(e,t){for(var n=0,i=this._ranges.length;i>n;++n)if(e(this.getRangeAt(n)))return t},it.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},it.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},it.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(i){n.push(i[e].apply(i,t))}),n},it.setStart=T(!0),it.setEnd=T(!1),e.rangePrototype.select=function(e){nt(this.getDocument()).setSingleRange(this,e)},it.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},it.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)},it.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},it.moveToBookmark=function(t){for(var n,i,o=[],a=0;n=t.rangeBookmarks[a++];)i=e.createRange(this.win),i.moveToBookmark(n),o.push(i);t.backward?this.setSingleRange(o[0],"backward"):this.setRanges(o)},it.toHtml=function(){return this.callMethodOnEachRange("toHtml").join("")},it.getName=function(){return"WrappedSelection"},it.inspect=function(){return E(this)},it.detach=function(){b(this.win,"delete"),y(this)},v.detachAll=function(){b(null,"deleteAll")},v.inspect=E,v.isDirectionBackward=n,e.Selection=v,e.selectionPrototype=it,e.addCreateMissingNativeApiListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return nt(e)}),e=null})}),rangy.createModule("Applier",["WrappedSelection"],function(e,t){function n(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function i(e,t){return e.className&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e.className)}function o(e,t){e.className?i(e,t)||(e.className+=" "+t):e.className=t}function a(e){return e.split(/\s+/).sort().join(" ")}function r(e){return a(e.className)}function s(e,t){return r(e)==r(t)}function l(e,t,n,i,o){var a=e.node,r=e.offset,s=a,l=r;a==i&&r>o&&l++,a!=t||r!=n&&r!=n+1||(s=i,l+=o-n),a==t&&r>n+1&&l--,e.node=s,e.offset=l}function c(e,t,n,i){-1==n&&(n=t.childNodes.length);for(var o,a=e.parentNode,r=O.getNodeIndex(e),s=0;o=i[s++];)l(o,a,r,t,n);t.childNodes.length==n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function u(e,t,n,i,o){for(var a,r=[];a=e.firstChild;)c(a,t,n++,o),r.push(a);return i&&e.parentNode.removeChild(e),r}function d(e,t){return u(e,e.parentNode,O.getNodeIndex(e),!0,t)}function h(e,t){var n=e.cloneRange();n.selectNodeContents(t);var i=n.intersection(e),o=i?i.toString():"";return n.detach(),""!=o}function p(e){var t=e.cloneRange();return/<img/.test(v(t.cloneContents()))}function f(e){return e.getNodes([],function(t){return 3===t.nodeType&&h(e,t)?t:1===t.nodeType&&"IMG"===t.tagName?t:void 0})}function g(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,i,o,a=0,r=e.attributes.length;r>a;++a)if(n=e.attributes[a],o=n.name,"class"!=o){if(i=t.attributes.getNamedItem(o),n.specified!=i.specified)return!1;if(n.specified&&n.nodeValue!==i.nodeValue)return!1}return!0}function m(e){return e.clone().wrap("<div/>").parent().html()}function v(e,t){for(var n="",i=0,o=e.childNodes.length;o>i;i++){var a=e.childNodes.item(i),r=a.nodeType===Node.TEXT_NODE?a.nodeValue:m(jQuery(a));r&&(n+=r)}return t&&(n=jQuery("<"+t+">"+n+"</"+t+">"),n.find("p").wrapInner("<"+t+"/>"),n.find("p > *").unwrap(),n=jQuery("<div/>").html(n).html()),n}function y(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||M(e)&&!M(e.parentNode))}function b(e){return(M(e)||1!=e.nodeType&&M(e.parentNode))&&!y(e)}function w(e){return e&&1==e.nodeType&&!B.test(A(e,"display"))}function C(e){if(0==e.data.length)return!0;if(L.test(e.data))return!1;var t=A(e.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return w(e.previousSibling)||w(e.nextSibling)}function T(e){var t,n,i=[];for(t=0;n=e[t++];)i.push(new I(n.startContainer,n.startOffset),new I(n.endContainer,n.endOffset));return i}function E(e,t){for(var n,i,o,a=0,r=e.length;r>a;++a)n=e[a],i=t[2*a],o=t[2*a+1],n.setStartAndEnd(i.node,i.offset,o.node,o.offset)}function S(e,t){return O.isCharacterDataNode(e)?0==t?!!e.previousSibling:t==e.length?!!e.nextSibling:!0:t>0&&t<e.childNodes.length}function x(e,n,i,o){var a,r,s=0==i;if(O.isAncestorOf(n,e))return e;if(O.isCharacterDataNode(n)){var l=O.getNodeIndex(n);if(0==i)i=l;else{if(i!=n.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+n.data);i=l+1}n=n.parentNode}if(S(n,i)){a=n.cloneNode(!1),r=n.parentNode,a.id&&a.removeAttribute("id");for(var u,d=0;u=n.childNodes[i];)c(u,a,d++,o);return c(a,r,O.getNodeIndex(n)+1,o),n==e?a:x(e,r,O.getNodeIndex(a),o)}if(e!=n){a=n.parentNode;var h=O.getNodeIndex(n);return s||h++,x(e,a,h,o)}return e}function _(e,t){return e.tagName==t.tagName&&s(e,t)&&g(e,t)&&"inline"==A(e,"display")&&"inline"==A(t,"display")}function R(e){var t=e?"nextSibling":"previousSibling";return function(n,i){var o=n.parentNode,a=n[t];if(a){if(a&&3==a.nodeType)return a}else if(i&&(a=o[t],a&&1==a.nodeType&&_(o,a)))return a[e?"firstChild":"lastChild"];return null}}function k(e){this.isElementMerge=1==e.nodeType,this.firstTextNode=this.isElementMerge?e.lastChild:e,this.textNodes=[this.firstTextNode]}function N(e){this.tag=null,this.tags=[],this.classes=[],this.attributes=[],this.ignoreWhiteSpace=!0,this.applyToEditableOnly=!1,this.useExistingElements=!0,this.ignoreClasses=!1,this.ignoreAttributes=!1;for(var t in e)this[t]=e[t];for(var n=0,i=this.tags.length;i>n;n++)this.tags[n]=this.tags[n].toUpperCase();this.tag&&(this.tag=this.tag.toUpperCase(),this.tags.push(this.tag))}function D(e){return new N(e)}var A,O=e.dom,I=O.DomPosition,P=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){t.className&&(t.className=t.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e))}}();"undefined"!=typeof window.getComputedStyle?A=function(e,t){return O.getWindow(e).getComputedStyle(e,null)[t]}:"undefined"!=typeof document.documentElement.currentStyle?A=function(e,t){return e.currentStyle[t]}:t.fail("No means of obtaining computed style properties found");var M;!function(){var e=document.createElement("div");M="boolean"==typeof e.isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return e&&1==e.nodeType&&"false"!=e.contentEditable?"true"==e.contentEditable||M(e.parentNode):!1}}();var B=/^inline(-block|-table)?$/i,L=/[^\r\n\t\f \u200B]/,z=R(!1),F=R(!0);k.prototype={doMerge:function(e){for(var t,n,i,o,a,r=[],s=0,l=0,c=this.textNodes.length;c>l;++l){if(t=this.textNodes[l],n=t.parentNode,l>0&&(n.removeChild(t),n.hasChildNodes()||n.parentNode.removeChild(n),e))for(o=0;a=e[o++];)a.node==t&&(a.node=this.firstTextNode,a.offset+=s);r[l]=t.data,s+=t.data.length}return this.firstTextNode.data=i=r.join(""),i},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;n>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}};var H={};N.prototype={copyPropertiesToElement:function(e,t,n){var i,r,s,l,c,u,d={};for(var h in e)if(e.hasOwnProperty(h))if(l=e[h],c=t[h],"className"==h)o(t,l),o(t,this.cssClass),t[h]=a(t[h]),n&&(d[h]=t[h]);else if("style"==h){r=c,n&&(d[h]=s={});for(i in e[h])r[i]=l[i],n&&(s[i]=r[i]);this.attrExceptions.push(h)}else t[h]=l,n&&(d[h]=t[h],u=H.hasOwnProperty(h)?H[h]:h,this.attrExceptions.push(u));return n?d:""},isValid:function(e){return this.isValidTag(e)&&this.hasClasses(e)&&this.hasAttributes(e)},isValidTag:function(e){if(1!==e.nodeType)return!1;if(0===this.tags.length)return!0;for(var t=0,n=this.tags.length;n>t;t++)if(e.tagName===this.tags[t])return!0;return!1},hasClasses:function(e){if(this.ignoreClasses)return!0;for(var t=0,n=this.classes.length;n>t;t++)if(!i(e,this.classes[t]))return!1;return!0},hasAttributes:function(e){if(this.ignoreAttributes)return!0;for(var t in this.attributes)if(!e.hasAttribute(t))return!1;return!0},getSelfOrAncestor:function(e){for(;e;){if(this.isValid(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||b(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&C(e)},postApply:function(e,t,n,i){for(var o,a,r,s=e[0],l=e[e.length-1],c=[],u=s,d=l,h=0,p=l.length,f=0,g=e.length;g>f;++f)a=e[f],r=z(a,!i),r?(o||(o=new k(r),c.push(o)),o.textNodes.push(a),a===s&&(u=o.firstTextNode,h=u.length),a===l&&(d=o.firstTextNode,p=o.getLength())):o=null;var m=F(l,!i);if(m&&(o||(o=new k(l),c.push(o)),o.textNodes.push(m)),c.length){for(f=0,g=c.length;g>f;++f)c[f].doMerge(n);t.setStartAndEnd(u,h,d,p)}},createContainer:function(e){var t=e.createElement(this.tag);return this.addClasses(t),this.addAttributes(t),t},addClasses:function(e){for(var t=0,n=this.classes.length;n>t;t++)o(e,this.classes[t])},addAttributes:function(e){for(var t in this.attributes)e.setAttribute(t,this.attributes[t])},removeClasses:function(e){for(var t=0,n=this.classes.length;n>t;t++)P(e,this.classes[t])},removeAttributes:function(e){for(var t in this.attributes)e.removeAttribute(t)},applyToTextNode:function(e){var t=e.parentNode;if(1==t.childNodes.length&&O.arrayContains(this.tags,t.tagName)&&this.useExistingElements)this.addClasses(t),this.addAttributes(t);else{var n=this.createContainer(O.getDocument(e));e.parentNode.insertBefore(n,e),n.appendChild(e)}},isRemovable:function(e){return this.tags.length>0&&this.isValidTag(e)&&this.hasClasses(e)&&this.hasAttributes(e)&&this.isModifiable(e)},undoToTextNode:function(e,t,n,i){if(!t.containsNode(n)){var o=t.cloneRange();o.selectNode(n),o.isPointInRange(t.endContainer,t.endOffset)&&(x(n,t.endContainer,t.endOffset,i),t.setEndAfter(n)),o.isPointInRange(t.startContainer,t.startOffset)&&(n=x(n,t.startContainer,t.startOffset,i))}this.isRemovable(n)?d(n,i):(this.removeClasses(n),this.removeAttributes(n))},applyToRange:function(e,t){t=t||[];var n=T(t||[]);e.splitBoundariesPreservingPositions(n);var i=f(e);if(i.length){for(var o,a=0;o=i[a++];)!this.isIgnorableWhiteSpaceNode(o)&&this.isModifiable(o)&&this.applyToTextNode(o,n);e.setStart(i[0],0),o=i[i.length-1],e.setEnd(o,o.length),this.normalize&&this.postApply(i,e,n,!1),E(t,n)}},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){t=t||[];var n=T(t);e.splitBoundariesPreservingPositions(n);var i,o,a=f(e),r=a[a.length-1];if(a.length){for(var s=0,l=a.length;l>s;++s)i=a[s],o=this.getSelfOrAncestor(i),o&&this.isModifiable(i)&&this.undoToTextNode(i,e,o,n),e.setStart(a[0],0),e.setEnd(r,r.length);this.normalize&&this.postApply(a,e,n,!0),E(t,n)}},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),i=e.getSelection(t).getAllRanges();this.undoToRanges(i),n.setRanges(i)},getTextSelectedByRange:function(e,t){var n=t.cloneRange();n.selectNodeContents(e);var i=n.intersection(t),o=i?i.toString():"";return n.detach(),o},isAppliedToRange:function(e){if(e.collapsed)return!!this.getSelfOrAncestor(e.commonAncestorContainer);for(var t,i=e.getNodes([3]),o=0;t=i[o++];)if(!this.isIgnorableWhiteSpaceNode(t)){if(h(e,t)&&this.isModifiable(t)&&!this.getSelfOrAncestor(t))return!1;if(p(e))return!1}var a=v(e.cloneContents());return a.match(/^<(img)/)||""===n(a.replace(/<.*?>/g,""))?!1:!0},isAppliedToRanges:function(e){var t=e.length;if(0===t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleRanges:function(e){this.isAppliedToRanges(e)?this.undoToRanges(e):this.applyToRanges(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},detach:function(){}},N.util={},e.Applier=N,e.createApplier=D}),rangy.createModule("ClassApplier",["WrappedSelection"],function(e,t){function n(e,t){for(var n in e)if(e.hasOwnProperty(n)&&t(n,e[n])===!1)return!1;return!0}function i(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function o(e,t){return e.className&&new RegExp("(?:^|\\s)"+t+"(?:\\s|$)").test(e.className)}function a(e,t){e.className?o(e,t)||(e.className+=" "+t):e.className=t}function r(e){return e.split(/\s+/).sort().join(" ")}function s(e){return r(e.className)}function l(e,t){return s(e)==s(t)}function c(e,t,n,i,o){var a=e.node,r=e.offset,s=a,l=r;a==i&&r>o&&++l,a!=t||r!=n&&r!=n+1||(s=i,l+=o-n),a==t&&r>n+1&&--l,e.node=s,e.offset=l}function u(e,t,n){e.node==t&&e.offset>n&&--e.offset}function d(e,t,n,i){-1==n&&(n=t.childNodes.length);for(var o,a=e.parentNode,r=I.getNodeIndex(e),s=0;o=i[s++];)c(o,a,r,t,n);t.childNodes.length==n?t.appendChild(e):t.insertBefore(e,t.childNodes[n])}function h(e,t){for(var n,i=e.parentNode,o=I.getNodeIndex(e),a=0;n=t[a++];)u(n,i,o);e.parentNode.removeChild(e)}function p(e,t,n,i,o){for(var a,r=[];a=e.firstChild;)d(a,t,n++,o),r.push(a);return i&&e.parentNode.removeChild(e),r}function f(e,t){return p(e,e.parentNode,I.getNodeIndex(e),!0,t)}function g(e,t){var n=e.cloneRange();n.selectNodeContents(t);var i=n.intersection(e),o=i?i.toString():"";return n.detach(),""!=o}function m(e){for(var t,n=e.getNodes([3]),i=0;(t=n[i])&&!g(e,t);)++i;for(var o=n.length-1;(t=n[o])&&!g(e,t);)--o;return n.slice(i,o+1)}function v(e,t){if(e.attributes.length!=t.attributes.length)return!1;for(var n,i,o,a=0,r=e.attributes.length;r>a;++a)if(n=e.attributes[a],o=n.name,"class"!=o){if(i=t.attributes.getNamedItem(o),null===n!=(null===i))return!1;
if(n.specified!=i.specified)return!1;if(n.specified&&n.nodeValue!==i.nodeValue)return!1}return!0}function y(e,t){for(var n,i=0,o=e.attributes.length;o>i;++i)if(n=e.attributes[i].name,(!t||!M(t,n))&&e.attributes[i].specified&&"class"!=n)return!0;return!1}function b(e,t){return n(t,function(t,n){if("object"==typeof n){if(!b(e[t],n))return!1}else if(e[t]!==n)return!1}),!0}function w(e){var t;return e&&1==e.nodeType&&((t=e.parentNode)&&9==t.nodeType&&"on"==t.designMode||F(e)&&!F(e.parentNode))}function C(e){return(F(e)||1!=e.nodeType&&F(e.parentNode))&&!w(e)}function T(e){return e&&1==e.nodeType&&!H.test(z(e,"display"))}function E(e){if(0==e.data.length)return!0;if(U.test(e.data))return!1;var t=z(e.parentNode,"whiteSpace");switch(t){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(e.data))return!1}return T(e.previousSibling)||T(e.nextSibling)}function S(e){var t,n,i=[];for(t=0;n=e[t++];)i.push(new P(n.startContainer,n.startOffset),new P(n.endContainer,n.endOffset));return i}function x(e,t){for(var n,i,o,a=0,r=e.length;r>a;++a)n=e[a],i=t[2*a],o=t[2*a+1],n.setStartAndEnd(i.node,i.offset,o.node,o.offset)}function _(e,t){return I.isCharacterDataNode(e)?0==t?!!e.previousSibling:t==e.length?!!e.nextSibling:!0:t>0&&t<e.childNodes.length}function R(e,n,i,o){var a,r,s=0==i;if(I.isAncestorOf(n,e))return e;if(I.isCharacterDataNode(n)){var l=I.getNodeIndex(n);if(0==i)i=l;else{if(i!=n.length)throw t.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+i+" in "+n.data);i=l+1}n=n.parentNode}if(_(n,i)){a=n.cloneNode(!1),r=n.parentNode,a.id&&a.removeAttribute("id");for(var c,u=0;c=n.childNodes[i];)d(c,a,u++,o);return d(a,r,I.getNodeIndex(n)+1,o),n==e?a:R(e,r,I.getNodeIndex(a),o)}if(e!=n){a=n.parentNode;var h=I.getNodeIndex(n);return s||h++,R(e,a,h,o)}return e}function k(e,t){return e.tagName==t.tagName&&l(e,t)&&v(e,t)&&"inline"==z(e,"display")&&"inline"==z(t,"display")}function N(e){var t=e?"nextSibling":"previousSibling";return function(n,i){var o=n.parentNode,a=n[t];if(a){if(a&&3==a.nodeType)return a}else if(i&&(a=o[t],a&&1==a.nodeType&&k(o,a))){var r=a[e?"firstChild":"lastChild"];if(r&&3==r.nodeType)return r}return null}}function D(e){this.isElementMerge=1==e.nodeType,this.textNodes=[];var t=this.isElementMerge?e.lastChild:e;t&&(this.textNodes[0]=t)}function A(e,t,o){var a,r,s,l,c=this;c.cssClass=e;var u=null,d={};if("object"==typeof t&&null!==t){for(o=t.tagNames,u=t.elementProperties,d=t.elementAttributes,r=0;l=G[r++];)t.hasOwnProperty(l)&&(c[l]=t[l]);a=t.normalize}else a=t;c.normalize="undefined"==typeof a?!0:a,c.attrExceptions=[];var h=document.createElement(c.elementTagName);c.elementProperties=c.copyPropertiesToElement(u,h,!0),n(d,function(e){c.attrExceptions.push(e)}),c.elementAttributes=d,c.elementSortedClassName=c.elementProperties.hasOwnProperty("className")?c.elementProperties.className:e,c.applyToAnyTagName=!1;var p=typeof o;if("string"==p)"*"==o?c.applyToAnyTagName=!0:c.tagNames=i(o.toLowerCase()).split(/\s*,\s*/);else if("object"==p&&"number"==typeof o.length)for(c.tagNames=[],r=0,s=o.length;s>r;++r)"*"==o[r]?c.applyToAnyTagName=!0:c.tagNames.push(o[r].toLowerCase());else c.tagNames=[c.elementTagName]}function O(e,t,n){return new A(e,t,n)}var I=e.dom,P=I.DomPosition,M=I.arrayContains,B="span",L=function(){function e(e,t,n){return t&&n?" ":""}return function(t,n){t.className&&(t.className=t.className.replace(new RegExp("(^|\\s)"+n+"(\\s|$)"),e))}}(),z=I.getComputedStyleProperty,F=function(){var e=document.createElement("div");return"boolean"==typeof e.isContentEditable?function(e){return e&&1==e.nodeType&&e.isContentEditable}:function(e){return e&&1==e.nodeType&&"false"!=e.contentEditable?"true"==e.contentEditable||F(e.parentNode):!1}}(),H=/^inline(-block|-table)?$/i,U=/[^\r\n\t\f \u200B]/,j=N(!1),W=N(!0);D.prototype={doMerge:function(e){var t=this.textNodes,n=t[0];if(t.length>1){for(var i,o,a,r,s=[],l=0,c=0,u=t.length;u>c;++c){if(i=t[c],o=i.parentNode,c>0&&(o.removeChild(i),o.hasChildNodes()||o.parentNode.removeChild(o),e))for(a=0;r=e[a++];)r.node==i&&(r.node=n,r.offset+=l);s[c]=i.data,l+=i.data.length}n.data=s.join("")}return n.data},getLength:function(){for(var e=this.textNodes.length,t=0;e--;)t+=this.textNodes[e].length;return t},toString:function(){for(var e=[],t=0,n=this.textNodes.length;n>t;++t)e[t]="'"+this.textNodes[t].data+"'";return"[Merge("+e.join(",")+")]"}};var G=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],q={};A.prototype={elementTagName:B,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(e,t,n){var i,o,s,l,c,u,d={};for(var h in e)if(e.hasOwnProperty(h))if(l=e[h],c=t[h],"className"==h)a(t,l),a(t,this.cssClass),t[h]=r(t[h]),n&&(d[h]=t[h]);else if("style"==h){o=c,n&&(d[h]=s={});for(i in e[h])o[i]=l[i],n&&(s[i]=o[i]);this.attrExceptions.push(h)}else t[h]=l,n&&(d[h]=t[h],u=q.hasOwnProperty(h)?q[h]:h,this.attrExceptions.push(u));return n?d:""},copyAttributesToElement:function(e,t){for(var n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n])},hasClass:function(e){return 1==e.nodeType&&M(this.tagNames,e.tagName.toLowerCase())&&o(e,this.cssClass)},getSelfOrAncestorWithClass:function(e){for(;e;){if(this.hasClass(e))return e;e=e.parentNode}return null},isModifiable:function(e){return!this.applyToEditableOnly||C(e)},isIgnorableWhiteSpaceNode:function(e){return this.ignoreWhiteSpace&&e&&3==e.nodeType&&E(e)},postApply:function(e,t,n,i){for(var o,a,r,s=e[0],l=e[e.length-1],c=[],u=s,d=l,h=0,p=l.length,f=0,g=e.length;g>f;++f)a=e[f],r=j(a,!i),r?(o||(o=new D(r),c.push(o)),o.textNodes.push(a),a===s&&(u=o.textNodes[0],h=u.length),a===l&&(d=o.textNodes[0],p=o.getLength())):o=null;var m=W(l,!i);if(m&&(o||(o=new D(l),c.push(o)),o.textNodes.push(m)),c.length){for(f=0,g=c.length;g>f;++f)c[f].doMerge(n);t.setStartAndEnd(u,h,d,p)}},createContainer:function(e){var t=e.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,t,!1),this.copyAttributesToElement(this.elementAttributes,t),a(t,this.cssClass),this.onElementCreate&&this.onElementCreate(t,this),t},applyToTextNode:function(e){var t=e.parentNode;if(1==t.childNodes.length&&this.useExistingElements&&M(this.tagNames,t.tagName.toLowerCase())&&b(t,this.elementProperties))a(t,this.cssClass);else{var n=this.createContainer(I.getDocument(e));e.parentNode.insertBefore(n,e),n.appendChild(e)}},isRemovable:function(e){return e.tagName.toLowerCase()==this.elementTagName&&s(e)==this.elementSortedClassName&&b(e,this.elementProperties)&&!y(e,this.attrExceptions)&&this.isModifiable(e)},isEmptyContainer:function(e){var t=e.childNodes.length;return 1==e.nodeType&&this.isRemovable(e)&&(0==t||1==t&&this.isEmptyContainer(e.firstChild))},removeEmptyContainers:function(e){for(var t,n=this,i=e.getNodes([1],function(e){return n.isEmptyContainer(e)}),o=[e],a=S(o),r=0;t=i[r++];)h(t,a);x(o,a)},undoToTextNode:function(e,t,n,i){if(!t.containsNode(n)){var o=t.cloneRange();o.selectNode(n),o.isPointInRange(t.endContainer,t.endOffset)&&(R(n,t.endContainer,t.endOffset,i),t.setEndAfter(n)),o.isPointInRange(t.startContainer,t.startOffset)&&(n=R(n,t.startContainer,t.startOffset,i))}this.isRemovable(n)?f(n,i):L(n,this.cssClass)},applyToRange:function(e,t){t=t||[];var n=S(t||[]);e.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(e);var i=m(e);if(i.length){for(var o,a=0;o=i[a++];)this.isIgnorableWhiteSpaceNode(o)||this.getSelfOrAncestorWithClass(o)||!this.isModifiable(o)||this.applyToTextNode(o,n);o=i[i.length-1],e.setStartAndEnd(i[0],0,o,o.length),this.normalize&&this.postApply(i,e,n,!1),x(t,n)}},applyToRanges:function(e){for(var t=e.length;t--;)this.applyToRange(e[t],e);return e},applyToSelection:function(t){var n=e.getSelection(t);n.setRanges(this.applyToRanges(n.getAllRanges()))},undoToRange:function(e,t){t=t||[];var n=S(t);e.splitBoundariesPreservingPositions(n),this.removeEmptyElements&&this.removeEmptyContainers(e,n);var i,o,a=m(e),r=a[a.length-1];if(a.length){for(var s=0,l=a.length;l>s;++s)i=a[s],o=this.getSelfOrAncestorWithClass(i),o&&this.isModifiable(i)&&this.undoToTextNode(i,e,o,n),e.setStartAndEnd(a[0],0,r,r.length);this.normalize&&this.postApply(a,e,n,!0),x(t,n)}},undoToRanges:function(e){for(var t=e.length;t--;)this.undoToRange(e[t],e);return e},undoToSelection:function(t){var n=e.getSelection(t),i=e.getSelection(t).getAllRanges();this.undoToRanges(i),n.setRanges(i)},isAppliedToRange:function(e){if(e.collapsed||""==e.toString())return!!this.getSelfOrAncestorWithClass(e.commonAncestorContainer);var t=e.getNodes([3]);if(t.length)for(var n,i=0;n=t[i++];)if(!this.isIgnorableWhiteSpaceNode(n)&&g(e,n)&&this.isModifiable(n)&&!this.getSelfOrAncestorWithClass(n))return!1;return!0},isAppliedToRanges:function(e){var t=e.length;if(0==t)return!1;for(;t--;)if(!this.isAppliedToRange(e[t]))return!1;return!0},isAppliedToSelection:function(t){var n=e.getSelection(t);return this.isAppliedToRanges(n.getAllRanges())},toggleRange:function(e){this.isAppliedToRange(e)?this.undoToRange(e):this.applyToRange(e)},toggleSelection:function(e){this.isAppliedToSelection(e)?this.undoToSelection(e):this.applyToSelection(e)},getElementsWithClassIntersectingRange:function(e){var t=[],n=this;return e.getNodes([3],function(e){var i=n.getSelfOrAncestorWithClass(e);i&&!M(t,i)&&t.push(i)}),t},detach:function(){}},A.util={hasClass:o,addClass:a,removeClass:L,hasSameClasses:l,replaceWithOwnChildren:f,elementsHaveSameNonClassAttributes:v,elementHasNonClassAttributes:y,splitNodeAt:R,isEditableElement:F,isEditingHost:w,isEditable:C},e.CssClassApplier=e.ClassApplier=A,e.createCssClassApplier=e.createClassApplier=O}),rangy.createModule("SaveRestore",["WrappedRange"],function(e,t){function n(e,t){return(t||document).getElementById(e)}function i(e,t){var n,i="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),o=f.getDocument(e.startContainer),a=e.cloneRange();return a.collapse(t),n=o.createElement("span"),n.id=i,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(o.createTextNode(g)),a.insertNode(n),a.detach(),n}function o(e,i,o,a){var r=n(o,e);r?(i[a?"setStartBefore":"setEndBefore"](r),r.parentNode.removeChild(r)):t.warn("Marker element has been removed. Cannot restore selection.")}function a(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function r(t,n){var o,a,r=e.DomRange.getRangeDocument(t),s=t.toString();return t.collapsed?(a=i(t,!1),{document:r,markerId:a.id,collapsed:!0}):(a=i(t,!1),o=i(t,!0),{document:r,startMarkerId:o.id,endMarkerId:a.id,collapsed:!1,backward:n,toString:function(){return"original text: '"+s+"', new text: '"+t.toString()+"'"}})}function s(i,a){var r=i.document;"undefined"==typeof a&&(a=!0);var s=e.createRange(r);if(i.collapsed){var l=n(i.markerId,r);if(l){l.style.display="inline";var c=l.previousSibling;c&&3==c.nodeType?(l.parentNode.removeChild(l),s.collapseToPoint(c,c.length)):(s.collapseBefore(l),l.parentNode.removeChild(l))}else t.warn("Marker element has been removed. Cannot restore selection.")}else o(r,s,i.startMarkerId,!0),o(r,s,i.endMarkerId,!1);return a&&s.normalizeBoundaries(),s}function l(t,i){var o,s,l=[];t=t.slice(0),t.sort(a);for(var c=0,u=t.length;u>c;++c)l[c]=r(t[c],i);for(c=u-1;c>=0;--c)o=t[c],s=e.DomRange.getRangeDocument(o),o.collapsed?o.collapseAfter(n(l[c].markerId,s)):(o.setEndBefore(n(l[c].endMarkerId,s)),o.setStartAfter(n(l[c].startMarkerId,s)));return l}function c(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var i=e.getSelection(n),o=i.getAllRanges(),a=1==o.length&&i.isBackward(),r=l(o,a);return a?i.setSingleRange(o[0],"backward"):i.setRanges(o),{win:n,rangeInfos:r,restored:!1}}function u(e){for(var t=[],n=e.length,i=n-1;i>=0;i--)t[i]=s(e[i],!0);return t}function d(t,n){if(!t.restored){var i=t.rangeInfos,o=e.getSelection(t.win),a=u(i),r=i.length;1==r&&n&&e.features.selectionHasExtend&&i[0].backward?(o.removeAllRanges(),o.addRange(a[0],!0)):o.setRanges(a),t.restored=!0}}function h(e,t){var i=n(t,e);i&&i.parentNode.removeChild(i)}function p(e){for(var t,n=e.rangeInfos,i=0,o=n.length;o>i;++i)t=n[i],t.collapsed?h(e.doc,t.markerId):(h(e.doc,t.startMarkerId),h(e.doc,t.endMarkerId))}var f=e.dom,g="";e.util.extend(e,{saveRange:r,restoreRange:s,saveRanges:l,restoreRanges:u,saveSelection:c,restoreSelection:d,removeMarkerElement:h,removeMarkers:p})}),rangy.createModule("Serializer",["WrappedSelection"],function(e,t){function n(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(e,t){t=t||[];var o=e.nodeType,a=e.childNodes,r=a.length,s=[o,e.nodeName,r].join(":"),l="",c="";switch(o){case 3:l=n(e.nodeValue);break;case 8:l="<!--"+n(e.nodeValue)+"-->";break;default:l="<"+s+">",c="</>"}l&&t.push(l);for(var u=0;r>u;++u)i(a[u],t);return c&&t.push(c),t}function o(e){var t=i(e).join("");return v(t).toString(16)}function a(e,t,n){var i=[],o=e;for(n=n||y.getDocument(e).documentElement;o&&o!=n;)i.push(y.getNodeIndex(o,!0)),o=o.parentNode;return i.join("/")+":"+t}function r(e,n,i){n||(n=(i||document).documentElement);for(var o,a=e.split(":"),r=n,s=a[0]?a[0].split("/"):[],l=s.length;l--;){if(o=parseInt(s[l],10),!(o<r.childNodes.length))throw t.createError("deserializePosition() failed: node "+y.inspectNode(r)+" has no child with index "+o+", "+l);r=r.childNodes[o]}return new y.DomPosition(r,parseInt(a[1],10))}function s(n,i,r){if(r=r||e.DomRange.getRangeDocument(n).documentElement,!y.isOrIsAncestorOf(r,n.commonAncestorContainer))throw t.createError("serializeRange(): range "+n.inspect()+" is not wholly contained within specified root node "+y.inspectNode(r));var s=a(n.startContainer,n.startOffset,r)+","+a(n.endContainer,n.endOffset,r);return i||(s+="{"+o(r)+"}"),s}function l(n,i,a){i?a=a||y.getDocument(i):(a=a||document,i=a.documentElement);var s=b.exec(n),l=s[4],c=o(i);if(l&&l!==o(i))throw t.createError("deserializeRange(): checksums of serialized range root node ("+l+") and target root node ("+c+") do not match");var u=r(s[1],i,a),d=r(s[2],i,a),h=e.createRange(a);return h.setStartAndEnd(u.node,u.offset,d.node,d.offset),h}function c(e,t,n){t||(t=(n||document).documentElement);var i=b.exec(e),a=i[3];return!a||a===o(t)}function u(t,n,i){t=e.getSelection(t);for(var o=t.getAllRanges(),a=[],r=0,l=o.length;l>r;++r)a[r]=s(o[r],n,i);return a.join("|")}function d(t,n,i){n?i=i||y.getWindow(n):(i=i||window,n=i.document.documentElement);for(var o=t.split("|"),a=e.getSelection(i),r=[],s=0,c=o.length;c>s;++s)r[s]=l(o[s],n,i.document);return a.setRanges(r),a}function h(e,t,n){var i;t?i=n?n.document:y.getDocument(t):(n=n||window,t=n.document.documentElement);for(var o=e.split("|"),a=0,r=o.length;r>a;++a)if(!c(o[a],t,i))return!1;return!0}function p(e){for(var t,n,i=e.split(/[;,]/),o=0,a=i.length;a>o;++o)if(t=i[o].split("="),t[0].replace(/^\s+/,"")==w&&(n=t[1]))return decodeURIComponent(n.replace(/\s+$/,""));return null}function f(e){e=e||window;var t=p(e.document.cookie);t&&d(t,e.doc)}function g(t,n){t=t||window,n="object"==typeof n?n:{};var i=n.expires?";expires="+n.expires.toUTCString():"",o=n.path?";path="+n.path:"",a=n.domain?";domain="+n.domain:"",r=n.secure?";secure":"",s=u(e.getSelection(t));t.document.cookie=encodeURIComponent(w)+"="+encodeURIComponent(s)+i+o+a+r}var m="undefined";(typeof encodeURIComponent==m||typeof decodeURIComponent==m)&&t.fail("Global object is missing encodeURIComponent and/or decodeURIComponent method");var v=function(){function e(e){for(var t,n=[],i=0,o=e.length;o>i;++i)t=e.charCodeAt(i),128>t?n.push(t):2048>t?n.push(192|t>>6,128|63&t):n.push(224|t>>12,128|63&t>>6,128|63&t);return n}function t(){for(var e,t,n=[],i=0;256>i;++i){for(t=i,e=8;e--;)1==(1&t)?t=3988292384^t>>>1:t>>>=1;n[i]=t>>>0}return n}function n(){return i||(i=t()),i}var i=null;return function(t){for(var i,o=e(t),a=-1,r=n(),s=0,l=o.length;l>s;++s)i=255&(a^o[s]),a=a>>>8^r[i];return(-1^a)>>>0}}(),y=e.dom,b=/^([^,]+),([^,\{]+)(\{([^}]+)\})?$/,w="rangySerializedSelection";e.serializePosition=a,e.deserializePosition=r,e.serializeRange=s,e.deserializeRange=l,e.canDeserializeRange=c,e.serializeSelection=u,e.deserializeSelection=d,e.canDeserializeSelection=h,e.restoreSelectionFromCookie=f,e.saveSelectionCookie=g,e.getElementChecksum=o,e.nodeToInfoString=i}),rangy.createModule("TextRange",["WrappedSelection"],function(e,t){function n(e,t){function n(t,n,i){for(var o=e.slice(t,n),a={isWord:i,chars:o,toString:function(){return o.join("")}},r=0,l=o.length;l>r;++r)o[r].token=a;s.push(a)}for(var i,o,a,r=e.join(""),s=[],l=0;i=t.wordRegex.exec(r);){if(o=i.index,a=o+i[0].length,o>l&&n(l,o,!1),t.includeTrailingSpace)for(;X.test(e[a]);)++a;n(o,a,!0),l=a}return l<e.length&&n(l,e.length,!1),s}function i(e,t){if(e){var n={};return G(n,t),G(n,e),n}return t}function o(e){var t,n;return e?(t=e.language||Z,n={},G(n,at[t]||at[Z]),G(n,e),n):at[Z]}function a(e){return i(e,it)}function r(e){return i(e,ot)}function s(e,t){var n=ut(e,"display",t),i=e.tagName.toLowerCase();return"block"==n&&nt&&dt.hasOwnProperty(i)?dt[i]:n}function l(e){for(var t=p(e),n=0,i=t.length;i>n;++n)if(1==t[n].nodeType&&"none"==s(t[n]))return!0;return!1}function c(e){var t;return 3==e.nodeType&&(t=e.parentNode)&&"hidden"==ut(t,"visibility")}function u(e){return e&&(1==e.nodeType&&!/^(inline(-block|-table)?|none)$/.test(s(e))||9==e.nodeType||11==e.nodeType)}function d(e){return j.isCharacterDataNode(e)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(e.nodeName)}function h(e){for(var t=[];e.parentNode;)t.unshift(e.parentNode),e=e.parentNode;return t}function p(e){return h(e).concat([e])}function f(e){for(;e&&!e.nextSibling;)e=e.parentNode;return e?e.nextSibling:null}function g(e,t){return!t&&e.hasChildNodes()?e.firstChild:f(e)}function m(e){var t=e.previousSibling;if(t){for(e=t;e.hasChildNodes();)e=e.lastChild;return e}var n=e.parentNode;return n&&1==n.nodeType?n:null}function v(e){if(!e||3!=e.nodeType)return!1;var t=e.data;if(""===t)return!0;var n=e.parentNode;if(!n||1!=n.nodeType)return!1;var i=ut(e.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(t)&&/^(normal|nowrap)$/.test(i)||/^[\t\r ]+$/.test(t)&&"pre-line"==i}function y(e){if(""===e.data)return!0;if(!v(e))return!1;var t=e.parentNode;return t?l(e)?!0:!1:!0}function b(e){var t=e.nodeType;return 7==t||8==t||l(e)||/^(script|style)$/i.test(e.nodeName)||c(e)||y(e)}function w(e,t){var n=e.nodeType;return 7==n||8==n||1==n&&"none"==s(e,t)}function C(){this.store={}}function T(e,t,n){return function(i){var o=this.cache;if(o.hasOwnProperty(e))return ht++,o[e];pt++;var a=t.call(this,n?this[n]:this,i);return o[e]=a,a}}function E(e,t){this.node=e,this.session=t,this.cache=new C,this.positions=new C}function S(e,t){this.offset=t,this.nodeWrapper=e,this.node=e.node,this.session=e.session,this.cache=new C}function x(){return"[Position("+j.inspectNode(this.node)+":"+this.offset+")]"}function _(){return k(),xt=new _t}function R(){return xt||_()}function k(){xt&&xt.detach(),xt=null}function N(e,n,i,o){function a(){var e=null;return n?(e=s,l||(s=s.previousVisible(),l=!s||i&&s.equals(i))):l||(e=s=s.nextVisible(),l=!s||i&&s.equals(i)),l&&(s=null),e}i&&(n?b(i.node)&&(i=e.previousVisible()):b(i.node)&&(i=i.nextVisible()));var r,s=e,l=!1,c=!1;return{next:function(){if(c)return c=!1,r;for(var e,t;e=a();)if(t=e.getCharacter(o))return r=e,e;return null},rewind:function(){if(!r)throw t.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");c=!0},dispose:function(){e=i=null}}}function D(e,t,n){function i(e){for(var t,n,i=[],r=e?o:a,s=!1,l=!1;t=r.next();){if(n=t.character,$.test(n))l&&(l=!1,s=!0);else{if(s){r.rewind();break}l=!0}i.push(t)}return i}var o=N(e,!1,null,t),a=N(e,!0,null,t),r=n.tokenizer,s=i(!0),l=i(!1).reverse(),c=r(l.concat(s),n),u=s.length?c.slice(Rt(c,s[0].token)):[],d=l.length?c.slice(0,Rt(c,l.pop().token)+1):[];return{nextEndToken:function(){for(var e,t;1==u.length&&!(e=u[0]).isWord&&(t=i(!0)).length>0;)u=r(e.chars.concat(t),n);return u.shift()},previousStartToken:function(){for(var e,t;1==d.length&&!(e=d[0]).isWord&&(t=i(!1)).length>0;)d=r(t.reverse().concat(e.chars),n);return d.pop()},dispose:function(){o.dispose(),a.dispose(),u=d=null}}}function A(e,t,n,i,o){var a,r,s,l,c=0,u=e,d=Math.abs(n);if(0!==n){var h=0>n;switch(t){case H:for(r=N(e,h,null,i);(a=r.next())&&d>c;)++c,u=a;s=a,r.dispose();break;case U:for(var p=D(e,i,o),f=h?p.previousStartToken:p.nextEndToken;(l=f())&&d>c;)l.isWord&&(++c,u=h?l.chars[0]:l.chars[l.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+t+"' not implemented")}h?(u=u.previousVisible(),c=-c):u&&u.isLeadingSpace&&(t==U&&(r=N(e,!1,null,i),s=r.next(),r.dispose()),s&&(u=s.previousVisible()))}return{position:u,unitsMoved:c}}function O(e,t,n,i){var o=e.getRangeBoundaryPosition(t,!0),a=e.getRangeBoundaryPosition(t,!1),r=i?a:o,s=i?o:a;return N(r,!!i,s,n)}function I(e,t,n){for(var i,o=[],a=O(e,t,n);i=a.next();)o.push(i);return a.dispose(),o}function P(t,n,i){var o=e.createRange(t.node);o.setStartAndEnd(t.node,t.offset,n.node,n.offset);var a=!o.expand("word",i);return o.detach(),a}function M(e,t,n,i,o){function a(e,t){var n=g[e].previousVisible(),i=g[t-1],a=!o.wholeWordsOnly||P(n,i,o.wordOptions);return{startPos:n,endPos:i,valid:a}}for(var r,s,l,c,u,d,h=Q(o.direction),p=N(e,h,e.session.getRangeBoundaryPosition(i,h),o),f="",g=[],m=null;r=p.next();)if(s=r.character,n||o.caseSensitive||(s=s.toLowerCase()),h?(g.unshift(r),f=s+f):(g.push(r),f+=s),n){if(u=t.exec(f))if(d){if(l=u.index,c=l+u[0].length,!h&&c<f.length||h&&l>0){m=a(l,c);break}}else d=!0}else if(-1!=(l=f.indexOf(t))){m=a(l,l+t.length);break}return d&&(m=a(l,c)),p.dispose(),m}function B(e){return function(){var t=!!xt,n=R(),i=[n].concat(W.toArray(arguments)),o=e.apply(this,i);return t||k(),o}}function L(e,t){return B(function(n,r,s,l){"undefined"==typeof s&&(s=r,r=H),l=i(l,st);var c=a(l.characterOptions),u=o(l.wordOptions),d=e;t&&(d=s>=0,this.collapse(!d));var h=A(n.getRangeBoundaryPosition(this,d),r,s,c,u),p=h.position;return this[d?"setStart":"setEnd"](p.node,p.offset),h.unitsMoved})}function z(e){return B(function(t,n){n=a(n);for(var i,o=O(t,this,n,!e),r=0;(i=o.next())&&$.test(i.character);)++r;o.dispose();var s=r>0;return s&&this[e?"moveStart":"moveEnd"]("character",e?r:-r,{characterOptions:n}),s})}function F(e){return B(function(t,n){var i=!1;return this.changeEachRange(function(t){i=t[e](n)||i}),i})}var H="character",U="word",j=e.dom,W=e.util,G=W.extend,q=j.getBody,V=/^[ \t\f\r\n]+$/,K=/^[ \t\f\r]+$/,$=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,X=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,Z="en",Q=e.Selection.isDirectionBackward,Y=!1,J=!1,et=!1,tt=!0;!function(){var t=document.createElement("div");t.contentEditable="true",t.innerHTML="<p>1 </p><p></p>";var n=q(document),i=t.firstChild,o=e.getSelection();n.appendChild(t),o.collapse(i.lastChild,2),o.setStart(i.firstChild,0),Y=1==(""+o).length,t.innerHTML="1 <br>",o.collapse(t,2),o.setStart(t.firstChild,0),J=1==(""+o).length,t.innerHTML="1 <p>1</p>",o.collapse(t,2),o.setStart(t.firstChild,0),et=1==(""+o).length,n.removeChild(t),o.removeAllRanges()}();var nt,it={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0},ot={includeBlockContentTrailingSpace:!tt,includeSpaceBeforeBr:!J,includeSpaceBeforeBlock:!et,includePreLineTrailingSpace:!0},at={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:n}},rt={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},st={wordOptions:null,characterOptions:null},lt={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},ct={wordOptions:null,characterOptions:null,direction:"forward"},ut=j.getComputedStyleProperty;!function(){var e=document.createElement("table"),t=q(document);t.appendChild(e),nt="block"==ut(e,"display"),t.removeChild(e)}(),e.features.tableCssDisplayBlock=nt;var dt={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};C.prototype={get:function(e){return this.store.hasOwnProperty(e)?this.store[e]:null},set:function(e,t){return this.store[e]=t}};var ht=0,pt=0,ft={getPosition:function(e){var t=this.positions;return t.get(e)||t.set(e,new S(this,e))},toString:function(){return"[NodeWrapper("+j.inspectNode(this.node)+")]"}};E.prototype=ft;var gt="EMPTY",mt="NON_SPACE",vt="UNCOLLAPSIBLE_SPACE",yt="COLLAPSIBLE_SPACE",bt="TRAILING_SPACE_BEFORE_BLOCK",wt="TRAILING_SPACE_IN_BLOCK",Ct="TRAILING_SPACE_BEFORE_BR",Tt="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",Et="TRAILING_LINE_BREAK_AFTER_BR";G(ft,{isCharacterDataNode:T("isCharacterDataNode",j.isCharacterDataNode,"node"),getNodeIndex:T("nodeIndex",j.getNodeIndex,"node"),getLength:T("nodeLength",j.getNodeLength,"node"),containsPositions:T("containsPositions",d,"node"),isWhitespace:T("isWhitespace",v,"node"),isCollapsedWhitespace:T("isCollapsedWhitespace",y,"node"),getComputedDisplay:T("computedDisplay",s,"node"),isCollapsed:T("collapsed",b,"node"),isIgnored:T("ignored",w,"node"),next:T("nextPos",g,"node"),previous:T("previous",m,"node"),getTextNodeInfo:T("textNodeInfo",function(e){var t=null,n=!1,i=ut(e.parentNode,"whiteSpace"),o="pre-line"==i;return o?(t=K,n=!0):("normal"==i||"nowrap"==i)&&(t=V,n=!0),{node:e,text:e.data,spaceRegex:t,collapseSpaces:n,preLine:o}},"node"),hasInnerText:T("hasInnerText",function(e,t){for(var n=this.session,i=n.getPosition(e.parentNode,this.getNodeIndex()+1),o=n.getPosition(e,0),a=t?i:o,r=t?o:i;a!==r;){if(a.prepopulateChar(),a.isDefinitelyNonEmpty())return!0;a=t?a.previousVisible():a.nextVisible()}return!1},"node"),isRenderedBlock:T("isRenderedBlock",function(e){for(var t=e.getElementsByTagName("br"),n=0,i=t.length;i>n;++n)if(!b(t[n]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:T("trailingSpace",function(e){if("br"==e.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var t=e.lastChild;t;){if(!w(t))return 1==t.nodeType?this.session.getNodeWrapper(t).getTrailingSpace():"";t=t.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:T("leadingSpace",function(){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var St={character:"",characterType:gt,isBr:!1,prepopulateChar:function(){var e=this;if(!e.prepopulatedChar){var t=e.node,n=e.offset,i="",o=gt,a=!1;if(n>0)if(3==t.nodeType){var r=t.data,s=r.charAt(n-1),l=e.nodeWrapper.getTextNodeInfo(),c=l.spaceRegex;l.collapseSpaces?c.test(s)?n>1&&c.test(r.charAt(n-2))||(l.preLine&&"\n"===r.charAt(n)?(i=" ",o=Tt):(i=" ",o=yt)):(i=s,o=mt,a=!0):(i=s,o=vt,a=!0)}else{var u=t.childNodes[n-1];if(u&&1==u.nodeType&&!b(u)&&("br"==u.tagName.toLowerCase()?(i="\n",e.isBr=!0,o=yt,a=!1):e.checkForTrailingSpace=!0),!i){var d=t.childNodes[n];d&&1==d.nodeType&&!b(d)&&(e.checkForLeadingSpace=!0)}}e.prepopulatedChar=!0,e.character=i,e.characterType=o,e.isCharInvariant=a}},isDefinitelyNonEmpty:function(){var e=this.characterType;return e==mt||e==vt},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var e=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();e&&(this.isTrailingSpace=!0,this.character=e,this.characterType=yt),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var t=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();t&&(this.isLeadingSpace=!0,this.character=t,this.characterType=yt),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(e){for(var t,n=this;n=n.previousVisible();)if(t=n.getCharacter(e),""!==t)return n;return null},getCharacter:function(e){function t(){return l||(a=c.getPrecedingUncollapsedPosition(e),l=!0),a}if(this.resolveLeadingAndTrailingSpaces(),this.isCharInvariant)return this.character;var n=["character",e.includeSpaceBeforeBr,e.includeBlockContentTrailingSpace,e.includePreLineTrailingSpace].join("_"),i=this.cache.get(n);if(null!==i)return i;var o,a,r="",s=this.characterType==yt,l=!1,c=this;return s?(" "!=this.character||t()&&!a.isTrailingSpace&&"\n"!=a.character)&&("\n"==this.character&&this.isLeadingSpace?t()&&"\n"!=a.character&&(r="\n"):(o=this.nextUncollapsed(),o&&(o.isBr?this.type=Ct:o.isTrailingSpace&&"\n"==o.character?this.type=wt:o.isLeadingSpace&&"\n"==o.character&&(this.type=bt),"\n"===o.character?(this.type!=Ct||e.includeSpaceBeforeBr)&&(this.type!=bt||e.includeSpaceBeforeBlock)&&(this.type==wt&&o.isTrailingSpace&&!e.includeBlockContentTrailingSpace||(this.type!=Tt||o.type!=mt||e.includePreLineTrailingSpace)&&("\n"===this.character?o.isTrailingSpace?this.isTrailingSpace||this.isBr&&(o.type=Et,t()&&a.isLeadingSpace&&"\n"==a.character&&(o.character="")):r="\n":" "===this.character&&(r=" "))):r=this.character))):"\n"===this.character&&(!(o=this.nextUncollapsed())||o.isTrailingSpace),this.cache.set(n,r),r},equals:function(e){return!!e&&this.node===e.node&&this.offset===e.offset},inspect:x,toString:function(){return this.character}};S.prototype=St,G(St,{next:T("nextPos",function(e){var t=e.nodeWrapper,n=e.node,i=e.offset,o=t.session;if(!n)return null;var a,r,s;return i==t.getLength()?(a=n.parentNode,r=a?t.getNodeIndex()+1:0):t.isCharacterDataNode()?(a=n,r=i+1):(s=n.childNodes[i],o.getNodeWrapper(s).containsPositions()?(a=s,r=0):(a=n,r=i+1)),a?o.getPosition(a,r):null}),previous:T("previous",function(e){var t,n,i,o=e.nodeWrapper,a=e.node,r=e.offset,s=o.session;return 0==r?(t=a.parentNode,n=t?o.getNodeIndex():0):o.isCharacterDataNode()?(t=a,n=r-1):(i=a.childNodes[r-1],s.getNodeWrapper(i).containsPositions()?(t=i,n=j.getNodeLength(i)):(t=a,n=r-1)),t?s.getPosition(t,n):null}),nextVisible:T("nextVisible",function(e){var t=e.next();if(!t)return null;var n=t.nodeWrapper,i=t.node,o=t;return n.isCollapsed()&&(o=n.session.getPosition(i.parentNode,n.getNodeIndex()+1)),o}),nextUncollapsed:T("nextUncollapsed",function(e){for(var t=e;t=t.nextVisible();)if(t.resolveLeadingAndTrailingSpaces(),""!==t.character)return t;return null}),previousVisible:T("previousVisible",function(e){var t=e.previous();if(!t)return null;var n=t.nodeWrapper,i=t.node,o=t;return n.isCollapsed()&&(o=n.session.getPosition(i.parentNode,n.getNodeIndex())),o})});var xt=null,_t=function(){function e(e){var t=new C;return{get:function(n){var i=t.get(n[e]);if(i)for(var o,a=0;o=i[a++];)if(o.node===n)return o;return null},set:function(n){var i=n.node[e],o=t.get(i)||t.set(i,[]);o.push(n)}}}function t(){this.initCaches()}var n=W.isHostProperty(document.documentElement,"uniqueID");return t.prototype={initCaches:function(){this.elementCache=n?function(){var e=new C;return{get:function(t){return e.get(t.uniqueID)},set:function(t){e.set(t.node.uniqueID,t)}}}():e("tagName"),this.textNodeCache=e("data"),this.otherNodeCache=e("nodeName")},getNodeWrapper:function(e){var t;switch(e.nodeType){case 1:t=this.elementCache;break;case 3:t=this.textNodeCache;break;default:t=this.otherNodeCache}var n=t.get(e);return n||(n=new E(e,this),t.set(n)),n},getPosition:function(e,t){return this.getNodeWrapper(e).getPosition(t)},getRangeBoundaryPosition:function(e,t){var n=t?"start":"end";return this.getPosition(e[n+"Container"],e[n+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},t}();G(j,{nextNode:g,previousNode:m});
var Rt=Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=0,i=e.length;i>n;++n)if(e[n]===t)return n;return-1};G(e.rangePrototype,{moveStart:L(!0,!1),moveEnd:L(!1,!1),move:L(!0,!0),trimStart:z(!0),trimEnd:z(!1),trim:B(function(e,t){var n=this.trimStart(t),i=this.trimEnd(t);return n||i}),expand:B(function(e,t,n){var r=!1;n=i(n,lt);var s=a(n.characterOptions);if(t||(t=H),t==U){var l,c,u=o(n.wordOptions),d=e.getRangeBoundaryPosition(this,!0),h=e.getRangeBoundaryPosition(this,!1),p=D(d,s,u),f=p.nextEndToken(),g=f.chars[0].previousVisible();if(this.collapsed)l=f;else{var m=D(h,s,u);l=m.previousStartToken()}return c=l.chars[l.chars.length-1],g.equals(d)||(this.setStart(g.node,g.offset),r=!0),c&&!c.equals(h)&&(this.setEnd(c.node,c.offset),r=!0),n.trim&&(n.trimStart&&(r=this.trimStart(s)||r),n.trimEnd&&(r=this.trimEnd(s)||r)),r}return this.moveEnd(H,1,n)}),text:B(function(e,t){return this.collapsed?"":I(e,this,a(t)).join("")}),selectCharacters:B(function(e,t,n,i,o){var a={characterOptions:o};t||(t=q(this.getDocument())),this.selectNodeContents(t),this.collapse(!0),this.moveStart("character",n,a),this.collapse(!0),this.moveEnd("character",i-n,a)}),toCharacterRange:B(function(e,t,n){t||(t=q(this.getDocument()));var i,o,a=t.parentNode,r=j.getNodeIndex(t),s=-1==j.comparePoints(this.startContainer,this.endContainer,a,r),l=this.cloneRange();return s?(l.setStartAndEnd(this.startContainer,this.startOffset,a,r),i=-l.text(n).length):(l.setStartAndEnd(a,r,this.startContainer,this.startOffset),i=l.text(n).length),o=i+this.text(n).length,{start:i,end:o}}),findText:B(function(t,n,a){a=i(a,rt),a.wholeWordsOnly&&(a.wordOptions=o(a.wordOptions),a.wordOptions.includeTrailingSpace=!1);var r=Q(a.direction),s=a.withinRange;s||(s=e.createRange(),s.selectNodeContents(this.getDocument()));var l=n,c=!1;"string"==typeof l?a.caseSensitive||(l=l.toLowerCase()):c=!0;var u=t.getRangeBoundaryPosition(this,!r),d=s.comparePoint(u.node,u.offset);-1===d?u=t.getRangeBoundaryPosition(s,!0):1===d&&(u=t.getRangeBoundaryPosition(s,!1));for(var h,p=u,f=!1;;)if(h=M(p,l,c,s,a)){if(h.valid)return this.setStartAndEnd(h.startPos.node,h.startPos.offset,h.endPos.node,h.endPos.offset),!0;p=r?h.startPos:h.endPos}else{if(!a.wrap||f)return!1;s=s.cloneRange(),p=t.getRangeBoundaryPosition(s,!r),s.setBoundary(u.node,u.offset,r),f=!0}}),pasteHtml:function(e){if(this.deleteContents(),e){var t=this.createContextualFragment(e),n=t.lastChild;this.insertNode(t),this.collapseAfter(n)}}}),G(e.selectionPrototype,{expand:B(function(e,t,n){this.changeEachRange(function(e){e.expand(t,n)})}),move:B(function(e,t,n,i){var o=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var a=this.getRangeAt(0);i||(i={}),i.characterOptions=r(i.characterOptions),o=a.move(t,n,i),this.setSingleRange(a)}return o}),trimStart:F("trimStart"),trimEnd:F("trimEnd"),trim:F("trim"),selectCharacters:B(function(t,n,i,o,a,r){var s=e.createRange(n);s.selectCharacters(n,i,o,r),this.setSingleRange(s,a)}),saveCharacterRanges:B(function(e,t,n){for(var i=this.getAllRanges(),o=i.length,a=[],r=1==o&&this.isBackward(),s=0,l=i.length;l>s;++s)a[s]={characterRange:i[s].toCharacterRange(t,n),backward:r,characterOptions:n};return a}),restoreCharacterRanges:B(function(t,n,i){this.removeAllRanges();for(var o,a,r,s=0,l=i.length;l>s;++s)a=i[s],r=a.characterRange,o=e.createRange(n),o.selectCharacters(n,r.start,r.end,a.characterOptions),this.addRange(o,a.backward)}),text:B(function(e,t){for(var n=[],i=0,o=this.rangeCount;o>i;++i)n[i]=this.getRangeAt(i).text(t);return n.join("")})}),e.innerText=function(t,n){var i=e.createRange(t);i.selectNodeContents(t);var o=i.text(n);return i.detach(),o},e.createWordIterator=function(e,t,n){var r=R();n=i(n,ct);var s=a(n.characterOptions),l=o(n.wordOptions),c=r.getPosition(e,t),u=D(c,s,l),d=Q(n.direction);return{next:function(){return d?u.previousStartToken():u.nextEndToken()},dispose:function(){u.dispose(),this.next=function(){}}}},e.noMutation=function(e){var t=R();e(t),k()},e.noMutation.createEntryPointFunction=B,e.textRange={isBlockNode:u,isCollapsedWhitespaceNode:y,createPosition:B(function(e,t,n){return e.getPosition(t,n)})}});var mo={};mo.prepare=function(e){var t=[];for(var n in e)t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},mo.send=function(e,t,n,i,o){var a=new XMLHttpRequest;a.open(n,e,o),a.onreadystatechange=function(){4==a.readyState&&t(a.responseText,a)},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),"POST"==n&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(i)},mo.get=function(e,t,n,i){mo.send(e+(t?"?"+mo.prepare(t):""),n,"GET",null,i)},mo.post=function(e,t,n,i){mo.send(e,n,"POST",mo.prepare(t),i)};var vo=null,yo="en",bo={},wo={};d.prototype.init=function(){};var Co={};jQuery(window).on("beforeunload",h);var To={unsupported:'<div class="{{baseClass}}-unsupported-overlay"></div> <div class="{{baseClass}}-unsupported-content"> It has been detected that you a using a browser that is not supported by Raptor, please use one of the following browsers: <ul> <li><a href="http://www.google.com/chrome">Google Chrome</a></li> <li><a href="http://www.firefox.com">Mozilla Firefox</a></li> <li><a href="http://www.google.com/chromeframe">Internet Explorer with Chrome Frame</a></li> </ul> <div class="{{baseClass}}-unsupported-input"> <button class="{{baseClass}}-unsupported-close">Close</button> <input name="{{baseClass}}-unsupported-show" type="checkbox" /> <label>Don\'t show this message again</label> </div> <div>',"class-menu.item":'<li><a data-value="{{value}}">{{label}}</a></li>',"click-button-to-edit.button":"<button class=\"{{baseClass}}-button\">tr('clickButtonToEditPluginButton')</button>","color-menu-basic.menu":'<li><a data-color="automatic"><div class="{{baseClass}}-swatch" style="display: none"></div> <span>tr(\'colorMenuBasicAutomatic\')</span></a></li> <li><a data-color="white"><div class="{{baseClass}}-swatch" style="background-color: #ffffff"></div> <span>tr(\'colorMenuBasicWhite\')</span></a></li> <li><a data-color="black"><div class="{{baseClass}}-swatch" style="background-color: #000000"></div> <span>tr(\'colorMenuBasicBlack\')</span></a></li> <li><a data-color="grey"><div class="{{baseClass}}-swatch" style="background-color: #999"></div> <span>tr(\'colorMenuBasicGrey\')</span></a></li> <li><a data-color="blue"><div class="{{baseClass}}-swatch" style="background-color: #4f81bd"></div> <span>tr(\'colorMenuBasicBlue\')</span></a></li> <li><a data-color="red"><div class="{{baseClass}}-swatch" style="background-color: #c0504d"></div> <span>tr(\'colorMenuBasicRed\')</span></a></li> <li><a data-color="green"><div class="{{baseClass}}-swatch" style="background-color: #9bbb59"></div> <span>tr(\'colorMenuBasicGreen\')</span></a></li> <li><a data-color="purple"><div class="{{baseClass}}-swatch" style="background-color: #8064a2"></div> <span>tr(\'colorMenuBasicPurple\')</span></a></li> <li><a data-color="orange"><div class="{{baseClass}}-swatch" style="background-color: #f79646"></div> <span>tr(\'colorMenuBasicOrange\')</span></a></li>',"embed.dialog":'<div class="{{baseClass}}-panel-tabs ui-tabs ui-widget ui-widget-content ui-corner-all"> <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"> <li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a>tr(\'embedDialogTabCode\')</a></li> <li class="ui-state-default ui-corner-top"><a>tr(\'embedDialogTabPreview\')</a></li> </ul> <div class="{{baseClass}}-code-tab"> <p>tr(\'embedDialogTabCodeContent\')</p> <textarea></textarea> </div> <div class="{{baseClass}}-preview-tab" style="display: none"> <p>tr(\'embedDialogTabPreviewContent\')</p> <div class="{{baseClass}}-preview"></div> </div> </div>',"font-family.menu-item":'<li><a data-font="{{fontName}}"><span>{{fontTitle}}</span></a></li>',"image-resize.dialog":'<div class="raptor-resize-image"> <div> <label for="{{baseClass}}-width">tr(\'imageResizeDialogWidth\')</label> <input class="form-text" id="{{baseClass}}-width" name="width" type="text" placeholder="tr(\'imageResizeDialogWidthPlaceHolder\')"/> </div> <div> <label for="{{baseClass}}-height">tr(\'imageResizeDialogHeight\')</label> <input class="form-text" id="{{baseClass}}-height" name="height" type="text" placeholder="tr(\'imageResizeDialogHeightPlaceHolder\')"/> </div> <div class="{{baseClass}}-lock-proportions-container"> <span class="{{baseClass}}-lock-proportions"> <span class="ui-button-text">Constrain proportions</span> <span class="ui-icon ui-icon-locked"></span> </span> </div> </div>',"insert-file.dialog":'<div> <div> <label class="form-label">tr(\'insertFileURLLabel\')</label> <input type="text" name="location" class="form-text" placeholder="tr(\'insertFileURLPlaceHolder\')"/> </div> <div> <label class="form-label">tr(\'insertFileNameLabel\')</label> <input type="text" name="name" class="form-text" placeholder="tr(\'insertFileNamePlaceHolder\')"/> </div> </div>',"language-menu.item":'<li><a data-value="{{value}}"><span class="ui-icon ui-icon-flag-{{icon}}"></span>{{label}}</a></li>',"link.dialog":'<div style="display:none" class="{{baseClass}}-panel"> <div class="{{baseClass}}-menu"> <p>tr(\'linkCreateDialogMenuHeader\')</p> <fieldset data-menu=""></fieldset> </div> <div class="{{baseClass}}-wrap"> <div class="{{baseClass}}-content" data-content=""></div> </div> </div>',"link.document":'<h2>tr(\'linkTypeDocumentHeader\')</h2> <fieldset> <label for="{{baseClass}}-document-href">tr(\'linkTypeDocumentLocationLabel\')</label> <input id="{{baseClass}}-document-href" value="http://" name="location" class="{{baseClass}}-document-href" type="text" placeholder="tr(\'linkTypeDocumentLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeDocumentNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-document-target"> <input id="{{baseClass}}-document-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeDocumentNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeDocumentInfo\')',"link.email":'<h2>tr(\'linkTypeEmailHeader\')</h2> <fieldset class="{{baseClass}}-email"> <label for="{{baseClass}}-email">tr(\'linkTypeEmailToLabel\')</label> <input id="{{baseClass}}-email" name="email" type="text" placeholder="tr(\'linkTypeEmailToPlaceHolder\')"/> </fieldset> <fieldset class="{{baseClass}}-email"> <label for="{{baseClass}}-email-subject">tr(\'linkTypeEmailSubjectLabel\')</label> <input id="{{baseClass}}-email-subject" name="subject" type="text" placeholder="tr(\'linkTypeEmailSubjectPlaceHolder\')"/> </fieldset>',"link.error":'<div style="display:none" class="ui-widget {{baseClass}}-error-message {{messageClass}}"> <div class="ui-state-error ui-corner-all"> <p> <span class="ui-icon ui-icon-alert"></span> {{message}} </p> </div> </div>',"link.external":'<h2>tr(\'linkTypeExternalHeader\')</h2> <fieldset> <label for="{{baseClass}}-external-href">tr(\'linkTypeExternalLocationLabel\')</label> <input id="{{baseClass}}-external-href" value="http://" name="location" class="{{baseClass}}-external-href" type="text" placeholder="tr(\'linkTypeExternalLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeExternalNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-external-target"> <input id="{{baseClass}}-external-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeExternalNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeExternalInfo\')',"link.file-url":'<h2>tr(\'Link to a document or other file\')</h2> <fieldset> <label for="{{baseClass}}-external-href">tr(\'Location\')</label> <input id="{{baseClass}}-external-href" value="http://" name="location" class="{{baseClass}}-external-href" type="text" placeholder="tr(\'Enter your URL\')" /> </fieldset> <h2>tr(\'New window\')</h2> <fieldset> <label for="{{baseClass}}-external-target"> <input id="{{baseClass}}-external-target" name="blank" type="checkbox" /> <span>tr(\'Check this box to have the file open in a new browser window\')</span> </label> </fieldset> <h2>tr(\'Not sure what to put in the box above?\')</h2> <ol> <li>tr(\'Ensure the file has been uploaded to your website\')</li> <li>tr(\'Open the uploaded file in your browser\')</li> <li>tr("Copy the file\'s URL from your browser\'s address bar and paste it into the box above")</li> </ol>',"link.internal":'<h2>tr(\'linkTypeInternalHeader\')</h2> <fieldset> <label for="{{baseClass}}-internal-href">tr(\'linkTypeInternalLocationLabel\') {{domain}}</label> <input id="{{baseClass}}-internal-href" value="" name="location" class="{{baseClass}}-internal-href" type="text" placeholder="tr(\'linkTypeInternalLocationPlaceHolder\')" /> </fieldset> <h2>tr(\'linkTypeInternalNewWindowHeader\')</h2> <fieldset> <label for="{{baseClass}}-internal-target"> <input id="{{baseClass}}-internal-target" name="blank" type="checkbox" /> <span>tr(\'linkTypeInternalNewWindowLabel\')</span> </label> </fieldset> tr(\'linkTypeInternalInfo\')',"link.label":'<label> <input type="radio" name="link-type" autocomplete="off"/> <span>{{label}}</span> </label>',"paste.dialog":'<div class="{{baseClass}}-panel ui-dialog-content ui-widget-content"> <div class="{{baseClass}}-panel-tabs ui-tabs ui-widget ui-widget-content ui-corner-all"> <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all"> <li class="{{baseClass}}-tab-formatted-clean ui-state-default ui-corner-top ui-state-active ui-tabs-selected" style="display: none"><a>tr(\'pasteDialogFormattedCleaned\')</a></li> <li class="{{baseClass}}-tab-plain-text ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogPlain\')</a></li> <li class="{{baseClass}}-tab-formatted-unclean ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogFormattedUnclean\')</a></li> <li class="{{baseClass}}-tab-source ui-state-default ui-corner-top" style="display: none"><a>tr(\'pasteDialogSource\')</a></li> </ul> <div class="{{baseClass}}-content-formatted-clean" style="display: none"> <div contenteditable="true" class="{{baseClass}}-area {{baseClass}}-markup"></div> </div> <div class="{{baseClass}}-content-plain-text" style="display: none"> <textarea class="{{baseClass}}-area {{baseClass}}-plain"></textarea> </div> <div class="{{baseClass}}-content-formatted-unclean" style="display: none"> <div contenteditable="true" class="{{baseClass}}-area {{baseClass}}-rich"></div> </div> <div class="{{baseClass}}-content-source" style="display: none"> <textarea class="{{baseClass}}-area {{baseClass}}-source"></textarea> </div> </div> </div>',"snippet-menu.item":'<li><a data-name="{{name}}">{{name}}</a></li>',"special-characters.dialog":"<div> tr('specialCharactersHelp') <br/> <ul></ul> </div>","special-characters.tab-button":'<button data-setKey="{{setKey}}" data-charactersIndex="{{charactersIndex}}" title="{{description}}">{{htmlEntity}}</button>',"special-characters.tab-content":'<div id="{{baseClass}}-{{key}}"></div>',"special-characters.tab-li":'<li><a href="#{{baseClass}}-{{key}}">{{name}}</a></li>',"statistics.dialog":'<div> <ul> <li data-name="characters"></li> <li data-name="words"></li> <li data-name="sentences"></li> <li data-name="truncation"></li> </ul> </div>',"table.create-menu":'<table class="{{baseClass}}-menu"> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> <tr> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> <td></td> </tr> </table>',"tag-menu.menu":"<li><a data-value=\"na\">tr('tagMenuTagNA')</a></li> <li><a data-value=\"p\">tr('tagMenuTagP')</a></li> <li><a data-value=\"h1\">tr('tagMenuTagH1')</a></li> <li><a data-value=\"h2\">tr('tagMenuTagH2')</a></li> <li><a data-value=\"h3\">tr('tagMenuTagH3')</a></li> <li><a data-value=\"h4\">tr('tagMenuTagH4')</a></li> <li><a data-value=\"div\">tr('tagMenuTagDiv')</a></li> <li><a data-value=\"pre\">tr('tagMenuTagPre')</a></li> <li><a data-value=\"address\">tr('tagMenuTagAddress')</a></li>","unsaved-edit-warning.warning":'<div class="{{baseClass}} ui-corner-tl"> <span class="ui-icon ui-icon-alert"></span> <span>tr(\'unsavedEditWarningText\')</span> </div>',"view-source.dialog":'<div class="{{baseClass}}-inner-wrapper"> <textarea></textarea> </div>'};r("en","English",{alignCenterTitle:"Align text center",alignJustifyTitle:"Align text justify",alignLeftTitle:"Align text left",alignRightTitle:"Align text right",cancelDialogCancelButton:"Continue Editing",cancelDialogContent:"Are you sure you want to cancel editing? All changes will be lost!",cancelDialogOKButton:"Cancel Editing",cancelDialogTitle:"Cancel Editing",cancelTitle:"Cancel editing",classMenuTitle:"Style picker",clearFormattingTitle:"Clear formatting",clickButtonToEditText:"Edit",clickButtonToEditTitle:null,closeTitle:"Close this toolbar",colorMenuBasicAutomatic:"Automatic",colorMenuBasicBlack:"Black",colorMenuBasicBlue:"Blue",colorMenuBasicGreen:"Green",colorMenuBasicGrey:"Grey",colorMenuBasicOrange:"Orange",colorMenuBasicPurple:"Purple",colorMenuBasicRed:"Red",colorMenuBasicTitle:"Change text color",colorMenuBasicWhite:"White",dockToElementTitle:"Dock/undock editor to element",dockToScreenTitle:"Dock/undock editor to screen",embedTitle:"Embed object",embedDialogTitle:"Embed Object",embedDialogTabCode:"Embed Code",embedDialogTabCodeContent:"Paste your embed code into the text area below:",embedDialogTabPreview:"Preview",embedDialogTabPreviewContent:"A preview of your embedded object is displayed below:",embedDialogOKButton:"Embed Object",embedDialogCancelButton:"Cancel",errorUINoName:'UI "{{ui}}" is invalid (must have a name property)',errorUINotObject:'UI "{{ui}}" is invalid (must be an object)',errorUIOverride:'UI "{{name}}" has already been registered, and will be overwritten',floatLeftTitle:"Align image to the left",floatNoneTitle:"Remove image align",floatRightTitle:"Align image to the right",fontFamilyMenuTitle:"Choose your font",fontFamilyMenuFontDefault:"Default Font",fontFamilyMenuFontArial:"Arial",fontFamilyMenuFontPalatino:"Palatino",fontFamilyMenuFontGeorgia:"Georgia",fontFamilyMenuFontTimes:"Times New Roman",fontFamilyMenuFontComicSans:"Comic Sans",fontFamilyMenuFontImpact:"Impact",fontFamilyMenuFontCourier:"Courier New",guidesTitle:"Show element guides",historyRedoTitle:"Redo",historyUndoTitle:"Undo",hrCreateTitle:"Insert Horizontal Rule",imageResizeDialogWidth:"Image width",imageResizeDialogHeight:"Image height",imageResizeDialogWidthPlaceHolder:"Width",imageResizeDialogHeightPlaceHolder:"Height",imageResizeDialogTitle:"Resize Image",imageResizeDialogOKButton:"Resize",imageResizeDialogCancelButton:"Cancel",imageResizeTitle:"Resize this image",insertFileTitle:"Insert file",insertFileDialogTitle:"Insert file",insertFileDialogOKButton:"Insert file",insertFileDialogCancelButton:"Cancel",insertFileURLLabel:"File URL",insertFileNameLabel:"File Name",insertFileURLPlaceHolder:"File URL...",insertFileNamePlaceHolder:"File Name...",languageMenuTitle:"Change Language",loremIpsumTitle:"Insert dummy text for testing",listOrderedTitle:"Ordered list",listUnorderedTitle:"Unordered list",linkCreateTitle:"Insert Link",linkRemoveTitle:"Remove Link",linkCreateDialogTitle:"Insert Link",linkCreateDialogOKButton:"Insert Link",linkCreateDialogCancelButton:"Cancel",linkCreateDialogMenuHeader:"Choose a link type",linkTypeEmailLabel:"Email address",linkTypeEmailHeader:"Link to an email address",linkTypeEmailToLabel:"Email:",linkTypeEmailToPlaceHolder:"Enter email address",linkTypeEmailSubjectLabel:"Subject (optional):",linkTypeEmailSubjectPlaceHolder:"Enter subject",linkTypeExternalLabel:"Page on another website",linkTypeExternalHeader:"Link to a page on another website",linkTypeExternalLocationLabel:"Location:",linkTypeExternalLocationPlaceHolder:"Enter a URL",linkTypeExternalNewWindowHeader:"New window",linkTypeExternalNewWindowLabel:"Check this box to have the link open in a new browser window/tab.",linkTypeExternalInfo:"<h2>Not sure what to put in the box above?</h2><ol>    <li>Find the page on the web you want to link to.</li>    <li>Copy the web address from your browser's address bar and paste it into the box above.</li></ol>",linkTypeDocumentLabel:"Document or other file",linkTypeDocumentHeader:"Link to a document or other file",linkTypeDocumentLocationLabel:"Location:",linkTypeDocumentLocationPlaceHolder:"Enter a URL",linkTypeDocumentNewWindowHeader:"New window",linkTypeDocumentNewWindowLabel:"Check this box to have the file open in a new browser window/tab.",linkTypeDocumentInfo:"<h2>Not sure what to put in the box above?</h2><ol>    <li>Ensure the file has been uploaded to your website.</li>    <li>Open the uploaded file in your browser.</li>    <li>Copy the file's URL from your browser's address bar and paste it into the box above.</li></ol>",linkTypeInternalLabel:"Page on this website",linkTypeInternalHeader:"Link to a page on this website",linkTypeInternalLocationLabel:"",linkTypeInternalLocationPlaceHolder:"Enter a URI",linkTypeInternalNewWindowHeader:"New window",linkTypeInternalNewWindowLabel:"Check this box to have the link open in a new browser window/tab.",linkTypeInternalInfo:'<h2>Not sure what to put in the box above?</h2><ol>    <li>Find the page on this site link to.</li>    <li>Copy the web address from your browser\'s address bar, excluding "{{domain}}" and paste it into the box above.</li></ol>',logoTitle:"Learn More About the Raptor WYSIWYG Editor",navigateAway:"\nThere are unsaved changes on this page. \nIf you navigate away from this page you will lose your unsaved changes",pasteDialogTitle:"Paste",pasteDialogOKButton:"Insert",pasteDialogCancelButton:"Cancel",pasteDialogPlain:"Plain Text",pasteDialogFormattedCleaned:"Formatted &amp; Cleaned",pasteDialogFormattedUnclean:"Formatted Unclean",pasteDialogSource:"Source Code",placeholderPluginDefaultContent:"<br/>",saveTitle:"Save content",saveNotConfigured:"Save has not been configured, or is disabled.",saveJsonFail:"Failed to save {{failed}} content block(s)",saveJsonSaved:"Successfully saved {{saved}} content block(s).",saveRestFail:"Failed to save {{failed}} content block(s).",saveRestPartial:"Saved {{saved}} out of {{failed}} content blocks.",saveRestSaved:"Successfully saved {{saved}} content block(s).",snippetMenuTitle:"Snippets",specialCharactersArrows:"Arrows",specialCharactersDialogOKButton:"OK",specialCharactersDialogTitle:"Insert Special Characters",specialCharactersGreekAlphabet:"Greek Alphabet",specialCharactersHelp:'Click a special character to add it. Click "OK" when done to close this dialog',specialCharactersMathematics:"Mathematics",specialCharactersSymbols:"Symbols",specialCharactersTitle:"Insert a special character",statisticsButtonCharacterOverLimit:"{{charactersRemaining}} characters over limit",statisticsButtonCharacterRemaining:"{{charactersRemaining}} characters remaining",statisticsButtonCharacters:"{{characters}} characters",statisticsDialogCharactersOverLimit:"{{characters}} characters, {{charactersRemaining}} over the recommended limit",statisticsDialogCharactersRemaining:"{{characters}} characters, {{charactersRemaining}} remaining",statisticsDialogNotTruncated:"Content will not be truncated",statisticsDialogOKButton:"Ok",statisticsDialogSentence:"{{sentences}} sentence",statisticsDialogSentences:"{{sentences}} sentences",statisticsDialogTitle:"Content Statistics",statisticsDialogTruncated:"Content contains more than {{limit}} characters and may be truncated",statisticsDialogWord:"{{words}} word",statisticsDialogWords:"{{words}} words",statisticsTitle:"Click to view statistics",imageSwapTitle:"Swap this image",tableCreateTitle:"Create table",tableDeleteColumnTitle:"Delete table column",tableDeleteRowTitle:"Delete table row",tableInsertColumnTitle:"Insert table column",tableInsertRowTitle:"Insert table row",tableMergeCellsTitle:"Merge table cells",tableSplitCellsTitle:"Split table cells",tagMenuTagH1:"Heading&nbsp;1",tagMenuTagH2:"Heading&nbsp;2",tagMenuTagH3:"Heading&nbsp;3",tagMenuTagH4:"Heading&nbsp;4",tagMenuTagNA:"N/A",tagMenuTagP:"Paragraph",tagMenuTagDiv:"Div",tagMenuTagPre:"Pre-formatted",tagMenuTagAddress:"Address",tagMenuTitle:"Change element style",tagTreeElementLink:"Select {{element}} element",tagTreeElementTitle:'Click to select the contents of the "{{element}}" element',tagTreeRoot:"root",tagTreeRootLink:"Select all editable content",tagTreeRootTitle:"Click to select all editable content",textBlockQuoteTitle:"Block quote",textBoldTitle:"Bold",textItalicTitle:"Italic",textStrikeTitle:"Strike through",textSubTitle:"Sub-script",textSuperTitle:"Super-script",textUnderlineTitle:"Underline",textSizeDecreaseTitle:"Decrease text size",textSizeIncreaseTitle:"Increase text size",unsavedEditWarningText:"There are unsaved changes on this page",revisionsText:"Revisions",revisionsTextEmpty:"No Revisions",revisionsTitle:null,revisionsCreated:"Created",revisionsApplyButtonTitle:"Rollback",revisionsApplyButtonText:"Rollback",revisionsAJAXFailed:"Failed to retrieve revisions",revisionsApplyButtonDialogCancelButton:"Cancel",revisionsApplyButtonDialogOKButton:"Rollback",revisionsApplyButtonDialogTitle:"Rollback Confirmation",revisionsApplyDialogContent:"This will replace the current content with the selected revision.<br/>The current content will be added as a revision, and will be visible in the revisions list for this block.",revisionsDialogCancelButton:"Cancel",revisionsDialogTitle:"View content revisions",revisionsButtonCurrent:"Current",revisionsButtonViewDiffText:"Differences",revisionsButtonViewDiffTitle:null,revisionsDiffButtonDialogCancelButton:"Close",revisionsDiffButtonDialogTitle:"View differences",revisionsDiffButtonTitle:"View differences",revisionsDiffButtonText:"View differences",revisionsLoading:"Loading revisions...",revisionsNone:"No revisions for this element",revisionsPreviewButtonTitle:"Preview",revisionsPreviewButtonText:"Preview",fileManagerDialogTitle:"File Manager",fileManagerTitle:"File Manager",rfmClose:"Close",rfmContinue:"Continue",rfmDeleteTitle:"Delete",rfmDownloadTitle:"Download",rfmEditTitle:"Edit",rfmFileActions:"Actions",rfmFileModificationTime:"Modified",rfmFileName:"Name",rfmFileSize:"Size",rfmFileType:"Type",rfmFilteredTotal:"Showing {{start}} to {{end}} of {{filteredTotal}} files",rfmFirst:"First",rfmHeadingDirectories:"Directories",rfmHeadingSearch:"Search",rfmHeadingTags:"Tags",rfmHeadingUpload:"Upload",rfmInsertTitle:"Insert",rfmLast:"Last",rfmRenameTitle:"Rename",rfmSearch:"Go",rfmTagDocument:"Document",rfmTagImage:"Image",rfmTotal:", filtered from {{total}}",rfmUpload:"Upload",rfmUploadBrowse:"Browse",rfmUploadDrop:"Drop Files Here",rfmUploadFileRemove:"Remove",rfmUploadOr:"or",rfmViewTitle:"View",imageEditorDialogCancelButton:"Cancel",imageEditorDialogOKButton:"Save",imageEditorDialogTitle:"Image Editor",imageEditorTitle:"Edit Image",rieApply:"Apply",rieBlurTitle:"Blur",rieBrightnessTitle:"Brightness/Contrast",rieCancel:"Cancel",rieCancelTitle:"Cancel",rieColorAdjustTitle:"Adjsut Color",rieCropTitle:"Crop",rieDesaturateTitle:"Desaturate",rieFlipHTitle:"Flip Horizontally",rieFlipVTitle:"Flip Vertically",rieGlowTitle:"Glow",rieHslTitle:"Hue, Saturation, Lightness.",rieInvertTitle:"Invert",riePosterizeTitle:"Posterize",rieRedoTitle:"Redo",rieRemoveNoiseTitle:"Remove Noise",rieResizeTitle:"Resize",rieRevertTitle:"Revert",rieRotateLeftTitle:"Rotate Left",rieRotateRightTitle:"Rotate Right",rieSaveTitle:"Save",rieSaveTitle:"Save",rieSepiaTitle:"Sepia",rieSharpenTitle:"Sharpen",rieSolarizeTitle:"Solarize",rieUndoTitle:"Undo",rieUploadTitle:"Upload",rieActionColorAdjustRed:"Red",rieActionColorAdjustGreen:"Green",rieActionColorAdjustBlue:"Blue",rieActionBrightnessBrightness:"Brightness",rieActionBrightnessContrast:"Contrast",rieActionGlowAmount:"Glow Amount",rieActionGlowRadius:"Glow Radius",rieActionHsl:"Hue",rieActionHsl:"Saturation",rieActionHsl:"Lightness",rieActionPosterize:"Levels",viewSourceDialogCancelButton:"Close",viewSourceDialogOKButton:"Apply source code",viewSourceDialogTitle:"Content source code",viewSourceTitle:"View/edit source code"}),r("pl","Polski",{alignCenterTitle:"Wyrwna tekst centrum",alignJustifyTitle:"Wyrwna tekst uzasadnienia",alignLeftTitle:"Wyrwnaj tekst do lewej",alignRightTitle:"Wyrwnaj tekst do prawej",cancelDialogCancelButton:"Kontynuuj edycj",cancelDialogContent:"Czy na pewno chcesz anulowa edycj? Wszystkie zmiany zostan utracone!",cancelDialogOKButton:"Anulowanie edycji",cancelDialogTitle:"Anulowanie edycji",cancelTitle:"Anulowanie edycji",classMenuTitle:"Selektor stylu",clearFormattingTitle:"Wyczy formatowanie",clickButtonToEditText:"Edycja",clickButtonToEditTitle:"",colorMenuBasicAutomatic:"Automatyczne",colorMenuBasicBlack:"Czarny",colorMenuBasicBlue:"Niebieski",colorMenuBasicGreen:"Zielony",colorMenuBasicGrey:"Szary",colorMenuBasicOrange:"Orange",colorMenuBasicPurple:"Fioletowy",colorMenuBasicRed:"Czerwony",colorMenuBasicTitle:"Zmienianie koloru tekstu",colorMenuBasicWhite:"Biay",dockToElementTitle:"Dok/oddokowa edytor do elementu",dockToScreenTitle:"Dok/oddokowa edytor do ekranu",embedDialogCancelButton:"Anuluj",embedDialogOKButton:"Osadzi obiekt",embedDialogTabCode:"Osadzi kod",embedDialogTabCodeContent:"Wklej kod HTML w polu tekstowym poniej:",embedDialogTabPreview:"Podgld",embedDialogTabPreviewContent:"Podgld obiektu osadzonego jest wywietlany poniej:",embedDialogTitle:"Osadzi obiekt",embedTitle:"Osadzi obiekt",errorUINoName:'UI "{{ui}}" jest nieprawidowy (musi mie Waciwo name)',errorUINotObject:'UI "{{ui}}" jest nieprawidowy (musi by obiektem)',errorUIOverride:'UI "{{name}}" zostaa ju zarejestrowana i zostan zastpione',fileManagerDialogTitle:"Meneder plikw",fileManagerTitle:"Meneder plikw",floatLeftTitle:"Wyrwnanie obrazu w lewo",floatNoneTitle:"Usu obraz wyrwna",floatRightTitle:"Wyrwnanie obrazu w prawo",fontFamilyMenuFontArial:"Arial",fontFamilyMenuFontComicSans:"Komiks bez",fontFamilyMenuFontCourier:"Nowy Kurier",fontFamilyMenuFontDefault:"Domylna czcionka",fontFamilyMenuFontGeorgia:"Gruzja",fontFamilyMenuFontImpact:"Wpyw",fontFamilyMenuFontPalatino:"Palatyn",fontFamilyMenuFontTimes:"Times New Roman",fontFamilyMenuTitle:"Wybierz czcionki",guidesTitle:"Poka element przewodnikw",historyRedoTitle:"Wykonaj ponownie",historyUndoTitle:"Cofnij",hrCreateTitle:"Wstaw pozioma",imageResizeButtonDialogCancelButton:"Anuluj",imageResizeButtonDialogHeight:"Wysoko obrazu",imageResizeButtonDialogHeightPlaceHolder:"Wysoko",imageResizeButtonDialogOKButton:"Zmiana rozmiaru",imageResizeButtonDialogTitle:"Rozmiar obrazu",imageResizeButtonDialogWidth:"Szeroko obrazu",imageResizeButtonDialogWidthPlaceHolder:"Szeroko",imageResizeButtonText:"Rozmiar obrazu",insertFileDialogCancelButton:"Anuluj",insertFileDialogOKButton:"Wstaw plik",insertFileNameLabel:"Nazwa pliku",insertFileNamePlaceHolder:"Nazwa pliku...",insertFileTitle:"Wstaw plik",insertFileURLLabel:"Adres URL pliku",insertFileURLPlaceHolder:"Adres URL pliku...",languageMenuTitle:"Zmie jzyk",linkCreateDialogCancelButton:"Anuluj",linkCreateDialogMenuHeader:"Wybierz typ cza",linkCreateDialogOKButton:"Wstaw Link",linkCreateDialogTitle:"Wstaw Link",linkCreateTitle:"Wstaw Link",linkRemoveTitle:"Usu Link",linkTypeDocumentHeader:"Link do dokumentu lub inny plik",linkTypeDocumentInfo:"<h2>Nie wiesz, co naley umieci w polu powyej?</h2><ol>    <li>Upewnij si, e plik zosta przesany do Twojej witryny.</li>    <li>Otwrz plik przesane w przegldarce.</li>    <li>Skopiuj adres URL pliku z paska adresu przegldarki i wklej go w polu powyej.</li></ol>",linkTypeDocumentLabel:"Dokument lub inny plik",linkTypeDocumentLocationLabel:"Lokalizacja:",linkTypeDocumentLocationPlaceHolder:"Wprowad adres URL",linkTypeDocumentNewWindowHeader:"Nowe okno",linkTypeDocumentNewWindowLabel:"Zaznacz to pole aby plik jest otwarty w przegldarce nowe okno/kart.",linkTypeEmailHeader:"Link do adresu e-mail",linkTypeEmailLabel:"Adres e-mail",linkTypeEmailSubjectLabel:"Temat (opcjonalne):",linkTypeEmailSubjectPlaceHolder:"Wpisz temat",linkTypeEmailToLabel:"Adres e-mail:",linkTypeEmailToPlaceHolder:"Wpisz adres e-mail",linkTypeExternalHeader:"Link do strony na innej stronie internetowej",linkTypeExternalInfo:"<h2>Nie wiesz, co naley umieci w polu powyej?</h2><ol>    <li>Znajd stron sieci web, ktr chcesz si poczy.</li>    <li>Skopiuj adres internetowy z paska adresu przegldarki i wklej go w polu powyej.</li></ol>",linkTypeExternalLabel:"Strony na innej stronie internetowej",linkTypeExternalLocationLabel:"Lokalizacja:",linkTypeExternalLocationPlaceHolder:"Wprowad adres URL",linkTypeExternalNewWindowHeader:"Nowe okno",linkTypeExternalNewWindowLabel:"Zaznacz to pole, aby otworzy nowe okno przegldarki/karcie link.",linkTypeInternalHeader:"Link do strony na tej stronie",linkTypeInternalInfo:'<h2>Nie wiesz, co naley umieci w polu powyej?</h2><ol>    <li>Znajd strony na tej stronie link do.</li>    <li>Skopiuj adres www z przegldarki adres baru, z wyjtkiem "{{domain}}" i wklej go w polu powyej.</li></ol>',linkTypeInternalLabel:"Na stronie tej witryny",linkTypeInternalLocationLabel:"",linkTypeInternalLocationPlaceHolder:"Podaj identyfikator URI",linkTypeInternalNewWindowHeader:"Nowe okno",linkTypeInternalNewWindowLabel:"Zaznacz to pole, aby otworzy nowe okno przegldarki/karcie link.",listOrderedTitle:"Uporzdkowana lista",listUnorderedTitle:"Lista nieuporzdkowana",logoTitle:"Dowiedz si wicej o edytorze WYSIWYG Raptor",loremIpsumTitle:"Wstawianie tekstu manekina do testw",navigateAway:"\nNa tej stronie s niezapisane zmiany. \nJeli mona przej od tej strony stracisz niezapisane zmiany",pasteDialogCancelButton:"Anuluj",pasteDialogFormattedCleaned:"Sformatowany i oczyszczone",pasteDialogFormattedUnclean:"Sformatowany nieczyste",pasteDialogOKButton:"Wstaw",pasteDialogPlain:"Zwyky tekst",pasteDialogSource:"Kod rdowy",pasteDialogTitle:"Wklej",placeholderPluginDefaultContent:"",revisionsAJAXFailed:"Nie mona pobra wersje",revisionsApplyButtonDialogCancelButton:"Anuluj",revisionsApplyButtonDialogOKButton:"Wycofywanie",revisionsApplyButtonDialogText:"Potwierdzenie wycofania",revisionsApplyButtonDialogTitle:"Potwierdzenie wycofania",revisionsApplyButtonText:"Wycofywanie",revisionsApplyButtonTitle:"Wycofywanie",revisionsApplyDialogContent:"Spowoduje to zastpienie aktualnej treci z wybranej wersji.<br>Zawarto biecego zostan dodane jako zmian i bdzie widoczna na licie poprawki dla tego bloku.",revisionsButtonCurrent:"Prd",revisionsButtonViewDiffText:"Rnice",revisionsButtonViewDiffTitle:"",revisionsCreated:"Stworzony",revisionsDialogCancelButton:"Anuluj",revisionsDialogTitle:"Zobacz tre poprawki",revisionsDiffButtonDialogCancelButton:"Zamknij",revisionsDiffButtonDialogTitle:"Zobacz rnice",revisionsDiffButtonText:"Zobacz rnice",revisionsDiffButtonTitle:"Zobacz rnice",revisionsLoading:"adowanie poprawki...",revisionsNone:"Nie korekt dla tego elementu",revisionsPreviewButtonText:"Podgld",revisionsPreviewButtonTitle:"Podgld",revisionsText:"Poprawki",revisionsTextEmpty:"Nie zmian",revisionsTitle:"",rfmClose:"Zamknij",rfmContinue:"W dalszym cigu",rfmDelete:"Usu",rfmDownload:"Pobierz za darmo",rfmFileActions:"Dziaania",rfmFileModificationTime:"Zmodyfikowany",rfmFileName:"Nazwa",rfmFileSize:"Rozmiar",rfmFileType:"Typ",rfmFilteredTotal:"Wywietlone {{start}} {{end}} {{filteredTotal}} plikw",rfmFirst:"Pierwszy",rfmHeadingDirectories:"Katalogi",rfmHeadingSearch:"Szukaj",rfmHeadingTags:"Tagi",rfmHeadingUpload:"Przesa",rfmInsert:"Wstaw",rfmLast:"Ostatnia",rfmSearch:"I",rfmTagDocument:"Dokument",rfmTagImage:"Obraz",rfmTotal:", filtrowane z {{total}}",rfmUpload:"Przesa",rfmUploadBrowse:"Przegldaj",rfmUploadDrop:"Usuwanie plikw tutaj",rfmUploadFileRemove:"Usu",rfmUploadOr:"lub",rfmView:"Widok",saveJsonFail:"Nie udao si uratowa {{failed}} zawarto bloku",saveJsonSaved:"Zapisane {{saved}} zawarto bloku.",saveNotConfigured:"Zapisz nie zosta skonfigurowany, lub jest wyczona.",saveRestFail:"Nie udao si uratowa {{failed}} zawarto bloku.",saveRestPartial:"Zapisane {{saved}} {{failed}} bloki zawartoci.",saveRestSaved:"Zapisane {{saved}} zawarto bloku.",saveTitle:"Zapisywanie zawartoci",snippetMenuTitle:"Fragmenty",specialCharactersArrows:"Strzaki",specialCharactersDialogOKButton:"Ok",specialCharactersDialogTitle:"Wstawianie znakw specjalnych",specialCharactersGreekAlphabet:"Alfabet grecki",specialCharactersHelp:'Kliknij przycisk doda znak specjalny. Kliknij przycisk "OK" po zakoczeniu zamknij to okno',specialCharactersMathematics:"Matematyka",specialCharactersSymbols:"Symbole",specialCharactersTitle:"Wstawianie znakw specjalnych",statisticsButtonCharacterOverLimit:"{{charactersRemaining}} znakw ponad limit",statisticsButtonCharacterRemaining:"pozostao znakw {{charactersRemaining}}",statisticsButtonCharacters:"{{characters}} znakw",statisticsDialogCharactersOverLimit:"znaki {{characters}}, {{charactersRemaining}} przekroczenie zalecanej",statisticsDialogCharactersRemaining:"{{characters}} pozostao, {{charactersRemaining}}",statisticsDialogNotTruncated:"Zawartoci nie zostanie obcity",statisticsDialogOKButton:"Ok",statisticsDialogSentence:"zdanie {{sentences}}",statisticsDialogSentences:"{{sentences}} zda",statisticsDialogTitle:"Statystyki zawartoci",statisticsDialogTruncated:"Zawarto zawiera wicej ni {{limit}} znakw i moe zosta obcita",statisticsDialogWord:"sowo {{words}}",statisticsDialogWords:"{{words}} sw",statisticsTitle:"Kliknij, aby wywietli statystyki",tableCreateTitle:"Tworzenie tabeli",tableDeleteColumnTitle:"Usu kolumn tabeli",tableDeleteRowTitle:"Usuwanie wiersza tabeli",tableInsertColumnTitle:"Wstaw kolumn tabeli",tableInsertRowTitle:"Wstaw wiersz tabeli",tableMergeCellsTitle:"Scalanie komrek tabeli",tableSplitCellsTitle:"Podzia komrek tabeli",tagMenuTagAddress:"Adres",tagMenuTagDiv:"DIV",tagMenuTagH1:"Nagwek 1",tagMenuTagH2:"Nagwek 2",tagMenuTagH3:"Pozycja 3",tagMenuTagH4:"Pozycja 4",tagMenuTagNA:"N/D!",tagMenuTagP:"Ust.",tagMenuTagPre:"Wstpnie sformatowany",tagMenuTitle:"Zmieni styl",tagTreeElementLink:"Wybierz opcj {{element}}",tagTreeElementTitle:'Kliknij, aby zaznaczy zawarto elementu "{{element}}"',tagTreeRoot:"korze",tagTreeRootLink:"Wybierz wszystkie edytowalna tre",tagTreeRootTitle:"Kliknij, aby zaznaczy ca zawarto edycji",textBlockQuoteTitle:"Cytat blokowy",textBoldTitle:"Pogrubienie",textItalicTitle:"Kursywa",textSizeDecreaseTitle:"Zmniejsz rozmiar tekstu",textSizeIncreaseTitle:"Zwikszy rozmiar tekstu",textStrikeTitle:"Strajku poprzez",textSubTitle:"Sub-skrypt",textSuperTitle:"Super skrypt",textUnderlineTitle:"Podkrelenie",unsavedEditWarningText:"Na tej stronie s niezapisane zmiany",viewSourceDialogCancelButton:"Zamknij",viewSourceDialogOKButton:"Stosuje si kod rdowy",viewSourceDialogTitle:"Kod rdowy zawartoci",viewSourceTitle:"Wywietl/Edytuj kod rdowy"});
var Eo=["a","abbr","acronym","applet","b","basefont","bdo","big","br","button","cite","code","dfn","em","font","i","iframe","img","input","kbd","label","map","object","p","q","s","samp","select","small","span","strike","strong","sub","sup","textarea","tt","u","var","h1","h2","h3","h4","h5","h6"],So=["article","nav","section","footer","blockquote","body","button","center","dd","div","fieldset","form","iframe","li","noframes","noscript","object","td","th"],xo=["body","center","dd","div","dt","fieldset","form","iframe","li","td","th"],_o=["a","abbr","acronym","applet","b","basefont","bdo","big","br","button","cite","code","dfn","em","font","i","iframe","img","input","kbd","label","map","object","q","s","samp","script","select","small","span","strike","strong","sub","sup","textarea","u"],Ro=["address","blockquote","body","button","center","dd","div","fieldset","form","iframe","li","noframes","noscript","object","td","th"],ko=!1,No=jQuery;No(function(){rangy.initialized||rangy.init(),No.isFunction(rangy.rangePrototype.insertNodeAtEnd)||(rangy.rangePrototype.insertNodeAtEnd=function(e){var t=this.cloneRange();t.collapse(!1),t.insertNode(e),t.detach(),this.setEndAfter(e)})}),No("html").click(function(){No(".ui-editor-selectmenu-visible").removeClass("ui-editor-selectmenu-visible")});var Do,Ao,Oo,Io,Po;Object.create||(Object.create=function(e){function t(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter.");return t.prototype=e,new t}),"undefined"==typeof Node&&(Node={TEXT_NODE:3}),"".trim||(String.prototype.trim=function(){return this.replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,"")});var Mo={globalDefaults:{},defaults:{},enableHotkeys:!0,hotkeys:{},plugins:{},ui:{},layouts:{},presets:{},hoverPanels:{},instances:[],getInstances:function(){return this.instances},eachInstance:function(e){for(var t=0;t<this.instances.length;t++)e.call(this.instances[t],this.instances[t])},urlPrefix:"/raptor/",getTemplate:function(e,t){var n;if(this.templates[e])n=this.templates[e];else{var i=t||this.urlPrefix,o=e.split(".");i+=1===o.length?"templates/"+o[0]+".html":"plugins/"+o[0]+"/templates/"+o.splice(1).join("/")+".html",No.ajax({url:i,type:"GET",async:!1,timeout:15e3,error:function(){n=null},success:function(e){n=e}}),this.templates[e]=n}return n},isDirty:function(){for(var e=this.getInstances(),t=0;t<e.length;t++)if(e[t].isDirty())return!0;return!1},unloadWarning:function(){for(var e=this.getInstances(),t=0;t<e.length;t++)if(e[t].isDirty()&&e[t].isEditing()&&e[t].options.unloadWarning)return c("navigateAway")},registerUi:function(e){this.ui[e.name]=e},registerLayout:function(e){this.layouts[e.name]=e},registerPlugin:function(e){this.plugins[e.name]=e},registerPreset:function(e,t){this.presets[e.name]=e,t&&(this.defaults=e)},persist:function(e,t,n){e=n?n+"."+e:e;try{if(localStorage){var i;if(i=localStorage.uiWidgetEditor?JSON.parse(localStorage.uiWidgetEditor):{},void 0===t)return i[e];i[e]=t,localStorage.uiWidgetEditor=JSON.stringify(i)}}catch(o){}return t}},Bo=!1,Lo={_init:function(){if(!this.element.attr("data-raptor-initialised")){this.element.attr("data-raptor-initialised",!0),-1===No.inArray(this,Mo.instances)&&Mo.instances.push(this);var e=this,t=this.persist("locale")||this.options.initialLocale;t&&(vo=t);var n=this.options;this.options=this.options.preset?No.extend(!0,{},Mo.globalDefaults,Mo.presets[this.options.preset],this.options):No.extend(!0,{},Mo.globalDefaults,Mo.defaults,this.options),n.layouts&&n.layouts.toolbar&&n.layouts.toolbar.uiOrder&&(this.options.layouts.toolbar.uiOrder=n.layouts.toolbar.uiOrder),this.element.attr("id")||this.element.attr("id",rt()),this.ready=!1,this.events={},this.plugins={},this.layouts={},this.templates=No.extend({},Mo.templates),this.target=this.element,this.layout=null,this.previewState=null,this.pausedState=null,this.pausedScrollX=null,this.pausedScrollY=null,this.enabled=!1,this.initialised=!1,this.uiObjects={},this.hotkeys={},this.hotkeysSuspended=!1,this.options.enableHotkeys&&this.registerHotkey(this.hotkeys);for(var i in this.options.bind)this.bind(i,this.options.bind[i]);this.history=[],this.present=0,this.historyEnabled=!0,Si()&&(this.setOriginalHtml(this.element.is(":input")?this.element.val():this.element.html()),this.historyPush(this.getOriginalHtml()),this.element.is(":input")&&this.replaceOriginal(),this.loadPlugins(),this.dirty=!1,this.previousContent=null,this.previousSelection=null,this.getElement().addClass("raptor-editable-block"),this.loadLayouts(),this.ready=!0,this.fire("ready"),this.options.autoEnable&&No(function(){e.enableEditing()}))}},attach:function(){this.bind("change",this.historyPush),this.getElement().on("click.raptor","img",function(e){ln(e.target),this.checkSelectionChange()}.bind(this)),this.getElement().on("focus.raptor",this.showLayout.bind(this)),this.target.on("mouseup.raptor",this.checkSelectionChange.bind(this)),this.target.on("input.raptor",this.checkChange.bind(this)),No(window).bind("beforeunload",Mo.unloadWarning.bind(Mo));var e=this;No(window).resize(function(){e.fire("resize")})},detach:function(){this.unbind("change"),this.getElement().off("click.raptor","img"),this.getElement().off("focus.raptor"),this.getElement().blur(),this.target.off("mouseup.raptor"),this.target.off("keyup.raptor")},localeChange:function(){if(!this.ready){var e;return e=function(){this.unbind("ready",e),this.localeChange()},this.bind("ready",e),void 0}this.actionPreviewRestore();var t=[];for(var n in this.layouts)this.layouts[n].isVisible()&&t.push(n);this.layoutsDestruct(),this.events={},this.plugins={},this.uiObjects={},this.hotkeys={},this.loadPlugins(),this.loadLayouts();for(var i=0;i<t.length;i++)this.layouts[t[i]].show();this.checkSelectionChange()},restoreFocus:function(){this.getElement().focus()},getElement:function(){return this.target},getNode:function(){return this.target[0]},getOriginalElement:function(){return this.element},replaceOriginal:function(){if(this.target.is(":input")){for(var e=No("<div/>").html(this.element.val()).insertBefore(this.element).attr("id",rt()).addClass(this.element.attr("class")).addClass(this.options.classes),t=Y(this.element),n=0;n<this.options.replaceStyle.length;n++)e.css(this.options.replaceStyle[n],t[this.options.replaceStyle[n]]);this.element.hide(),this.bind("change",function(){this.getOriginalElement().is(":input")?this.getOriginalElement().val(this.getHtml()).trigger("input"):this.getOriginalElement().html(this.getHtml())}),this.target=e}},checkSelectionChange:function(){var e=rangy.serializeSelection(null,!1);this.previousSelection!==e&&this.fire("selectionChange"),this.previousSelection=e},checkChange:function(){var e=this.getHtml(),t=this.dirty;this.dirty=this.originalHtml!==e,this.previousHtml!==e&&(this.previousHtml=e,this.fire("change",[e]),t!==this.dirty&&(this.dirty?this.fire("dirty"):this.fire("cleaned")),this.checkSelectionChange())},change:function(){this.fire("change",[this.getHtml()])},destruct:function(){this.disableEditing(),this.fire("destroy"),this.events={},this.getElement().off(".raptor"),this.getOriginalElement().is(":input")&&(this.target.remove(),this.target=null,this.element.show()),this.layoutsDestruct()},actionPreview:function(e){this.actionPreviewRestore();try{var t=this.fire("selectionCustomise");t.length>0?this.previewState=E(this.previewState,this.target,function(){for(var n=0,i=t.length;i>n;n++)rangy.getSelection().setSingleRange(t[n]),this.selectionConstrain(),e()}.bind(this)):(this.selectionConstrain(),this.previewState=E(this.previewState,this.target,e)),this.checkSelectionChange()}catch(n){}},actionPreviewRestore:function(){this.previewState&&(this.target=S(this.previewState,this.target),this.previewState=null,this.checkSelectionChange())},actionApply:function(e){this.actionPreviewRestore();var t=this.stateSave();try{var n=this.fire("selectionCustomise");n.length>0?x(function(){for(var t=0,i=n.length;i>t;t++)rangy.getSelection().setSingleRange(n[t]),this.selectionConstrain(),x(e,this.history)}.bind(this),this.history):(this.selectionConstrain(),x(e,this.history)),this.checkChange()}catch(i){this.stateRestore(t)}},actionUndo:function(){},actionRedo:function(){},stateSave:function(){return this.selectionConstrain(),Hn(this.target)},stateRestore:function(e){var t=Un(this.target,e),n=rangy.getSelection();this.target=t.element,null!==t.ranges&&(n.setRanges(t.ranges),n.refresh())},selectionConstrain:function(){Dn(this.target[0])},pause:function(){this.pausedState||(this.pausedState=this.stateSave(),this.suspendHotkeys(),this.pausedScrollX=window.scrollX,this.pausedScrollY=window.scrollY)},resume:function(){this.pausedState&&(this.stateRestore(this.pausedState),this.pausedState=null,this.resumeHotkeys(),this.restoreFocus(),window.scrollTo(this.pausedScrollX,this.pausedScrollY))},persist:function(e,t){return this.options.persistence?Mo.persist(e,t,this.options.namespace):null},enableEditing:function(){if(!this.enabled){if(this.fire("enabling"),this.attach(),this.enabled=!0,this.getElement().addClass(this.options.baseClass+"-editing").addClass(this.options.classes),this.options.partialEdit?this.getElement().find(this.options.partialEdit).prop("contenteditable",!0):this.getElement().prop("contenteditable",!0),!this.initialised){this.initialised=!0;for(var e in this.plugins)this.plugins[e].enable();this.bindHotkeys(),this.getElement().closest("form").on("submit.raptor",function(){M(this.getElement()),this.fire("change",[this.getHtml()])}.bind(this))}M(this.getElement()),this.fire("enabled"),this.showLayout();var t=this.options.partialEdit?this.getElement().find("[contenteditable]")[0]:this.getNode();switch(this.options.autoSelect){case"all":sn(t);break;case"start":var n=No(t).find("*:first")[0];if(!n){sn(t);break}var i=rangy.createRange();i.setStartBefore(n),i.setEndBefore(n),an(i);break;case"end":var n=No(t).find("*:last")[0];if(!n){sn(t);break}sn(n);var i=rangy.createRange();i.setStartAfter(n),i.setEndAfter(n),an(i)}}},disableEditing:function(){this.enabled&&(this.detach(),this.enabled=!1,this.getElement().prop("contenteditable",!1).removeClass(this.options.baseClass+"-editing").removeClass(this.options.classes),rangy.getSelection().removeAllRanges(),this.fire("disabled"),this.options.reloadOnDisable&&!Bo&&(Bo=!0,window.location.reload()))},cancelEditing:function(){this.unify(function(e){e.stopEditing()})},stopEditing:function(){this.fire("cancel"),this.options.reloadOnDisable||this.resetHtml(),this.disableEditing(),this.dirty=!1,tn()},isEditing:function(){return this.enabled},isRoot:function(e){return this.getElement()[0]===No(e)[0]},unify:function(e,t){if(t!==!1&&e(this),this.options.unify){var n=this;Mo.eachInstance(function(t){t!==n&&t.options.unify&&e(t)})}},getLayout:function(e){return this.layouts[e]},loadLayouts:function(){for(var e in this.options.layouts)"undefined"!=typeof Mo.layouts[e]&&(this.layouts[e]=this.prepareComponent(Mo.layouts[e],this.options.layouts[e],"layout").instance,this.layouts[e].hotkeys&&this.registerHotkey(this.layouts[e].hotkeys,null,this.layouts[e]))},layoutsDestruct:function(){for(var e in this.layouts)this.layouts[e].destruct()},prepareComponent:function(e,t,n){var i=No.extend({},e),o=No.extend({},this.options,{baseClass:this.options.baseClass+"-"+n+"-"+p(e.name)},i.options,t);i.raptor=this,i.options=o;var a=i.init();return{init:a,instance:i}},showLayout:function(){this.unify(function(e){e.fire("layoutHide")},!1),this.fire("layoutShow"),this.fire("resize"),"undefined"==typeof this.getElement().attr("tabindex")&&this.getElement().attr("tabindex",-1)},getTemplate:function(e,t){return this.templates[e]||(this.templates[e]=f(e,this.options.urlPrefix)),g(this.templates[e],t)},historyPush:function(){if(this.historyEnabled){var e=this.getHtml();e!==this.historyPeek()&&(this.present!==this.history.length-1&&(this.history=this.history.splice(0,this.present+1)),this.history.push(this.getHtml()),this.present=this.history.length-1,this.fire("historyChange"))}},historyPeek:function(){return this.history.length?this.history[this.present]:null},historyBack:function(){this.present>0&&(this.present--,this.setHtml(this.history[this.present]),this.historyEnabled=!1,this.change(),this.historyEnabled=!0,this.fire("historyChange"))},historyForward:function(){this.present<this.history.length-1&&(this.present++,this.setHtml(this.history[this.present]),this.historyEnabled=!1,this.change(),this.historyEnabled=!0,this.fire("historyChange"))},registerHotkey:function(e,t){this.hotkeys[e]=t},bindHotkeys:function(){for(var e in this.hotkeys)this.getElement().on("keydown.raptor",e,function(e){if(this.isEditing()&&!this.hotkeysSuspended){var t=this.hotkeys[e.data]();t!==!1&&e.preventDefault()}}.bind(this))},suspendHotkeys:function(){this.hotkeysSuspended=!0},resumeHotkeys:function(){this.hotkeysSuspended=!1},isUiEnabled:function(e){return this.options.enableUi===!1&&"undefined"==typeof this.options.plugins[e]||this.options.plugins[e]===!1?!1:-1!==No.inArray(e,this.options.disabledUi)||-1!==No.inArray(e,this.options.disabledPlugins)?!1:!0},getUi:function(e){return this.uiObjects[e]},getPlugin:function(e){return this.uiObjects[e]||this.plugins[e]},loadPlugins:function(){var e=this;this.options.plugins||(this.options.plugins={});for(var t in Mo.plugins)this.options.enablePlugins===!1&&"undefined"==typeof this.options.plugins[t]||this.options.plugins[t]===!1||-1===No.inArray(t,this.options.disabledUi)&&-1===No.inArray(t,this.options.disabledPlugins)&&(e.plugins[t]=this.prepareComponent(Mo.plugins[t],e.options.plugins[t],"plugin").instance)},isDirty:function(){return this.dirty},getHtml:function(){return this.getElement().html()},clean:function(){this.actionApply(function(){M(this.getElement())}.bind(this))},setHtml:function(e){this.getElement().html(e),this.fire("html"),this.checkChange()},resetHtml:function(){this.setHtml(this.getOriginalHtml()),this.fire("cleaned")},getOriginalHtml:function(){return this.originalHtml},saved:function(e){this.setOriginalHtml(this.getHtml()),this.dirty=!1,this.fire("saved",e),this.fire("cleaned")},setOriginalHtml:function(e){this.originalHtml=e},bind:function(e,t,n){if("undefined"!=typeof t&&No.isFunction(t))for(var i=e.split(/,\s*/),o=0,a=i.length;a>o;o++)this.events[i[o]]||(this.events[i[o]]=[]),this.events[i[o]].push({context:n,callback:t})},unbind:function(e,t,n){for(var i=0,o=this.events[e].length;o>i;i++)this.events[e][i]&&this.events[e][i].callback===t&&this.events[e][i].context===n&&this.events[e].splice(i,1)},fire:function(e,t){var n=[];if(this.events[e])for(var i=0,o=this.events[e].length;o>i;i++){var a=this.events[e][i];if("undefined"!=typeof a&&"undefined"!=typeof a.callback){var r=a.callback.apply(a.context||this,t);"undefined"!=typeof r&&(n=n.concat(r))}}return n}};No.widget("ui.raptor",Lo),No.fn.raptor.Raptor=Mo,xi.prototype.init=function(){},xi.prototype.destruct=function(){},xi.prototype.isVisible=function(){return!1},xi.prototype.show=function(){},xi.prototype.hide=function(){},_i.prototype.init=function(){},_i.prototype.enable=function(){},Ri.prototype.appendTo=function(e,t){for(var n=0,i=this.uiOrder.length;i>n;n++){for(var o=No("<div/>").addClass(this.raptor.options.baseClass+"-layout-toolbar-group"),a=this.uiOrder[n],r=0,s=a.length;s>r;r++)if(this.raptor.isUiEnabled(a[r])&&Mo.ui[a[r]]){var l=this.raptor.options.plugins[a[r]];if(l===!1)continue;var c=this.raptor.prepareComponent(Mo.ui[a[r]],l,"ui");c.instance.layout=e,this.raptor.uiObjects[a[r]]=c.instance,T(c.init)&&(c.init.removeClass("ui-corner-all"),o.append(c.init))}o.children().length>0&&o.appendTo(t)}t.find(".ui-button:first-child").addClass("ui-corner-left"),t.find(".ui-button:last-child").addClass("ui-corner-right")},ki.prototype=Object.create(xi.prototype),ki.prototype.init=function(){this.raptor.bind("enabled",this.show.bind(this)),this.raptor.bind("disabled",this.hide.bind(this)),this.raptor.bind("layoutShow",this.show.bind(this)),this.raptor.bind("layoutHide",this.hide.bind(this)),No(window).resize(this.constrainPosition.bind(this))},ki.prototype.destruct=function(){this.wrapper&&(this.wrapper.remove(),this.wrapper=null),this.raptor.fire("toolbarDestroy")},ki.prototype.show=function(){this.isVisible()||(this.getElement().css("display",""),this.constrainPosition(),this.raptor.fire("toolbarShow"))},ki.prototype.hide=function(){this.isReady()&&(this.getElement().css("display","none"),this.raptor.fire("toolbarHide"))},ki.prototype.initDragging=function(){if(No.fn.draggable&&this.options.draggable&&!this.getElement().data("ui-draggable")){this.getElement().draggable({cancel:"a, button",cursor:"move",stop:this.constrainPosition.bind(this)}),this.getElement().css("position","fixed");var e=this.raptor.persist("position")||this.options.dialogPosition;e||(e=[10,10]),parseInt(e[0],10)+this.getElement().outerHeight()>No(window).height()&&(e[0]=No(window).height()-this.getElement().outerHeight()),parseInt(e[1],10)+this.getElement().outerWidth()>No(window).width()&&(e[1]=No(window).width()-this.getElement().outerWidth()),this.getElement().css({top:Math.abs(parseInt(e[0],10)),left:Math.abs(parseInt(e[1],10))})}},ki.prototype.enableDragging=function(){No.fn.draggable&&this.options.draggable&&this.getElement().data("ui-draggable")&&this.getElement().draggable("enable")},ki.prototype.disableDragging=function(){No.fn.draggable&&this.options.draggable&&this.getElement().is(".ui-draggable")&&this.getElement().draggable("disable").removeClass("ui-state-disabled")},ki.prototype.isReady=function(){return null!==this.wrapper},ki.prototype.isVisible=function(){return this.isReady()&&this.getElement().is(":visible")},ki.prototype.constrainPosition=function(){if(this.isVisible()){var e=parseInt(this.wrapper.css("left"))||-999,t=parseInt(this.wrapper.css("top"))||-999,n=this.wrapper.outerWidth(),i=this.wrapper.outerHeight(),o=No(window).width(),a=No(window).height(),r=Math.max(0,Math.min(e,o-n)),s=Math.max(0,Math.min(t,a-i));(r!==e||s!==t)&&this.wrapper.css({left:r,top:s}),this.raptor.persist("position",[this.wrapper.css("top"),this.wrapper.css("left")])}},ki.prototype.getElement=function(){if(null===this.wrapper){if(!this.options.uiOrder){this.options.uiOrder=[[]];for(var e in Mo.ui)this.options.uiOrder[0].push(e)}var t=this.toolbar=No("<div/>").addClass(this.options.baseClass+"-toolbar"),n=this.toolbarWrapper=No("<div/>").addClass(this.options.baseClass+"-inner").addClass("ui-widget-content").mousedown(function(e){e.preventDefault()}).append(t),i=this.path=No("<div/>").addClass(this.options.baseClass+"-path").addClass("ui-widget-header"),o=this.wrapper=No("<div/>").addClass(this.options.baseClass+"-outer "+this.raptor.options.baseClass+"-layout").css("display","none").append(i).append(n),a=new Ri(this.raptor,this.options.uiOrder);a.appendTo(this,this.toolbar),No("<div/>").css("clear","both").appendTo(this.toolbar),No(function(){o.appendTo("body"),this.initDragging(),this.constrainPosition(!0),this.raptor.fire("layoutReady",[this.wrapper]),this.raptor.fire("toolbarReady",[this])}.bind(this))}return this.wrapper},Mo.registerLayout(new ki),Ni.prototype=Object.create(xi.prototype),Ni.prototype.init=function(){this.raptor.bind("ready",this.ready.bind(this)),this.raptor.bind("enabled",this.enabled.bind(this))},Ni.prototype.ready=function(){this.raptor.getElement().mouseenter(this.show.bind(this)).mouseleave(this.hide.bind(this))},Ni.prototype.enabled=function(){this.getElement().hide()},Ni.prototype.getElement=function(){if(null===this.hoverPanel){this.hoverPanel=No("<div/>").addClass(this.raptor.options.baseClass+"-layout "+this.options.baseClass).mouseleave(this.hide.bind(this));var e=new Ri(this.raptor,this.options.uiOrder);e.appendTo(this,this.hoverPanel),No(window).bind("scroll",this.position.bind(this)),this.hoverPanel.appendTo("body"),this.raptor.fire("layoutReady",[this.hoverPanel])}return this.hoverPanel},Ni.prototype.show=function(){this.raptor.isEditing()||(this.visible=!0,this.getElement().show(),this.position(),this.raptor.getElement().addClass(this.raptor.options.baseClass+"-editable-block-hover"))},Ni.prototype.hide=function(e){this.visible&&e&&(No.contains(this.getElement().get(0),e.relatedTarget)||e.relatedTarget!==this.getElement().get(0)&&this.getElement().get(0)!==No(e.relatedTarget).parent().get(0)&&(No.contains(this.raptor.getElement().get(0),e.relatedTarget)||e.relatedTarget!==this.raptor.getElement().get(0)&&(this.visible=!1,this.getElement().hide(),this.raptor.getElement().removeClass(this.raptor.options.baseClass+"-editable-block-hover"))))},Ni.prototype.position=function(){if(this.visible){var e=Z(this.raptor.getElement());this.getElement().css({top:e.top+(e.height/2-this.getElement().outerHeight()/2),left:e.left+(e.width/2-this.getElement().outerWidth()/2)})}},Ni.prototype.destruct=function(){this.hoverPanel&&(this.hoverPanel.remove(),this.hoverPanel=null),this.visible=!1},Mo.registerLayout(new Ni),Di.prototype=Object.create(xi.prototype),Di.prototype.init=function(){this.raptor.bind("ready",this.ready.bind(this))},Di.prototype.ready=function(){this.raptor.getElement().on("mouseenter",this.options.elements,this.show.bind(this)).on("mouseleave",this.options.elements,this.hide.bind(this))},Di.prototype.getElement=function(){if(null===this.hoverPanel){this.hoverPanel=No("<div/>").addClass(this.raptor.options.baseClass+"-layout raptor-layout-hover-panel "+this.options.baseClass).mouseleave(this.hide.bind(this));var e=new Ri(this.raptor,this.options.uiOrder);e.appendTo(this,this.hoverPanel),No(window).bind("scroll",this.position.bind(this)),this.hoverPanel.appendTo("body"),this.raptor.fire("layoutReady",[this.hoverPanel])}return this.hoverPanel},Di.prototype.show=function(e){this.enabled&&this.raptor.isEditing()&&(this.target=e.target,this.visible=!0,lt(this.getElement().show(),No(this.target)))},Di.prototype.hide=function(e){if(this.visible){if(e){if(No.contains(this.getElement().get(0),e.relatedTarget))return;if(e.relatedTarget===this.getElement().get(0))return;if(this.getElement().get(0)===No(e.relatedTarget).parent().get(0))return;if(No.contains(this.raptor.getElement().get(0),e.relatedTarget))return;if(e.relatedTarget===this.raptor.getElement().get(0))return}this.visible=!1,this.getElement().hide()}},Di.prototype.close=function(){this.visible&&(this.enabled=!1,this.visible=!1,this.getElement().hide(),setTimeout(function(){this.enabled=!0}.bind(this),1e3))},Di.prototype.position=function(){this.visible&&lt(this.getElement(),No(this.target))},Di.prototype.destruct=function(){this.hoverPanel&&(this.hoverPanel.remove(),this.hoverPanel=null),this.visible=!1},Mo.registerLayout(new Di),Ai.prototype.init=function(){if("string"==typeof this.hotkey)this.raptor.registerHotkey(this.hotkey,this.action.bind(this));else if(b(this.hotkey))for(var e=0,t=this.hotkey.length;t>e;e++)this.raptor.registerHotkey(this.hotkey[e],this.action.bind(this));return this.getButton()},Ai.prototype.getButton=function(){if(!this.button){var e=this.text||this.translate("Text",!1);this.button=No("<div>").html(e).addClass(this.options.baseClass).attr("title",this.getTitle()).click(this.click.bind(this)),ui(this.button,{icons:{primary:this.getIcon()},text:e,label:this.label})}return this.button},Ai.prototype.getTitle=function(){return this.title||this.translate("Title")},Ai.prototype.getIcon=function(){return null===this.icon?"ui-icon-"+Wn(this.name):this.icon},Ai.prototype.click=function(){fi(this.button)&&this.raptor.actionApply(this.action.bind(this))},Ai.prototype.translate=function(e,t){return c(this.name+e,t)},Oi.prototype=Object.create(Ai.prototype),Oi.prototype.init=function(){return this.preview="undefined"==typeof this.options.preview?!0:!1,Ai.prototype.init.apply(this,arguments)},Oi.prototype.getButton=function(){return this.button||(this.button=Ai.prototype.getButton.call(this).mouseenter(this.mouseEnter.bind(this)).mouseleave(this.mouseLeave.bind(this))),this.button},Oi.prototype.mouseEnter=function(){this.canPreview()&&(this.previewing=!0,this.raptor.actionPreview(this.action.bind(this)))},Oi.prototype.mouseLeave=function(){this.previewing=!1,this.raptor.actionPreviewRestore()},Oi.prototype.click=function(){return this.previewing=!1,Ai.prototype.click.apply(this,arguments)},Oi.prototype.canPreview=function(){return this.preview},Oi.prototype.isPreviewing=function(){return this.previewing},Ii.prototype=Object.create(Ai.prototype),Ii.prototype.init=function(){return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),Ai.prototype.init.apply(this,arguments)},Ii.prototype.selectionChange=function(){this.selectionToggle()?(mi(this.button),this.disable&&pi(this.button)):(vi(this.button),this.disable&&gi(this.button))},Pi.prototype=Object.create(Oi.prototype),Pi.prototype.init=function(){return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),Oi.prototype.init.apply(this,arguments)},Pi.prototype.selectionChange=function(){this.selectionToggle()?this.isPreviewing()||mi(this.button):vi(this.button)},Mi.prototype=Object.create(Oi.prototype),Mi.prototype.init=function(){var e=Oi.prototype.init.apply(this,arguments);return this.raptor.bind("selectionChange",this.selectionChange.bind(this)),e},Mi.prototype.selectionChange=function(){this.isEnabled()?pi(this.button):gi(this.button)},Mi.prototype.canPreview=function(){return Oi.prototype.canPreview.call(this)&&this.isEnabled()},Mi.prototype.isEnabled=function(){var e=Yt();return e?!!this.getElement(e):!!this.previewing},Mi.prototype.action=function(){on(function(e){var t=this.getElement(e);t&&this.applyToElement(t)}.bind(this))},Bi.prototype=Object.create(Pi.prototype),Bi.prototype.action=function(){In(),this.raptor.selectionConstrain();for(var e=0,t=this.classes.length;t>e;e++){var n=rangy.createCssClassApplier(this.options.cssPrefix+this.classes[e],{elementTagName:this.tag||"span"});n.toggleSelection()}},Bi.prototype.selectionToggle=function(){for(var e=0,t=this.classes.length;t>e;e++){var n=rangy.createCssClassApplier(this.options.cssPrefix+this.classes[e],{elementTagName:this.tag||"span"});if(!n.isAppliedToSelection())return!1}return!0};var zo={};Li.prototype=Object.create(Ai.prototype),Li.prototype.action=function(){this.openDialog()},Li.prototype.validateDialog=function(){return!0},Li.prototype.openDialog=function(){this.raptor.pause(),wi(this.getDialog())},Li.prototype.onDialogClose=function(){zo[this.name].instance.raptor.resume()},Li.prototype.okButtonClick=function(){var e=zo[this.name].instance.validateDialog();e===!0&&(Ci(zo[this.name].dialog),zo[this.name].instance.applyAction.call(zo[this.name].instance,zo[this.name].dialog))},Li.prototype.closeDialog=function(){Ci(zo[this.name].dialog)},Li.prototype.cancelButtonClick=Li.prototype.closeDialog,Li.prototype.getOkButton=function(e){return{text:c(e+"DialogOKButton"),click:this.okButtonClick.bind(this),icons:{primary:"ui-icon-circle-check"}}},Li.prototype.getCancelButton=function(e){return{text:c(e+"DialogCancelButton"),click:this.cancelButtonClick.bind(this),icons:{primary:"ui-icon-circle-close"}}},Li.prototype.getDefaultDialogOptions=function(e){var t={modal:!0,resizable:!0,autoOpen:!1,title:c(e+"DialogTitle"),dialogClass:this.options.baseClass+"-dialog "+this.options.dialogClass,close:this.onDialogClose.bind(this),buttons:[]},n=this.getOkButton(e),i=this.getCancelButton(e);return"undefined"!=typeof n&&n!==!1&&t.buttons.push(n),"undefined"!=typeof i&&i!==!1&&t.buttons.push(i),t},Li.prototype.getDialog=function(){return"undefined"==typeof zo[this.name]&&(zo[this.name]={dialog:No(this.getDialogTemplate())},bi(zo[this.name].dialog,No.extend(this.getDefaultDialogOptions(this.name),this.dialogOptions))),zo[this.name].instance=this,zo[this.name].dialog},zi.prototype=Object.create(Li.prototype),zi.prototype.init=Ii.prototype.init,zi.prototype.selectionChange=Ii.prototype.selectionChange,Fi.prototype=Object.create(Ai.prototype),Fi.prototype.click=function(e){this.menu.getMenu().is(":visible")?No(".raptor-menu").hide():this.menu.show(),e.preventDefault()},Hi.prototype.init=function(){this.setOptions();var e=this.getButton().init();return e.addClass("raptor-menu-button"),e},Hi.prototype.getButton=function(){return this.button||(this.button=new Fi(this)),this.button},Hi.prototype.setOptions=function(){this.options.title=c(this.name+"Title"),this.options.icon="ui-icon-"+this.name},Hi.prototype.getMenu=function(){return this.menu||(this.menu=No("<div>").addClass("ui-menu ui-widget ui-widget-content ui-corner-all "+this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.menuContent).css("position","fixed").hide().mousedown(function(e){e.preventDefault()}).children().appendTo("body")),this.menu},Hi.prototype.show=function(){No(".raptor-menu").hide(),it(this.getMenu().toggle(),this.getButton().getButton())},No("html").click(function(e){No(e.target).hasClass("raptor-menu-button")||0!==No(e.target).closest(".raptor-menu-button").length||No(".raptor-menu").hide()}),Hi.prototype.getMenu=function(){return this.menu||(this.menu=No("<div>").addClass("ui-menu ui-widget ui-widget-content ui-corner-all "+this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.menuContent).css("position","fixed").hide().appendTo("body").mousedown(function(e){e.preventDefault()})),this.menu},Ui.prototype=Object.create(Hi.prototype),Ui.prototype.menuItemMouseDown=function(e){e.preventDefault()},Ui.prototype.menuItemClick=function(e){return di(this.button.button,No(e.target).html()),No(this.menu).closest("ul").hide(),!1},Ui.prototype.menuItemMouseEnter=function(){},Ui.prototype.menuItemMouseLeave=function(){},Ui.prototype.getMenu=function(){return this.menu||(this.menu=No("<ul>").addClass(this.options.baseClass+"-menu "+this.raptor.options.baseClass+"-menu").html(this.getMenuItems()).css("position","fixed").hide().find("a").mousedown(this.menuItemMouseDown.bind(this)).mouseenter(this.menuItemMouseEnter.bind(this)).mouseleave(this.menuItemMouseLeave.bind(this)).click(this.menuItemClick.bind(this)).end().appendTo("body"),yi(this.menu)),this.menu},No.extend(Mo,{Button:Ai,CSSClassApplierButton:Bi,DialogButton:Li,DialogToggleButton:zi,FilteredPreviewButton:Mi,HoverPanelLayout:Ni,Menu:Hi,MenuButton:Fi,PreviewButton:Oi,PreviewToggleButton:Pi,RaptorLayout:xi,RaptorPlugin:_i,SelectMenu:Ui,TextAlignButton:lo,ToggleButton:Ii,ToolbarLayout:ki,UiGroup:Ri,aButton:ui,aButtonActive:mi,aButtonDisable:gi,aButtonEnable:pi,aButtonInactive:vi,aButtonIsEnabled:fi,aButtonSetIcon:hi,aButtonSetLabel:di,aDialog:bi,aDialogClose:Ci,aDialogOpen:wi,aMenu:yi,aTabs:Ti,actionApply:x,actionPreview:E,actionPreviewRestore:S,actionRedo:R,actionUndo:_,clean:M,cleanEmptyAttributes:D,cleanEmptyElements:O,cleanRemoveComments:A,cleanReplaceElements:k,cleanUnnestElement:P,cleanUnwrapElements:N,cleanWrapTextNodes:I,dockToElement:z,dockToScreen:B,elementBringToTop:U,elementChangeTag:st,elementClosestBlock:at,elementContainsBlockElement:V,elementDefaultDisplay:K,elementDetachedManip:ot,elementFirstInvalidElementOfValidParent:X,elementGetAttributes:Q,elementGetStyles:Y,elementIsBlock:q,elementIsEmpty:nt,elementIsValid:$,elementOuterHtml:W,elementOuterText:G,elementPositionUnder:it,elementRemoveAttributes:H,elementSwapStyles:tt,elementToggleStyle:et,elementUniqueId:rt,elementVisibleRect:Z,elementWrapInner:J,extendLocale:r,fragmentInsertBefore:ut,fragmentToHtml:ct,getLocalizedString:l,listBreakAtSelection:Rt,listBreakByReplacingSelection:_t,listConvertItemsForList:vt,listConvertListItem:yt,listConvertListType:xt,listEnforceValidChildren:gt,listRemoveEmpty:Tt,listRemoveEmptyItems:Ct,listShouldConvertType:pt,listShouldUnwrap:ht,listShouldWrap:ft,listTidyModified:wt,listToggle:dt,listUnwrap:bt,listUnwrapSelectedListItems:Et,listUnwrapSelection:St,listWrapSelection:mt,nodeFindParent:kt,nodeFindTextNodes:Nt,nodeIsChildOf:Dt,persistGet:Ot,persistSet:At,rangeContainsNode:Gt,rangeContainsNodeText:qt,rangeDeserialize:$t,rangeEmptyTag:zt,rangeExpandTo:Bt,rangeExpandToParent:It,rangeGet:Yt,rangeGetCommonAncestor:Ut,rangeGetEndElement:Ht,rangeGetStartElement:Ft,rangeIsContainedBy:Wt,rangeIsEmpty:jt,rangeReplace:Lt,rangeReplaceSplitInvalidTags:Xt,rangeReplaceWithinValidTags:Zt,rangeSelectElement:Pt,rangeSelectElementContent:Mt,rangeSerialize:Kt,rangeToHtml:Qt,rangeTrim:Vt,registerLocale:a,selectionAtEndOfElement:yn,selectionAtStartOfElement:bn,selectionChangeTags:Ln,selectionClearFormatting:An,selectionConstrain:Dn,selectionContains:zn,selectionDelete:Fn,selectionDestroy:tn,selectionEachBlock:kn,selectionEachRange:on,selectionExists:En,selectionExpandTo:Pn,selectionExpandToWord:In,selectionFindWrappingAndInnerElements:Bn,selectionGetElement:fn,selectionGetElements:gn,selectionGetEndElement:vn,selectionGetHtml:pn,selectionGetStartElement:mn,selectionInverseWrapWithTagClass:On,selectionIsEmpty:wn,selectionRange:Sn,selectionReplace:rn,selectionReplaceSplittingSelectedElement:xn,selectionReplaceWithinValidTags:_n,selectionRestore:en,selectionSave:Jt,selectionSaved:nn,selectionSelectEdge:cn,selectionSelectEnd:un,selectionSelectInner:sn,selectionSelectOuter:ln,selectionSelectStart:dn,selectionSelectToEndOfElement:hn,selectionSet:an,selectionToggleBlockClasses:Nn,selectionToggleBlockStyle:Rn,selectionToggleWrapper:Cn,selectionTrim:Mn,selectionWrapTagWithAttribute:Tn,setLocale:s,stateRestore:Un,stateSave:Hn,stringCamelCaseConvert:Wn,stringHtmlStringIsEmpty:Gn,stringStripTags:jn,styleRestoreState:Kn,styleSwapState:qn,styleSwapWithWrapper:Vn,tableCanMergeCells:ni,tableCanSplitCells:ai,tableCellsInRange:ti,tableCreate:$n,tableDeleteColumn:Zn,tableDeleteRow:Yn,tableGetCellByIndex:ei,tableGetCellIndex:Jn,tableInsertColumn:Xn,tableInsertRow:Qn,tableMergeCells:oi,tableSplitCells:ri,templateConvertTokens:g,templateGet:f,templateGetVariables:m,typeIsArray:b,typeIsElement:T,typeIsNode:w,typeIsNumber:v,typeIsRange:li,typeIsSelection:ci,typeIsString:y,typeIsTextNode:C,undockFromElement:F,undockFromScreen:L}),window.Raptor=Mo,Mo.globalDefaults={layouts:{},plugins:{},ui:{},bind:{},namespace:null,unify:!0,persistence:!0,persistenceName:"uiEditor",unloadWarning:!0,autoEnable:!1,partialEdit:!1,autoSelect:"end",enablePlugins:!0,disabledPlugins:[],enableUi:!0,disabledUi:[],replace:!1,replaceStyle:["display","position","float","width","padding-left","padding-right","padding-top","padding-bottom","margin-left","margin-right","margin-top","margin-bottom"],baseClass:"raptor",cssPrefix:"cms-",draggable:!0},Mo.registerPreset({name:"full",plugins:{imageSwap:{chooser:"insertFile"}},layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","dockToElement","guides"],["viewSource"],["historyUndo","historyRedo"],["alignLeft","alignCenter","alignJustify","alignRight"],["textBold","textItalic","textUnderline","textStrike"],["textSuper","textSub"],["listUnordered","listOrdered"],["hrCreate","textBlockQuote"],["textSizeDecrease","textSizeIncrease","fontFamilyMenu"],["clearFormatting"],["linkCreate","linkRemove"],["embed","insertFile"],["floatLeft","floatNone","floatRight"],["colorMenuBasic"],["tagMenu"],["classMenu"],["snippetMenu","specialCharacters"],["tableCreate","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn"],["languageMenu"],["statistics"]]},hoverPanel:{uiOrder:[["clickButtonToEdit"]]},elementHoverPanel:{elements:"img",uiOrder:[["imageResize","imageSwap","close"]]}}},!0),Mo.registerPreset({name:"micro",layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","dockToElement"],["historyUndo","historyRedo"],["specialCharacters"],["languageMenu"],["statistics"]]},hoverPanel:{uiOrder:[["clickButtonToEdit","revisions"]]}},plugins:{placeholder:!1,paste:{panels:["plain-text"]},noBreak:{enabled:!0}}}),Mo.registerPreset({name:"inline",classes:"raptor-editing-inline",autoEnable:!0,draggable:!1,unify:!1,unloadWarning:!1,reloadOnDisable:!0,plugins:{unsavedEditWarning:!1,dock:{dockToElement:!0,docked:!0,persist:!1}},layouts:{toolbar:{uiOrder:[["textBold","textItalic","textUnderline","textStrike"],["colorMenuBasic"],["textBlockQuote"],["listOrdered","listUnordered"],["textSizeDecrease","textSizeIncrease"],["linkCreate","linkRemove"]]}}}),Mo.registerPreset({name:"mammoth",plugins:{imageSwap:{chooser:"fileManager"}},layouts:{toolbar:{uiOrder:[["logo"],["save","cancel"],["dockToScreen","guides"],["viewSource"],["historyUndo","historyRedo"],["alignLeft","alignCenter","alignJustify","alignRight"],["textBold","textItalic","textUnderline","textStrike"],["textSuper","textSub"],["listUnordered","listOrdered"],["hrCreate","textBlockQuote"],["textSizeDecrease","textSizeIncrease"],["clearFormatting"],["linkCreate","linkRemove"],["embed","fileManager"],["floatLeft","floatNone","floatRight"],["colorMenuBasic"],["tagMenu"],["classMenu"],["snippetMenu","specialCharacters","loremIpsum"],["tableCreate","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn"]]},hoverPanel:{uiOrder:[["clickButtonToEdit","revisions"]]},elementHoverPanel:{elements:"img",uiOrder:[["imageResize","imageSwap","imageEditor","close"]]},imageEditor:{uiOrder:[["save","cancel"],["revert","upload"],["undo","redo"],["flipV","flipH","rotateLeft","rotateRight","resize","crop"]]},fileManager:{uiOrder:[["insert","rename","edit","delete","download","view"]]}}},!0),Mo.registerPreset({name:"mammoth-inline",classes:"raptor-editing-inline",autoEnable:!0,draggable:!1,unify:!1,unloadWarning:!1,reloadOnDisable:!0,plugins:{unsavedEditWarning:!1,dock:{dockToElement:!0,docked:!0,persist:!1}},layouts:{toolbar:{uiOrder:[["viewSource","guides"],["historyUndo","historyRedo"],["alignLeft","alignCenter","alignJustify","alignRight"],["textBold","textItalic","textUnderline","textStrike"],["textSuper","textSub"],["listUnordered","listOrdered"],["hrCreate","textBlockQuote"],["textSizeDecrease","textSizeIncrease"],["clearFormatting"],["linkCreate","linkRemove"],["embed","fileManager"],["floatLeft","floatNone","floatRight"],["colorMenuBasic"],["tagMenu"],["classMenu"],["snippetMenu","specialCharacters"],["tableCreate","tableInsertRow","tableDeleteRow","tableInsertColumn","tableDeleteColumn"]]}}}),Mo.registerUi(new Li({name:"cancel",hotkey:"esc",dialogOptions:{width:500},action:function(){this.raptor.isDirty()?Li.prototype.action.call(this):this.applyAction()
},applyAction:function(){this.raptor.cancelEditing()},getDialogTemplate:function(){return No("<div>").html(c("cancelDialogContent"))}})),ji.prototype=Object.create(Ui.prototype),ji.prototype.init=function(){var e=Ui.prototype.init.call(this);return"object"==typeof this.options.classes&&Object.keys(this.options.classes).length>0?(this.raptor.bind("selectionChange",this.updateButton.bind(this)),e):void 0},ji.prototype.changeClass=function(e){Nn(e,[],this.raptor.getElement())},ji.prototype.menuItemClick=function(e){Ui.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeClass([No(e.currentTarget).data("value")])}.bind(this))},ji.prototype.menuItemMouseEnter=function(e){this.raptor.actionPreview(function(){this.changeClass([No(e.currentTarget).data("value")])}.bind(this))},ji.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},ji.prototype.updateButton=function(){},ji.prototype.getMenuItems=function(){var e="";for(var t in this.options.classes)e+=this.raptor.getTemplate("class-menu.item",{label:t,value:this.options.classes[t]});return e},Mo.registerUi(new ji),Mo.registerUi(new Oi({name:"clearFormatting",action:function(){An(this.raptor.getElement().get(0)),O(this.raptor.getElement(),["a","b","i","sub","sup","strong","em","big","small","p"]),I(this.raptor.getElement()[0],"p")}})),Mo.registerUi(new Ai({name:"clickButtonToEdit",action:function(){this.raptor.enableEditing()}})),Mo.registerUi(new Ai({name:"close",click:function(){this.layout.close()}})),Wi.prototype=Object.create(Ui.prototype),Wi.prototype.init=function(){return this.raptor.bind("selectionChange",this.updateButton.bind(this)),this.updateButton(),Ui.prototype.init.apply(this,arguments)},Wi.prototype.updateButton=function(){var e=gn()[0],t=this.getButton().getButton(),n=null,i=null;if(di(t,c("colorMenuBasicAutomatic")),hi(t,!1),e){e=No(e);for(var o=0;o<this.colors.length;o++)if(i=No(e).closest("."+this.options.cssPrefix+this.colors[o]),i.length){n=this.colors[o];break}return n?(di(t,c("colorMenuBasic"+(n.charAt(0).toUpperCase()+n.slice(1)))),hi(t,"ui-icon-swatch"),t.find(".ui-icon").css("background-color",i.css("color")),void 0):void 0}},Wi.prototype.changeColor=function(e,t){t&&(this.currentColor=e),this.raptor.actionApply(function(){if(In(),"automatic"===e)gn().parents("."+this.options.cssPrefix+"color").addBack().each(function(){var e=No(this).attr("class");if(null!==e&&"undefined"!=typeof e&&(e=e.match(/(cms-(.*?))( |$)/gi),null!==e&&"undefined"!=typeof e))for(var t=0,n=e.length;n>t;t++)No(this).removeClass(No.trim(e[t]))});else{var t=rt();Cn("span",{classes:this.options.cssPrefix+"color "+this.options.cssPrefix+e,attributes:{id:t}});var n=No("#"+t);if(n.length){sn(n.removeAttr("id").get(0));var i;do i=No("#"+t),i.removeAttr("id");while(i.length)}}}.bind(this))},Wi.prototype.menuItemMouseEnter=function(e){this.raptor.actionPreview(function(){this.changeColor(No(e.currentTarget).data("color"))}.bind(this))},Wi.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},Wi.prototype.menuItemClick=function(e){Ui.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeColor(No(e.currentTarget).data("color"),!0)}.bind(this))},Wi.prototype.getMenuItems=function(){return this.raptor.getTemplate("color-menu-basic.menu",this.options)},Mo.registerUi(new Wi),Gi.prototype=Object.create(_i.prototype),Gi.prototype.init=function(){var e;this.options.persist&&(e=this.raptor.persist("docked")),"undefined"==typeof e&&(e=this.options.docked),"undefined"==typeof e&&(e=!1),e&&(this.raptor.bind("toolbarReady",function(){e&&this.toggleState()}.bind(this)),this.raptor.bind("toolbarHide",function(){this.dockState&&this.dockState.spacer&&(this.dockState.spacer.addClass(this.options.baseClass+"-hidden"),this.dockState.spacer.removeClass(this.options.baseClass+"-visible"))}.bind(this)),this.raptor.bind("toolbarShow",function(){this.dockState&&this.dockState.spacer&&(this.dockState.spacer.removeClass(this.options.baseClass+"-hidden"),this.dockState.spacer.addClass(this.options.baseClass+"-visible"))}.bind(this)),this.raptor.bind("toolbarDestroy",function(){this.dockState&&this.dockState.spacer&&this.dockState.spacer.remove()}.bind(this)))},Gi.prototype.toggleState=function(){return this.options.dockToElement?this.toggleDockToElement():this.toggleDockToScreen()},Gi.prototype.toggleDockToElement=function(){this.dockState?"undefined"!=typeof this.dockState.dockedTo?this.undockFromElement():(this.undockFromScreen(),this.dockToElement()):this.dockToElement()},Gi.prototype.dockToElement=function(){var e=this.raptor.getElement(),t=this.raptor.getLayout("toolbar").getElement();this.marker=No("<marker>").addClass(this.options.baseClass+"-marker").insertAfter(t),this.raptor.getLayout("toolbar").getElement().addClass(this.options.baseClass+"-docked-to-element"),this.dockState=z(this.raptor.getLayout("toolbar").getElement(),e,{position:this.options.position,spacer:!1,wrapperClass:this.options.baseClass+"-inline-wrapper"}),this.activateButton(this.raptor.getPlugin("dockToElement"))},Gi.prototype.undockFromElement=function(){this.marker.replaceWith(F(this.dockState)),this.dockState=null,this.raptor.getLayout("toolbar").getElement().removeClass(this.options.baseClass+"-docked-to-element"),this.deactivateButton(this.raptor.getPlugin("dockToElement"))},Gi.prototype.toggleDockToScreen=function(){this.dockState?"undefined"!=typeof this.dockState.dockedTo?(this.undockFromElement(),this.dockToScreen()):this.undockFromScreen():this.dockToScreen()},Gi.prototype.dockToScreen=function(){if(!this.dockState){var e=this.raptor.getLayout("toolbar");if(e.isReady()){this.raptor.persist("docked",!0);var t=e.getElement();this.marker=No("<marker>").addClass(this.options.baseClass+"-marker").insertAfter(t),t.addClass(this.options.baseClass+"-docked"),e.disableDragging(),this.dockState=B(t,{position:this.options.position,spacer:!0,under:this.options.under}),e.isVisible()||(this.dockState.spacer.removeClass(this.options.baseClass+"-visible"),this.dockState.spacer.addClass(this.options.baseClass+"-hidden")),this.activateButton(this.raptor.getPlugin("dockToScreen"))}}},Gi.prototype.undockFromScreen=function(){if(this.dockState){this.raptor.persist("docked",!1);var e=this.raptor.getLayout("toolbar"),t=L(this.dockState);this.marker.replaceWith(t),e.enableDragging(),e.constrainPosition(),this.dockState=null,t.removeClass(this.options.baseClass+"-docked"),this.deactivateButton(this.raptor.getPlugin("dockToScreen"))}},Gi.prototype.deactivateButton=function(e){"undefined"!=typeof e&&"undefined"!=typeof e.button&&vi(e.button)},Gi.prototype.activateButton=function(e){"undefined"!=typeof e&&"undefined"!=typeof e.button&&mi(e.button)},Mo.registerPlugin(new Gi),Mo.registerUi(new Ai({name:"dockToScreen",action:function(){this.raptor.unify(function(e){e.plugins.dock.toggleDockToScreen()})}})),Mo.registerUi(new Ai({name:"dockToElement",action:function(){this.raptor.unify(function(e){e.plugins.dock.toggleDockToElement()})}})),Mo.registerUi(new Li({name:"embed",state:null,dialogOptions:{width:600,height:400},applyAction:function(e){this.raptor.actionApply(function(){rn(e.find("textarea").val())})},getDialogTemplate:function(){var e=No("<div>").html(this.raptor.getTemplate("embed.dialog",this.options));e.find("textarea").change(function(t){e.find("."+this.options.baseClass+"-preview").html(No(t.target).val())}.bind(this));var t=e.find("."+this.options.baseClass+"-panel-tabs");return t.find("li").click(function(){t.find("ul li").removeClass("ui-state-active").removeClass("ui-tabs-selected"),No(this).addClass("ui-state-active").addClass("ui-tabs-selected"),t.children("div").hide().eq(No(this).index()).show()}),e}})),Mo.registerUi(new Mi({name:"floatLeft",applyToElement:function(e){e.removeClass(this.options.cssPrefix+"float-right"),e.toggleClass(this.options.cssPrefix+"float-left"),D(e,["class"])},getElement:function(e){var t=No(e.commonAncestorContainer).find("img");return t.length?t:null}})),Mo.registerUi(new Mi({name:"floatNone",applyToElement:function(e){e.removeClass(this.options.cssPrefix+"float-right"),e.removeClass(this.options.cssPrefix+"float-left"),D(e,["class"])},getElement:function(e){var t=No(e.commonAncestorContainer).find("img");return t.length?t:null}})),Mo.registerUi(new Mi({name:"floatRight",applyToElement:function(e){e.removeClass(this.options.cssPrefix+"float-left"),e.toggleClass(this.options.cssPrefix+"float-right"),D(e,["class"])},getElement:function(e){var t=No(e.commonAncestorContainer).find("img");return t.length?t:null}})),qi.prototype=Object.create(Ui.prototype),qi.prototype.init=function(){return this.raptor.bind("selectionChange",this.updateButton.bind(this)),this.updateButton(),Ui.prototype.init.apply(this,arguments)},qi.prototype.updateButton=function(){var e=gn()[0],t=this.getButton().getButton(),n=null,i=null;if(di(t,c("fontFamilyMenuFontDefault")),hi(t,!1),e){for(var o=0;o<this.options.fonts.length;o++)if(i=No(e).closest("."+this.options.cssPrefix+"font-"+this.options.fonts[o]),i.length){n=this.options.fonts[o];break}return n?(di(t,this.getMenu().find('[data-font="'+n+'"]').text()),void 0):void 0}},qi.prototype.changeFont=function(e){if(In(),"default"===e)gn().parents("."+this.options.cssPrefix+"font").addBack().each(function(){var e=No(this).attr("class");if(null!==e&&"undefined"!=typeof e&&(e=e.match(/(cms-font-(.*?))( |$)/gi),null!==e&&"undefined"!=typeof e))for(var t=0,n=e.length;n>t;t++)No(this).removeClass(No.trim(e[t]))});else{var t=rt();Cn("span",{classes:this.options.classes||this.options.cssPrefix+"font "+this.options.cssPrefix+"font-"+e,attributes:{id:t}});var n=No("#"+t);if(n.length){sn(n.removeAttr("id").get(0));var i;do i=No("#"+t),i.removeAttr("id");while(i.length)}}},qi.prototype.menuItemMouseEnter=function(e){this.raptor.actionPreview(function(){this.changeFont(No(e.currentTarget).data("font"))}.bind(this))},qi.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},qi.prototype.menuItemClick=function(e){Ui.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeFont(No(e.currentTarget).data("font"))}.bind(this))},qi.prototype.getMenuItems=function(){for(var e=this.raptor.getTemplate("font-family.menu-item",{fontName:"default",fontTitle:c("fontFamilyMenuFontDefault")}),t=0,n=this.options.fonts.length;n>t;t++)e+=this.raptor.getTemplate("font-family.menu-item",{fontName:this.options.fonts[t],fontTitle:c(("fontFamilyMenuFont-"+this.options.fonts[t]).replace(/-([a-z])/g,function(e){return e[1].toUpperCase()}))});return e},Mo.registerUi(new qi),Mo.registerUi(new Oi({name:"guides",action:function(){this.raptor.getElement().toggleClass(this.getClassName()),this.updateButtonState()},updateButtonState:function(){this.raptor.getElement().hasClass(this.getClassName())?mi(this.button):vi(this.button)},init:function(){return this.raptor.bind("cancel",this.removeClass.bind(this)),this.raptor.bind("saved",this.removeClass.bind(this)),Oi.prototype.init.call(this)},removeClass:function(){this.raptor.getElement().removeClass(this.getClassName())},getClassName:function(){return this.options.baseClass+"-visible"},mouseEnter:function(){Oi.prototype.mouseEnter.call(this),this.updateButtonState()},mouseLeave:function(){Oi.prototype.mouseLeave.call(this),this.updateButtonState()}})),Mo.registerUi(new Ai({name:"historyRedo",hotkey:["ctrl+y","ctrl+shift+z"],action:function(){this.raptor.historyForward()},init:function(){return this.raptor.bind("historyChange",this.historyChange.bind(this)),Ai.prototype.init.apply(this,arguments),gi(this.button),this.button},historyChange:function(){this.raptor.present<this.raptor.history.length-1?pi(this.button):gi(this.button)}})),Mo.registerUi(new Ai({name:"historyUndo",hotkey:"ctrl+z",action:function(){this.raptor.historyBack()},init:function(){return this.raptor.bind("historyChange",this.historyChange.bind(this)),Ai.prototype.init.apply(this,arguments),gi(this.button),this.button},historyChange:function(){0===this.raptor.present?gi(this.button):pi(this.button)}})),Mo.registerUi(new Oi({name:"hrCreate",action:function(){rn("<hr/>")}})),Mo.registerUi(new Li({name:"imageResize",proportional:!0,image:null,dialogOptions:{width:450},action:function(){var e=this.getDialog();this.image=u(this.layout.target),this.originalWidth=this.layout.target.width,this.originalHeight=this.layout.target.height,e.find("[name=width]").val(this.layout.target.width),e.find("[name=height]").val(this.layout.target.height),this.openDialog()},applyAction:function(){var e=this.getDialog(),t=e.find("[name=width]").val(),n=e.find("[name=height]").val();this.raptor.actionApply(function(){No("#"+this.image).css({width:t,height:n}).attr("width",t).attr("height",n),ln(No("#"+this.image)[0])}.bind(this))},getDialogTemplate:function(){var e=No("<div>").html(this.raptor.getTemplate("image-resize.dialog",this.options)),t=this;e.find("."+this.options.baseClass+"-lock-proportions").hover(function(){No(this).addClass("ui-state-hover")},function(){No(this).removeClass("ui-state-hover")}).click(function(){zo[t.name].instance.proportional=!zo[t.name].instance.proportional,No(this).find(".ui-icon").toggleClass("ui-icon-locked",t.proportional).toggleClass("ui-icon-unlocked",!t.proportional)});var n=e.find("[name=width]"),i=e.find("[name=height]");return n.on("input.raptor",function(){var e=parseInt(No(this).val());isNaN(e)||zo[t.name].instance.proportional&&i.val(Math.round(Math.abs(zo[t.name].instance.originalHeight/zo[t.name].instance.originalWidth*e)))}),i.on("input.raptor",function(){var e=parseInt(No(this).val());isNaN(e)||zo[t.name].instance.proportional&&n.val(Math.round(Math.abs(zo[t.name].instance.originalWidth/zo[t.name].instance.originalHeight*e)))}),e}})),Mo.registerUi(new Ai({name:"imageSwap",chooser:null,click:function(){ln(this.layout.target),this.raptor.getPlugin(this.options.chooser).action(this.layout.target)}})),Mo.registerUi(new Li({name:"insertFile",state:!1,imageTypes:["jpeg","jpg","png","gif"],options:{customAction:!1},action:function(e){return this.options.customAction&&this.options.customAction.call(this,e)!==!1?void 0:("undefined"!=typeof e?(this.getDialog().find("[name=location]").val(e.getAttribute("src")||e.getAttribute("href")),this.getDialog().find("[name=name]").val(e.innerHTML)):(this.getDialog().find("[name=location]").val(""),this.getDialog().find("[name=name]").val("")),this.openDialog())},applyAction:function(){var e=this.getDialog(),t=e.find("[name=location]").val(),n=e.find("[name=name]").val();this.raptor.actionApply(function(){this.insertFiles([{location:t,name:n}])}.bind(this))},getDialogTemplate:function(){return No(this.raptor.getTemplate("insert-file.dialog"))},getFileType:function(e){if("undefined"!=typeof e.extension)return e.extension.toLowerCase();var t=e.location.split(".");return t.length>0?t.pop().toLowerCase():"unknown"},isImage:function(e){return-1!==No.inArray(this.getFileType(e),this.imageTypes)},insertFiles:function(e){this.raptor.resume(),e.length&&this.raptor.actionApply(function(){1===e.length?this.isImage(e[0])&&No(pn()).is("img")||wn()?this.replaceFiles(e):this.linkFiles(e):this.linkFiles(e)}.bind(this))},linkFiles:function(e){Pn("a",this.raptor.getElement()),Mn();var t=rangy.createApplier({tag:"a",attributes:{href:e[0].location.replace(/([^:])\/\//g,"$1/"),title:e[0].name,"class":this.options.cssPrefix+"file "+this.options.cssPrefix+this.getFileType(e[0])}});t.applyToSelection()},replaceFiles:function(e){for(var t=[],n=0;n<e.length;n++)t.push(this.prepareElement(e[n]));rn(t.join(", "))},prepareElement:function(e,t){return this.isImage(e)?this.prepareImage(e,this.options.cssPrefix+this.getFileType(e),t):this.prepareAnchor(e,this.options.cssPrefix+"file "+this.options.cssPrefix+this.getFileType(e),t)},prepareImage:function(e,t,n){return No("<div/>").html(No("<img/>").attr({src:e.location.replace(/([^:])\/\//g,"$1/"),title:n||e.name,"class":t})).html()},prepareAnchor:function(e,t,n){return No("<div/>").html(No("<a/>").attr({href:e.location.replace(/([^:])\/\//g,"$1/"),title:e.name,"class":t}).html(n||e.name)).html()}})),Vi.prototype=Object.create(Ui.prototype),Vi.prototype.init=function(){var e=Hi.prototype.init.call(this);return di(this.button.button,wo[vo]),hi(this.button.button,"ui-icon-flag-"+vo.toLowerCase()),e},Vi.prototype.menuItemClick=function(e){var t=No(e.currentTarget).data("value");this.options.persist&&Mo.persist("locale",t),setTimeout(function(){s(t)},1)},Vi.prototype.getMenuItems=function(){var e="";for(var t in bo)e+=this.raptor.getTemplate("language-menu.item",{label:wo[t],value:t,icon:t.toLowerCase()});return e},Mo.registerUi(new Vi);var Fo,Ho,Uo,jo;Mo.registerUi(new zi({name:"linkCreate",dialogOptions:{width:850},applyAction:function(){this.raptor.actionApply(function(){In(),Pn("a",this.raptor.getElement()),Mn();var e=rangy.createApplier({tag:"a",attributes:jo});jo!==!1&&""!==No.trim(jo.href)&&(e.applyToSelection(),O(this.raptor.getElement(),["a"]))}.bind(this))},openDialog:function(){var e=fn();if(e.is("a"))for(var t=0,n=Ho.length;n>t;t++){var i=Ho[t].updateInputs(e,Uo.children("div:eq("+t+")"));i&&Fo.find(":radio:eq("+t+")").trigger("click")}zi.prototype.openDialog.call(this)},validateDialog:function(){var e=Fo.find(":radio:checked").val();return jo=Ho[e].getAttributes(Uo.children("div:eq("+e+")")),jo!==!1},selectionToggle:function(){var e=fn();return e?e.closest("a").length?!0:!1:!1},getDialogTemplate:function(){var e=No(this.raptor.getTemplate("link.dialog",this.options));Fo=e.find("[data-menu]"),Uo=e.find("[data-content]"),Ho=[new Zi(this.raptor),new Xi(this.raptor),new Ki(this.raptor),new $i(this.raptor)];for(var t=0,n=Ho.length;n>t;t++)No(this.raptor.getTemplate("link.label",Ho[t])).click(function(){Uo.children("div").hide(),Uo.children("div:eq("+No(this).index()+")").show()}).find(":radio").val(t).end().appendTo(Fo),No("<div>").append(Ho[t].getContent()).hide().appendTo(Uo);return Fo.find(":radio:first").prop("checked",!0),Uo.children("div:first").show(),e}})),Mo.registerUi(new Pi({name:"linkRemove",disable:!0,action:function(){this.raptor.actionApply(function(){var e=rangy.createApplier({tag:"a"});In(),this.raptor.selectionConstrain(),e.undoToSelection(),O(this.raptor.getElement(),["a"])}.bind(this))},selectionToggle:function(){var e=fn();return e?e.closest("a").length?!0:!1:!1}})),Ki.prototype=Object.create(Xi.prototype),Ki.prototype.getContent=function(){return this.raptor.getTemplate("link.document",this.raptor.options)},$i.prototype.getContent=function(){return this.raptor.getTemplate("link.email",this.raptor.options)},$i.prototype.getAttributes=function(e){var t=e.find("[name=email]").val(),n=e.find("[name=subject]").val();return No.trim(n)&&(n="?Subject="+encodeURIComponent(n)),""===No.trim(t)?!1:{href:"mailto:"+t+n}},$i.prototype.updateInputs=function(e,t){var n=!1;if(email="",subject="",href=e.attr("href"),0===href.indexOf("mailto:")){var i=href.indexOf("?Subject=");i>0?(email=href.substring(7,i),subject=href.substring(i+9)):(email=href.substring(7),subject=""),n=!0}return t.find("[name=email]").val(email),t.find("[name=subject]").val(subject),n},Xi.prototype.getContent=function(){return this.raptor.getTemplate("link.external",this.raptor.options)},Xi.prototype.getAttributes=function(e){var t=e.find("[name=location]").val(),n=e.find("[name=blank]").is(":checked"),i={href:t};return n&&(i.target="_blank"),"http://"===No.trim(i.href)?!1:i},Xi.prototype.updateInputs=function(e,t){var n=!1,i=e.attr("href");return 0===i.indexOf("http://")?(t.find("[name=location]").val(i),n=!0):t.find("[name=location]").val("http://"),"_blank"===e.attr("target")?t.find("[name=blank]").prop("checked",!0):t.find("[name=blank]").prop("checked",!1),n},Zi.prototype.getContent=function(){return this.raptor.getTemplate("link.internal",{baseClass:this.raptor.options.baseClass,domain:window.location.protocol+"//"+window.location.host})},Zi.prototype.getAttributes=function(e){var t=e.find("[name=location]").val(),n=e.find("[name=blank]").is(":checked"),i={href:t};return n&&(i.target="_blank"),i},Zi.prototype.updateInputs=function(e,t){var n=e.attr("href");return-1===n.indexOf("http://")&&-1===n.indexOf("mailto:")?t.find("[name=location]").val(n):t.find("[name=location]").val(""),"_blank"===e.attr("target")?t.find("[name=blank]").prop("checked",!0):t.find("[name=blank]").prop("checked",!1),!1},Mo.registerUi(new Pi({name:"listOrdered",init:function(){var e=Pi.prototype.init.apply(this,arguments);return $(this.raptor.getElement(),So)?e:void 0},action:function(){dt("ol","li",this.raptor.getElement())},selectionToggle:function(){var e=rangy.getSelection();return e.getAllRanges().length>0&&gn(e).closest("ol").length}})),Mo.registerUi(new Pi({name:"listUnordered",init:function(){var e=Pi.prototype.init.apply(this,arguments);return $(this.raptor.getElement(),So)?e:void 0},action:function(){dt("ul","li",this.raptor.getElement())},selectionToggle:function(){var e=rangy.getSelection();return e.getAllRanges().length>0&&gn(e).closest("ul").length}})),Mo.registerUi(new Ai({name:"logo",init:function(){var e=Ai.prototype.init.apply(this,arguments);return e.find(".ui-button-icon-primary").css({"background-image":"url(//www.raptor-editor.com/logo/VERSION?json="+encodeURIComponent(JSON.stringify(this.raptor.options))+")"}),e},action:function(){window.open("http://www.raptor-editor.com/about/VERSION","_blank")}})),Qi.prototype=Object.create(_i.prototype),Qi.prototype.init=function(){this.raptor.getElement().on("keypress.raptor",this.preventReturn.bind(this)),this.raptor.getElement().on("drop.raptor",this.preventDrop.bind(this))},Qi.prototype.preventReturn=function(e){return this.options.enabled&&13===e.which?!1:void 0},Qi.prototype.preventDrop=function(){return this.options.enabled},Mo.registerPlugin(new Qi),Yi.prototype=Object.create(_i.prototype),Yi.prototype.init=function(){this.raptor.registerHotkey("return",this.returnPressed.bind(this)),this.raptor.registerHotkey("shift+return",this.shiftReturnPressed.bind(this))},Yi.prototype.returnPressedList=function(e){var t=e.closest("li");if(!t.length)return!1;var n=t.closest("ul, ol"),i=n.get(0).tagName.toLowerCase(),o=!1;if(nt(t)){var a=t.next();a.length&&a.is("li")?(o=_t(i,"li",this.raptor.getElement(),"<p>&nbsp;</p>"),o&&sn(o.get(0))):(t.remove(),sn(No("<p>&nbsp;</p>").insertAfter(n).get(0)))}else o=Rt(i,"li",this.raptor.getElement()),o&&dn(o.get(0));return!0},Yi.prototype.returnPressed=function(){var e=fn();return this.returnPressedList(e)?!0:!1},Yi.prototype.shiftReturnPressedList=function(e){if(e.closest("li").length){var t=e.closest("ul, ol").get(0).tagName.toLowerCase(),n=_t(t,"li",this.raptor.getElement(),"<p>&nbsp;</p>");return n&&sn(n.get(0)),!0}return!1},Yi.prototype.shiftReturnPressed=function(){var e=fn();return this.shiftReturnPressedList(e)?!0:!1},Mo.registerPlugin(new Yi);var Wo=!1,Go=null,qo=null,Vo=null;Ji.prototype=Object.create(_i.prototype),Ji.prototype.enable=function(){this.raptor.getElement().on("paste.raptor",this.capturePaste.bind(this))},Ji.prototype.capturePaste=function(){return Vo?void 0:Wo?!1:(Jt(),Wo=!0,No(".raptorPasteBin").remove(),No('<div class="raptorPasteBin" contenteditable="true" style="width: 1px; height: 1px; overflow: hidden; position: fixed; top: -1px;" />').appendTo("body"),No(".raptorPasteBin").focus(),window.setTimeout(this.showPasteDialog.bind(this),0),!0)},Ji.prototype.showPasteDialog=function(){wi(this.getDialog(this))},Ji.prototype.pasteContent=function(e){this.raptor.actionApply(function(){var t=rt();en(),e=this.filterAttributes(e),e=this.filterChars(e),rn(No('<placeholder id="'+t+'">'+e+"</placeholder>")),No(".raptorPasteBin").remove();var n=No("#"+t);sn(n.get(0)),Jt(),n.contents().unwrap(),en()}.bind(this))},Ji.prototype.getDialog=function(e){if(qo=e,!Go){Go=No("<div>").html(this.raptor.getTemplate("paste.dialog",this.options));for(var t=0,n=this.options.panels.length;n>t;t++)Go.find("."+this.options.baseClass+"-tab-"+this.options.panels[t]).css("display",""),0===t&&Go.find("."+this.options.baseClass+"-content-"+this.options.panels[t]).css("display","");Go.find("."+this.options.baseClass+"-panel-tabs > div:visible:not(:first)").hide(),bi(Go,{modal:!0,resizable:!0,autoOpen:!1,width:800,height:500,title:c("pasteDialogTitle"),dialogClass:this.options.baseClass+"-dialog",close:function(){Wo=!1},buttons:[{text:c("pasteDialogOKButton"),click:function(){var e=null,t=Go.find("."+this.options.baseClass+"-area:visible");e=t.hasClass(this.options.baseClass+"-plain")||t.hasClass(this.options.baseClass+"-source")?t.val():t.html(),Ci(Go),qo.pasteContent(e)}.bind(this),icons:{primary:"ui-icon-circle-check"}},{text:c("pasteDialogCancelButton"),click:function(){tn(),No(".raptorPasteBin").remove(),Ci(Go)},icons:{primary:"ui-icon-circle-close"}}]});var i=Go.find("."+this.options.baseClass+"-panel-tabs");i.find("li").click(function(){i.find("ul li").removeClass("ui-state-active").removeClass("ui-tabs-selected"),No(this).addClass("ui-state-active").addClass("ui-tabs-selected"),i.children("div").hide().eq(No(this).index()).show()})}return this.updateAreas(),Go},Ji.prototype.filterAttributes=function(e){var t=[{regexp:/(<meta\s*[^>]*\s*>)|(<\s*link\s* href="file:[^>]*\s*>)|(<\/?\s*\w+:[^>]*\s*>)/gi,handler:""},{regexp:/(class="Mso[^"]*")|(<!--(.|\s){1,}?-->)/gi,handler:""},{regexp:/(class="Apple-(style|converted)-[a-z]+\s?[^"]+")/,handle:""},{regexp:/id="internal-source-marker_[^"]+"|dir="[rtl]{3}"/,handle:""},{regexp:/(<p[^>]*>\s*(\&nbsp;|\u00A0)*\s*<\/p[^>]*>)|(<p[^>]*>\s*<font[^>]*>\s*(\&nbsp;|\u00A0)*\s*<\/\s*font\s*>\s<\/p[^>]*>)/gi,handler:""},{regexp:/(style="[^"]*mso-[^;][^"]*")|(style="margin:\s*[^;"]*;")/gi,handler:""},{regexp:/(?:<style([^>]*)>([\s\S]*?)<\/style>|<link\s+(?=[^>]*rel=['"]?stylesheet)([^>]*?href=(['"])([^>]*?)\4[^>\/]*)\/?>)/gi,handler:""},{regexp:/(<\s*script[^>]*>((.|\s)*?)<\\?\/\s*script\s*>)|(<\s*script\b([^<>]|\s)*>?)|(<[^>]*=(\s|)*[("|')]javascript:[^$1][(\s|.)]*[$1][^>]*>)/gi,handler:""}];return No.each(t,function(t,n){e=e.replace(n.regexp,n.handler)}),e},Ji.prototype.filterChars=function(e){var t=e;return t=t.replace(/[\u2018|\u2019|\u201A]/g,"'"),t=t.replace(/[\u201C|\u201D|\u201E]/g,'"'),t=t.replace(/\u2026/g,"..."),t=t.replace(/[\u2013|\u2014]/g,"-"),t=t.replace(/\u02C6/g,"^"),t=t.replace(/\u2039/g,"<"),t=t.replace(/\u203A/g,">"),t=t.replace(/[\u02DC|\u00A0]/g," ")},Ji.prototype.stripAttributes=function(e){e=No("<div/>").html(e);var t=this.options.allowedAttributes;return No(e.find("*")).each(function(){var e=[];No.each(this.attributes,function(n,i){-1===No.inArray(i.nodeName,t)&&e.push(i.nodeName)});for(var n=0;n<e.length;n++)No(this).attr(e[n],null)}),e.html()},Ji.prototype.stripEmpty=function(e){var t=No("<div/>").html(e),n=this.options.allowedEmptyTags;return t.find("*").filter(function(){return-1!==No.inArray(this.tagName.toLowerCase(),n)?!1:No(this).find(n.join(",")).length?!1:""===No.trim(No(this).text())}).remove(),t.html()},Ji.prototype.stripSpans=function(e){var t=No("<div/>").html(e);return t.find("span").each(function(){this.attributes.length||No(this).replaceWith(No(this).html())}),t.html()},Ji.prototype.updateAreas=function(){var e=No(".raptorPasteBin").html();e=this.filterAttributes(e),e=this.filterChars(e),e=this.stripEmpty(e),e=this.stripAttributes(e),e=this.stripSpans(e),e=jn(e,this.options.allowedTags);var t=No("<div/>").html(No(".raptorPasteBin").html()).text(),n=No(".raptorPasteBin").html();Go.find("."+this.options.baseClass+"-plain").val(No("<div/>").html(t).text()),Go.find("."+this.options.baseClass+"-rich").html(e),Go.find("."+this.options.baseClass+"-source").html(n),Go.find("."+this.options.baseClass+"-markup").html(e)},No(document).on("keyup.raptor keydown.raptor",function(e){Vo=e.shiftKey}),Mo.registerPlugin(new Ji),eo.prototype=Object.create(_i.prototype),eo.prototype.init=function(){this.raptor.bind("enabled",this.enabled.bind(this)),this.raptor.bind("change",this.check.bind(this))},eo.prototype.enabled=function(){this.check(this.raptor.getHtml())},eo.prototype.check=function(e){if(e=e.trim(),!e||"<br>"===e||"<div><br></div>"===e){var t=this.raptor.getNode(),n=document.createElement(this.options.tag);n.innerHTML=this.options.content,t.innerHTML="",t.appendChild(n),this.options.select&&sn(t.childNodes[0]),this.raptor.checkChange()}},Mo.registerPlugin(new eo),Mo.registerUi(new Ai({name:"save",action:function(){this.getPlugin()?this.getPlugin().save():Ei({text:c("saveNotConfigured"),type:"error"})},init:function(){if(null!==this.options.plugin){var e=Ai.prototype.init.apply(this,arguments);return this.raptor.bind("dirty",this.dirty.bind(this)),this.raptor.bind("cleaned",this.clean.bind(this)),this.clean(),e}},getPlugin:function(){return this.raptor.getPlugin(this.options.plugin)},dirty:function(){pi(this.button)},clean:function(){gi(this.button)}})),to.prototype=Object.create(_i.prototype),Mo.registerPlugin(new to),to.prototype.save=function(e){"undefined"!=typeof RaptorSection&&e!==!1&&RaptorSection.save(!1);var t={};this.raptor.unify(function(e){if(e.isDirty()){e.clean();var n=e.getPlugin("saveJson"),i=n.options.id.call(n),o=e.getHtml();t[i]=o}}.bind(this));var n={};this.size=Object.keys(t).length,n[this.options.postName]=JSON.stringify(t),No.ajax({type:this.options.type||"post",dataType:this.options.dataType||"json",url:this.options.url,data:n}).done(this.done.bind(this)).fail(this.fail.bind(this))},to.prototype.done=function(e,t,n){this.raptor.unify(function(i){i.isDirty()&&i.saved([e,t,n])});var i=c("saveJsonSaved",{saved:this.size});No.isFunction(this.options.formatResponse)&&(i=this.options.formatResponse(e)),Ei({text:i,type:"success"}),this.options.retain||this.raptor.unify(function(e){e.disableEditing()})},to.prototype.fail=function(){Ei({text:c("saveJsonFail",{failed:this.size}),type:"error"})},no.prototype=Object.create(_i.prototype),no.prototype.save=function(){this.requests=0,this.errors=[],this.messages=[],this.raptor.unify(function(e){if(e.isDirty()){this.requests++;var t=e.getPlugin("saveRest").sendRequest();t.raptor=e,t.done(this.done.bind(this)).fail(this.fail.bind(this)).always(this.always.bind(this))}}.bind(this))},no.prototype.done=function(e,t,n){n.raptor.saved(),this.messages.push(e)},no.prototype.fail=function(e){this.errors.push(e.responseText)},no.prototype.always=function(){this.requests--,0===this.requests&&(this.errors.length>0&&0===this.messages.length?Ei({text:c("saveRestFail",{failed:this.errors.length}),type:"error"}):this.errors.length>0?Ei({text:c("saveRestPartial",{saved:this.messages.length,failed:this.errors.length}),type:"error"}):(Ei({text:c("saveRestSaved",{saved:this.messages.length}),type:"success"}),this.options.retain||this.raptor.unify(function(e){e.disableEditing()})))},no.prototype.sendRequest=function(){var e=this.raptor.getPlugin("saveRest").getHeaders(),t=this.raptor.getPlugin("saveRest").getData(),n=this.raptor.getPlugin("saveRest").getURL();return No.ajax({type:this.options.type||"post",dataType:this.options.dataType||"json",headers:e,data:t,url:n})},no.prototype.getHeaders=function(){return this.options.headers?this.options.headers.call(this):{}},no.prototype.getData=function(){this.raptor.clean();var e=this.raptor.getHtml(),t=this.options.data.call(this,e);return t._method=this.method,t},no.prototype.getURL=function(){return"string"==typeof this.options.url?this.options.url:this.options.url.call(this)},Mo.registerPlugin(new no),io.prototype=Object.create(Ui.prototype),io.prototype.init=function(){var e=Ui.prototype.init.call(this);return"undefined"!=typeof this.options.snippets&&Object.keys(this.options.snippets).length>0?e:void 0},io.prototype.insertSnippet=function(e){rn(this.options.snippets[e])},io.prototype.menuItemMouseDown=function(e){this.raptor.actionApply(function(){this.insertSnippet(No(e.currentTarget).data("name"))}.bind(this))},io.prototype.menuItemMouseEnter=function(e){this.raptor.actionPreview(function(){this.insertSnippet(No(e.currentTarget).data("name"))}.bind(this))
},io.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},io.prototype.getMenuItems=function(){var e="";for(var t in this.options.snippets)e+=this.raptor.getTemplate("snippet-menu.item",{name:t});return e},Mo.registerUi(new io);var Ko=!1;Mo.registerUi(new Li({name:"specialCharacters",dialogOptions:{width:645},options:{setOrder:["symbols","mathematics","arrows","greekAlphabet"],characterSets:{symbols:{name:c("specialCharactersSymbols"),characters:[["<","&lt;","less than"],[">","&gt;","greater than"],["&","&amp;","ampersand"],['"',"&quot;","quotation mark"],["&nbsp;","non-breaking space: ' '"],["&emsp;","em space: '  '"],["&ensp;","en space: ' '"],["&thinsp;","thin space: ''"],["&mdash;","em dash"],["&ndash;","en dash"],["&minus;","minus"],["-","hyphen"],["&oline;","overbar space"],["&cent;","cent"],["&pound;","pound"],["&euro;","euro"],["&sect;","section"],["&dagger;","dagger"],["&Dagger;","double dagger"],["&lsquo;","left single quotes"],["&rsquo;","right single quotes"],["'","single quotes"],["&#x263a;","smiley face"],["&#x2605;","black star"],["&#x2606;","white star"],["&#x2610;","check box"],["&middot;","middle dot"],["&bull;","bullet"],["&copy;","copyright"],["&reg;","registered"],["&trade;","trade"],["&iquest;","inverted question mark"],["&iexcl;","inverted exclamation mark"],["&Aring;","Angstrm"],["&hellip;","ellipsis"],["&#x2295;","earth"],["&#x2299;","sun"],["&#x2640;","female"],["&#x2642;","male"],["&clubs;","clubs or shamrock"],["&spades;","spades"],["&hearts;","hearts or valentine"],["&diams;","diamonds"],["&loz;","diamond"]]},mathematics:{name:c("specialCharactersMathematics"),characters:[["&lt;","less than"],["&le;","less than or equal to"],["&gt;","greater than"],["&ge;","greater than or equal to"],["&ne;","not equal"],["&asymp;","approximately equal to"],["&equiv;","identically equal to"],["&cong;","congruent to"],["&prop;","proportional"],["&there4;","therefore"],["&sum;","summation"],["&prod;","product"],["&prime;","prime or minutes"],["&Prime;","double prime or seconds"],["&Delta;","delta"],["&nabla;","del"],["&part;","partial"],["&int;","integral"],["&middot;","middle dot"],["&sdot;","dot operator"],["&bull;","bullet"],["&minus;","minus sign"],["&times;","multipllcation sign"],["&divide;","division sign"],["&frasl;","fraction slash, (ordinary / \\)"],["&plusmn;","plus or minus"],["&deg;","degree sign"],["&lfloor;","floor function"],["&rfloor;","floor function"],["&lceil;","ceiling function"],["&rceil;","ceiling function"],["&lowast;","asterisk operator, (ordinary *)"],["&oplus;","circled plus"],["&otimes;","circled times"],["&ordm;","masculine ordinal"],["&lang;","bra"],["&rang;","ket"],["&infin;","infinity"],["&pi;","pi"],["&frac12;","half"],["&alefsym;","aleph"],["&radic;","radical"],["&ang;","angle"],["&perp;","perpendicular"],["&real;","real"],["&isin;","is an element of"],["&notin;","not an element of"],["&empty;","null set"],["&sub;","subset of"],["&sube;","subset or or equal to"],["&nsub;","not a subset"],["&cap;","intersection"],["&cup;","union"],["&sim;","tilde operator (ordinary ~)"],["&Oslash;","slash O"],["&and;","logical and"],["&Lambda;","lambda (and)"],["&or;","logical or"],["&not;","not sign"],["&sim;","tilde operator (ordinary ~)"],["&rarr;","right arrow"],["&rArr;","double right arrow"],["&larr;","left arrow"],["&lArr;","left double arrow"],["&harr;","left right arrow"],["&hArr;","left right double arrow"]]},arrows:{name:c("specialCharactersArrows"),characters:[["&darr;","down arrow"],["&dArr;","down double arrow"],["&uarr;","up arrow"],["&uArr;","up double arrow"],["&crarr;","arriage return arrow"],["&rarr;","right arrow"],["&rArr;","double right arrow"],["&larr;","left arrow"],["&lArr;","left double arrow"],["&harr;","left right arrow"],["&hArr;","left right double arrow"]]},greekAlphabet:{name:c("specialCharactersGreekAlphabet"),characters:[["&alpha;","alpha"],["&beta;","beta"],["&gamma;","gamma"],["&delta;","delta"],["&epsilon;","epsilon"],["&zeta;","zeta"],["&eta;","eta"],["&theta;","theta"],["&iota;","iota"],["&kappa;","kappa"],["&lambda;","lambda"],["&mu;","mu"],["&nu;","nu"],["&xi;","xi"],["&omicron;","omicron"],["&pi;","pi"],["&rho;","rho"],["&sigma;","sigma"],["&tau;","tau"],["&upsilon;","upsilon"],["&phi;","phi"],["&chi;","chi"],["&psi;","psi"],["&omega;","omega"],["&Alpha;","alpha"],["&Beta;","beta"],["&Gamma;","gamma"],["&Delta;","delta"],["&Epsilon;","epsilon"],["&Zeta;","zeta"],["&Eta;","eta"],["&Theta;","theta"],["&Iota;","iota"],["&Kappa;","kappa"],["&Lambda;","lambda"],["&Mu;","mu"],["&Nu;","nu"],["&Xi;","xi"],["&Omicron;","omicron"],["&Pi;","pi"],["&Rho;","rho"],["&Sigma;","sigma"],["&Tau;","tau"],["&Upsilon;","upsilon"],["&Phi;","phi"],["&Chi;","chi"],["&Psi;","psi"],["&Omega;","omega"]]}}},applyAction:function(){this.raptor.actionApply(function(){Ko&&rn(Ko),Ko=!1})},getDialogTemplate:function(){for(var e,t,n,i,o=No(this.raptor.getTemplate("special-characters.dialog")).appendTo("body").hide(),a=0;a<this.options.setOrder.length;a++){e=this.options.setOrder[a],o.find("ul").append(this.raptor.getTemplate("special-characters.tab-li",{baseClass:this.options.baseClass,name:this.options.characterSets[e].name,key:e})),t=No(this.raptor.getTemplate("special-characters.tab-content",{baseClass:this.options.baseClass,key:e}));for(var r=[],s=0;s<this.options.characterSets[e].characters.length;s++)n=this.options.characterSets[e].characters[s],i=this.raptor.getTemplate("special-characters.tab-button",{htmlEntity:n[0],description:n[1],setKey:e,charactersIndex:s}),r.push(i);t.append(r.join("")),o.find("ul").after(t)}o.show();var l=this;return o.find("button").each(function(){ui(No(this))}).click(function(){var e=No(this).attr("data-setKey"),t=No(this).attr("data-charactersIndex");Ko=l.options.characterSets[e].characters[t][0],l.getOkButton(l.name).click.call(this)}),Ti(o),o},getCancelButton:function(){}})),Mo.registerUi(new Li({name:"statistics",options:{maximum:100,showCountInButton:!0},dialogOptions:{width:350},init:function(){return this.options.showCountInButton&&this.raptor.bind("change",this.updateButton.bind(this)),Li.prototype.init.apply(this,arguments)},applyAction:function(){},getCancelButton:function(){},getCharacterCount:function(){return No("<div>").html(this.raptor.getHtml()).text().trim().length},getContent:function(){return No("<div>").html(this.raptor.getHtml()).text().trim()},updateButton:function(){var e=null,t=null,n=this.getCharacterCount();this.options.maximum?(e=this.options.maximum-n,t=e>=0?c("statisticsButtonCharacterRemaining",{charactersRemaining:e}):c("statisticsButtonCharacterOverLimit",{charactersRemaining:-1*e})):t=c("statisticsButtonCharacters",{characters:n}),di(this.button,t),this.options.maximum&&(0>e?this.button.addClass("ui-state-error").removeClass("ui-state-default"):e>=0&&15>=e?this.button.addClass("ui-state-highlight").removeClass("ui-state-error ui-state-default"):this.button.removeClass("ui-state-highlight ui-state-error").addClass("ui-state-default"))},getButton:function(){return this.button||(Ai.prototype.getButton.call(this),ui(this.button,{text:!0}),this.options.showCountInButton&&this.updateButton()),this.button},getDialogTemplate:function(){return No(this.raptor.getTemplate("statistics.dialog",this.options))},openDialog:function(){var e=this.getDialog(),t=this.getContent(),n=this.options.maximum?this.options.maximum-t.length:"&infin;";v(n)&&0>n?e.find("[data-name=truncation]").html(c("statisticsDialogTruncated",{limit:this.options.maximum})):e.find("[data-name=truncation]").html(c("statisticsDialogNotTruncated"));var i=t.split(" ").length;1===i?e.find("[data-name=words]").html(c("statisticsDialogWord",{words:i})):e.find("[data-name=words]").html(c("statisticsDialogWords",{words:i}));var o=t.split(". ").length;1===o?e.find("[data-name=sentences]").html(c("statisticsDialogSentence",{sentences:o})):e.find("[data-name=sentences]").html(c("statisticsDialogSentences",{sentences:o})),n>=0||!v(n)?e.find("[data-name=characters]").html(c("statisticsDialogCharactersRemaining",{characters:t.length,charactersRemaining:n})):e.find("[data-name=characters]").html(c("statisticsDialogCharactersOverLimit",{characters:t.length,charactersRemaining:-1*n})),Li.prototype.openDialog.call(this)}})),oo.prototype=Object.create(Mi.prototype),oo.prototype.getElement=function(e){var t=No(e.commonAncestorContainer.parentNode).closest("td, th");return t.length?t[0]:null},ao.prototype=Object.create(Hi.prototype),ao.prototype.createTable=function(e){this.raptor.actionApply(function(){rn(W(No($n(e.target.cellIndex+1,e.target.parentNode.rowIndex+1,{placeHolder:"&nbsp;"}))))})},ao.prototype.highlight=function(e){var t=ti(this.menuTable.get(0),{x:0,y:0},{x:e.target.cellIndex,y:e.target.parentNode.rowIndex});this.highlightRemove(e),No(t).addClass(this.options.baseClass+"-menu-hover"),this.raptor.actionPreview(function(){rn(W(No($n(e.target.cellIndex+1,e.target.parentNode.rowIndex+1,{placeHolder:"&nbsp;"}))))})},ao.prototype.highlightRemove=function(){this.menuTable.find("."+this.options.baseClass+"-menu-hover").removeClass(this.options.baseClass+"-menu-hover"),this.raptor.actionPreviewRestore()},ao.prototype.getMenu=function(){return this.menu||(this.menuContent=this.raptor.getTemplate("table.create-menu",this.options),Hi.prototype.getMenu.call(this).on("click","td",this.createTable.bind(this)).on("mouseenter","td",this.highlight.bind(this)).mouseleave(this.highlightRemove.bind(this)),this.menuTable=this.menu.find("table:eq(0)")),this.menu},Mo.registerUi(new ao),Mo.registerUi(new oo({name:"tableDeleteColumn",applyToElement:function(e){var t,n=Jn(e),i=e.parentNode.parentNode.parentNode;return Zn(e.parentNode.parentNode.parentNode,n.x),si(i)?(i.parentNode.removeChild(i),void 0):(t=ei(i,n),!t&&n.x>0&&(t=ei(i,{x:n.x-1,y:n.y})),sn(t),void 0)}})),Mo.registerUi(new oo({name:"tableDeleteRow",applyToElement:function(e){var t,n=Jn(e),i=e.parentNode.parentNode.parentNode;return Yn(e.parentNode.parentNode.parentNode,n.y),si(i)?(i.parentNode.removeChild(i),void 0):(t=ei(i,n),!t&&n.y>0&&(t=ei(i,{x:n.x,y:n.y-1})),sn(t),void 0)}})),Mo.registerUi(new oo({name:"tableInsertColumn",applyToElement:function(e){Xn(e.parentNode.parentNode.parentNode,Jn(e).x+1,{placeHolder:"&nbsp;"})}})),Mo.registerUi(new oo({name:"tableInsertRow",applyToElement:function(e){Qn(e.parentNode.parentNode.parentNode,Jn(e).y+1,{placeHolder:"&nbsp;"})}})),Mo.registerUi(new Ai({name:"tableMergeCells",action:function(){}})),Mo.registerUi(new Ai({name:"tableSplitCells",action:function(){}}));var $o=!1,Xo=null;ro.prototype=Object.create(_i.prototype),ro.prototype.init=function(){this.raptor.bind("selectionCustomise",this.selectionCustomise.bind(this)),this.raptor.registerHotkey("tab",this.tabToNextCell.bind(this)),this.raptor.registerHotkey("shift+tab",this.tabToPrevCell.bind(this)),this.raptor.getElement().on("mousedown","tbody td",this.cellMouseDown.bind(this)).on("mouseover","tbody td",this.cellMouseOver.bind(this)).mouseup(this.cellMouseUp.bind(this))},ro.prototype.selectionCustomise=function(){var e,t=[];return No("."+this.options.baseClass+"-cell-selected").each(function(){e=rangy.createRange(),e.selectNodeContents(this),t.push(e)}),t},ro.prototype.cellMouseDown=function(e){this.raptor.isEditing()&&(Xo=Jn(e.target),null!==Xo&&($o=!0,No(e.target).closest("table").addClass(this.options.baseClass+"-selected")))},ro.prototype.cellMouseUp=function(e){$o=!1;var t=No(e.target).closest("td"),n=!1;if(t.length>0&&null!==Xo){var i=Jn(t.get(0));(null===i||i.x==Xo.x&&i.y==Xo.y)&&(n=!0)}else n=!0;n&&(No("."+this.options.baseClass+"-selected").removeClass(this.options.baseClass+"-selected"),No("."+this.options.baseClass+"-cell-selected").removeClass(this.options.baseClass+"-cell-selected"))},ro.prototype.cellMouseOver=function(e){if($o){var t=ti(No(e.target).closest("table").get(0),Xo,Jn(e.target));No("."+this.options.baseClass+"-cell-selected").removeClass(this.options.baseClass+"-cell-selected"),No(t).addClass(this.options.baseClass+"-cell-selected"),rangy.getSelection().removeAllRanges()}},ro.prototype.tabToNextCell=function(){var e=rangy.getSelection().getRangeAt(0),t=Ut(e),n=No(t).closest("td");if(0===n.length)return!1;var i=n.next("td");0===i.length&&(i=n.closest("tr").next("tr").find("td:first"),0===i.length&&(i=n.closest("tbody").find("td:first"))),Mt(e,i),rangy.getSelection().setSingleRange(e)},ro.prototype.tabToPrevCell=function(){var e=rangy.getSelection().getRangeAt(0),t=Ut(e),n=No(t).closest("td");if(0===n.length)return!1;var i=n.prev("td");0===i.length&&(i=n.closest("tr").prev("tr").find("td:last"),0===i.length&&(i=n.closest("tbody").find("td:last"))),Mt(e,i),rangy.getSelection().setSingleRange(e)},Mo.registerPlugin(new ro),so.prototype=Object.create(Ui.prototype),so.prototype.init=function(){return this.raptor.bind("selectionChange",this.updateButton.bind(this)),Ui.prototype.init.apply(this,arguments)},so.prototype.changeTag=function(e){if("undefined"!=typeof e&&"na"!==e){var t=fn(),n=this.raptor.getElement();if(t&&!t.is(n)){var i=t.closest("td, li, #"+n.attr("id"));0!==i.length&&(n=i)}Ln(e,["h1","h2","h3","h4","h5","h6","p","div","pre","address"],n)}},so.prototype.menuItemClick=function(e){Ui.prototype.menuItemClick.apply(this,arguments),this.raptor.actionApply(function(){this.changeTag(No(e.currentTarget).data("value"))}.bind(this))},so.prototype.menuItemMouseEnter=function(e){this.raptor.actionPreview(function(){this.changeTag(No(e.currentTarget).data("value"))}.bind(this))},so.prototype.menuItemMouseLeave=function(){this.raptor.actionPreviewRestore()},so.prototype.updateButton=function(){var e=gn()[0],t=this.getButton().getButton();if(e){var n=e.tagName.toLowerCase(),i=this.getMenu().find("[data-value="+n+"]");i.length?di(t,i.html()):di(t,c("tagMenuTagNA"))}},so.prototype.getMenuItems=function(){return this.raptor.getTemplate("tag-menu.menu",this.options)},Mo.registerUi(new so),lo.prototype=Object.create(Pi.prototype),lo.prototype.action=function(){Nn([this.getClass()],[this.options.cssPrefix+"center",this.options.cssPrefix+"left",this.options.cssPrefix+"right",this.options.cssPrefix+"justify"],this.raptor.getElement(),"span"),this.selectionChange()},lo.prototype.selectionToggle=function(){return rangy.getSelection().getAllRanges().length>0&&zn("."+this.getClass(),this.raptor.getElement())},Mo.registerUi(new lo({name:"alignCenter",getClass:function(){return this.options.cssPrefix+"center"}})),Mo.registerUi(new lo({name:"alignJustify",getClass:function(){return this.options.cssPrefix+"justify"}})),Mo.registerUi(new lo({name:"alignLeft",getClass:function(){return this.options.cssPrefix+"left"}})),Mo.registerUi(new lo({name:"alignRight",getClass:function(){return this.options.cssPrefix+"right"}})),Mo.registerUi(new Bi({name:"textBold",hotkey:"ctrl+b",tag:"strong",classes:["bold"]})),Mo.registerUi(new Bi({name:"textItalic",hotkey:"ctrl+i",tag:"em",classes:["italic"]})),Mo.registerUi(new Bi({name:"textStrike",tag:"del",classes:["strike"]})),Mo.registerUi(new Pi({name:"textBlockQuote",init:function(){var e=Pi.prototype.init.apply(this,arguments);return $(this.raptor.getElement(),xo)?e:void 0},action:function(){dt("blockquote","p",this.raptor.getElement())},selectionToggle:function(){return rangy.getSelection().getAllRanges().length>0&&zn("blockquote",this.raptor.getElement())}})),Mo.registerUi(new Oi({name:"textSizeDecrease",action:function(){In(),this.raptor.selectionConstrain(),On("small",this.options.cssPrefix+"small","big",this.options.cssPrefix+"big"),this.raptor.getElement().find("small."+this.options.cssPrefix+"small:empty, big."+this.options.cssPrefix+"big:empty").remove()}})),Mo.registerUi(new Oi({name:"textSizeIncrease",action:function(){In(),this.raptor.selectionConstrain(),On("big",this.options.cssPrefix+"big","small",this.options.cssPrefix+"small"),this.raptor.getElement().find("small."+this.options.cssPrefix+"small:empty, big."+this.options.cssPrefix+"big:empty").remove()}})),Mo.registerUi(new Bi({name:"textUnderline",hotkey:"ctrl+u",tag:"u",classes:["underline"]})),Mo.registerUi(new Bi({name:"textSub",tag:"sub",classes:["sub"]})),Mo.registerUi(new Bi({name:"textSuper",tag:"sup",classes:["sup"]})),co.prototype=Object.create(_i.prototype),co.prototype.init=function(){this.raptor.bind("layoutReady",function(e){No(e).on("mouseover","[title]",function(){No(this).attr("data-title",No(this).attr("title")).removeAttr("title")})})},Mo.registerPlugin(new co);var Zo=0,Qo=null;uo.prototype=Object.create(_i.prototype),uo.prototype.enable=function(){this.raptor.bind("dirty",this.show.bind(this)),this.raptor.bind("cleaned",this.hide.bind(this))},uo.prototype.show=function(){Zo++,U(this.getElement()),this.getElement().addClass(this.options.baseClass+"-visible")},uo.prototype.hide=function(){0===--Zo&&this.getElement().removeClass(this.options.baseClass+"-visible")},uo.prototype.getElement=function(){if(!Qo){var e="raptor-plugin-unsaved-edit-warning-dirty";Qo=No(this.raptor.getTemplate("unsaved-edit-warning.warning",this.options)).mouseenter(function(){Mo.eachInstance(function(t){t.isDirty()&&t.getElement().addClass(e)})}).mouseleave(function(){No("."+e).removeClass(e)}).appendTo("body")}return Qo},Mo.registerPlugin(new uo),Mo.registerUi(new Li({name:"viewSource",dialogOptions:{width:600,height:400},applyAction:function(e){var t=e.find("textarea").val();this.raptor.actionApply(function(){this.raptor.setHtml(t),dn(this.raptor.getElement().first()),this.raptor.checkSelectionChange()}.bind(this))},openDialog:function(){var e=this.getDialog().find("textarea");e.val(this.raptor.getHtml()),Li.prototype.openDialog.call(this),e.select()},getDialogTemplate:function(){return No("<div>").html(this.raptor.getTemplate("view-source.dialog",this.options))}}))}();